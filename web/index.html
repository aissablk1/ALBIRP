<!DOCTYPE html>
<!-- 
ALBI RP™ | L'ULTIME EXPÉRIENCE ROLEPLAY 
© ALBI RP™ COPYRIGHT ALL TIME

Auteur : ALBI RP™ Staff (Aïssa BELKOUSSA)
Version : 1.0.0 (latest)
Date : 2025-12-21
-->
<html lang="fr" class="scroll-smooth overflow-x-hidden bg-black">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ALBI RP™ | L'ULTIME EXPÉRIENCE RP</title>
    <meta name="description"
        content="Rejoignez ALBI RP, l'expérience ultime de Roblox Roleplay en France. Serveur Whitelist, économie réaliste, gangs, police, et mapping exclusif de la ville d'Albi. Développez votre histoire dès maintenant.">
    <meta name="keywords"
        content="Roblox RP, Serveur RP, Roleplay France, Albi RP, Serious RP, Roblox, Whitelist, Police RP, Gangs, Économie Réaliste, Occitanie, Tarn, Roblox Roleplay">
    <meta name="author" content="ALBI RP™ Staff">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://albirp.com/">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://albirp.com/">
    <meta property="og:title" content="ALBI RP™ | L'ULTIME EXPÉRIENCE ROLEPLAY">
    <meta property="og:description"
        content="La Cité Épiscopale est tombée. Construis ton empire sur les briques rouges. Serveur Roblox RP Strict & Whitelist.">
    <meta property="og:image" content="https://albirp.com/assets/banner-og.jpg">
    <meta property="og:locale" content="fr_FR">
    <meta property="og:site_name" content="ALBI RP">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://albirp.com/">
    <meta name="twitter:title" content="ALBI RP™ | Serveur Roblox RP FR">
    <meta name="twitter:description"
        content="Rejoignez la résistance ou faites régner l'ordre. Le meilleur serveur RP basé sur la ville d'Albi.">
    <meta name="twitter:image" content="https://albirp.com/assets/banner-og.jpg">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&family=UnifrakturMaguntia&display=swap"
        rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.1.0/fonts/remixicon.css" rel="stylesheet" />

    <!-- Dépendances -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- Single-File Tailwind Config (V26) - Silenced CDN Warning -->
    <script>
        (function () {
            const origWarn = console.warn;
            console.warn = function (...args) {
                // Si l'avertissement vient de Tailwind CDN, on l'ignore
                if (args[0] && typeof args[0] === 'string' && args[0].includes('cdn.tailwindcss.com')) return;
                origWarn.apply(console, args);
            };
        })();
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    screens: {
                        'xxs': '320px',
                        'xs': '375px',
                        'sm': '640px',
                        'md': '768px',
                        'lg': '1024px',
                        'xl': '1280px',
                        '3xl': '1920px',
                        '4xl': '2560px',
                        '5xl': '3840px',
                        '6xl': '4096px',
                        '7xl': '4352px',
                        '8xl': '4608px',
                        '9xl': '4864px',
                        '10xl': '5120px',
                    },
                    colors: {
                        // Variables CSS dynamiques
                        'brand-main': 'var(--color-main)',
                        'brand-sec': 'var(--color-sec)',
                        'brand-accent': 'var(--color-accent)',
                        'brand-bg': 'var(--color-bg)',
                        'brand-text': 'var(--color-text)',

                        // Palette Statique
                        'albi-red': '#E63946',
                        'neo-yellow': '#D6FF00',
                        'neo-pink': '#FF00F5',
                        'neo-blue': '#00E0FF',
                        'dark-brick': '#8B0000',
                        'industrial': '#1F2937',
                        'deep-black': '#000000',
                        'paper': '#F1FAEE'
                    },
                    fontFamily: {
                        // Force les Emojis Apple/Système partout
                        'sans': ['Space Grotesk', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji', 'sans-serif'],
                        'medieval': ['UnifrakturMaguntia', 'cursive'],
                        'emoji': ['Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji', 'sans-serif']
                    },
                    boxShadow: {
                        'hard': '8px 8px 0px 0px #000000',
                        'hard-hover': '0px 0px 0px 0px #000000',
                        'hard-sm': '4px 4px 0px 0px #000000',
                        'hard-lg': '16px 16px 0px 0px #000000',
                        'reverse': '-8px 8px 0px 0px #000000',
                        'white-sm': '4px 4px 0px 0px #FFFFFF',
                        'black-top-left': '-4px -4px 0px 0px #000000',
                    },
                    animation: {
                        'spin-slow': 'spin 10s linear infinite',
                    }
                }
            }
        }
    </script>

    <!-- Styles CSS -->
    <style>
        /* --- VARIABLES CSS DYNAMIQUES --- */
        :root {
            /* État Initial : NEO BRUTALIST */
            --color-main: #D6FF00;
            /* neoYellow */
            --color-sec: #FF00F5;
            /* neoPink */
            --color-accent: #00E0FF;
            /* neoBlue */
            --color-bg: #FFFFFF;
            /* blancPur */
            --color-text: #000000;
            /* noirProfond */
            --scrollbar-width: 12px;
        }

        /* État Secondaire : ALBI HISTORIQUE (appliqué via JS) */
        body.theme-albi {
            --color-main: #E63946;
            /* rougeAlbi */
            --color-sec: #FF9F1C;
            /* ocreMedieval */
            --color-accent: #1F2937;
            /* anthraciteIndustriel */
            --color-bg: #F1FAEE;
            /* papierRecycle */
            --color-text: #0A0A0A;
            /* noirDeJais */
        }

        /* THÈME DATA (POUR LE LORE/WHITELIST) */
        body.theme-data {
            --color-main: #00FF41;
            /* Terminal Green */
            --color-sec: #E63946;
            /* Rouge Albi pour le "RP" */
            --color-accent: #333333;
            --color-bg: #0D0D0D;
            --color-text: #FFFFFF;
        }

        /* THÈME COMMERCE (Boutique) */
        body.theme-shop {
            --color-main: #FF00F5;
            /* Magenta Cyberpunk */
            --color-sec: #D6FF00;
            /* Jaune Néon */
            --color-accent: #FFFFFF;
            /* Blanc */
            --color-bg: #11001C;
            /* Violet Foncé */
            --color-text: #FFFFFF;
            /* Blanc */
        }

        /* THÈME VOTE (Cyan/Bleu Électrique) */
        body.theme-vote {
            --color-main: #00E0FF;
            /* neoBlue */
            --color-sec: #D6FF00;
            /* neoYellow */
            --color-accent: #000000;
            --color-bg: #E0F7FA;
            /* Cyan très pâle */
            --color-text: #000000;
        }

        /* THÈME SOCIALS (Réseaux / Violet) */
        body.theme-socials {
            --color-main: #FF00F5;
            /* neoPink */
            --color-sec: #00E0FF;
            /* neoBlue */
            --color-accent: #1A1A1A;
            /* Fond sombre pour footer (proche du bg) */
            --color-bg: #0A0A0A;
            /* Dark Mode */
            --color-text: #FFFFFF;
        }

        /* --- UTILITAIRES --- */
        body {
            transition: background-color 0.1s steps(2), color 0.1s steps(2);
            overflow-x: hidden;
            /* Support Safe Area (iPhone X+) */
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
        }

        /* Fallback pour navigateurs sans support -webkit-text-stroke */
        .text-outline {
            color: black;
            /* Fallback visible pour Firefox et autres */
            text-shadow:
                -2px -2px 0 black,
                2px -2px 0 black,
                -2px 2px 0 black,
                2px 2px 0 black,
                0 -2px 0 black,
                0 2px 0 black,
                -2px 0 0 black,
                2px 0 0 black;
        }

        /* Support natif -webkit-text-stroke si disponible */
        @supports (-webkit-text-stroke: 2px black) {
            .text-outline {
                -webkit-text-stroke: 2px black;
                color: transparent;
                text-shadow: none;
                /* Désactiver text-shadow si -webkit-text-stroke fonctionne */
            }
        }

        /* Fallback pour navigateurs sans support -webkit-text-stroke */
        .text-outline-white {
            color: white;
            /* Fallback visible pour Firefox et autres */
            text-shadow:
                -1px -1px 0 white,
                1px -1px 0 white,
                -1px 1px 0 white,
                1px 1px 0 white,
                0 -1px 0 white,
                0 1px 0 white,
                -1px 0 0 white,
                1px 0 0 white;
        }

        /* Support natif -webkit-text-stroke si disponible */
        @supports (-webkit-text-stroke: 1px white) {
            .text-outline-white {
                -webkit-text-stroke: 1px white;
                color: transparent;
                text-shadow: none;
                /* Désactiver text-shadow si -webkit-text-stroke fonctionne */
            }
        }

        /* SEO TEXTE INVISIBLE (Pour les robots) */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        /* --- VIEW SECTIONS (ROUTING) --- */
        .view-section {
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .view-section.active {
            display: block;
            opacity: 1;
        }

        /* --- MARQUEE ANIMATION --- */
        .marquee-container {
            overflow: hidden;
            white-space: nowrap;
        }

        .marquee-content {
            display: inline-block;
            animation: marquee 20s linear infinite;
        }

        @keyframes marquee {
            0% {
                transform: translateX(0);
            }

            100% {
                transform: translateX(-50%);
            }
        }

        /* --- GLITCH & CLIGNOTEMENT --- */
        /* Classe ajoutée temporairement lors du scroll */
        .glitch-mode {
            animation: glitch-flash 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) both infinite;
            filter: invert(1);
        }

        @keyframes glitch-flash {
            0% {
                transform: translate(0);
            }

            20% {
                transform: translate(-5px, 5px);
            }

            40% {
                transform: translate(-5px, -5px);
            }

            60% {
                transform: translate(5px, 5px);
            }

            80% {
                transform: translate(5px, -5px);
            }

            100% {
                transform: translate(0);
            }
        }

        /* --- CRT EFFECT AVANCÉ --- */

        /* Couche 1 : Scanlines (Texture) */
        .crt::before {
            content: " ";
            display: block;
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(to bottom,
                    rgba(18, 16, 16, 0) 50%,
                    rgba(0, 0, 0, 0.125) 50%);
            background-size: 100% 2px;
            z-index: 9998;
            pointer-events: none;
        }

        /* Couche 2 : Light Leaks, Vignetage & Rolling Bar */
        .crt::after {
            content: " ";
            display: block;
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            z-index: 9999;
            pointer-events: none;

            /* Composition : Vignetage + Barre de lumière mobile */
            background:
                /* 1. Vignetage (Coins sombres) */
                radial-gradient(circle, rgba(0, 0, 0, 0) 85%, rgba(0, 0, 0, 0.05) 100%),
                /* 2. Rolling Light Leak (Barre lumineuse qui descend) */
                linear-gradient(to bottom,
                    rgba(255, 255, 255, 0) 0%,
                    rgba(255, 255, 255, 0) 40%,
                    rgba(255, 255, 255, 0.05) 50%,
                    rgba(255, 255, 255, 0) 60%,
                    rgba(255, 255, 255, 0) 100%);
            background-size: 100% 100%, 100% 200%;
            /* La barre fait 2x la hauteur pour défiler */

            /* Animation composite : Scintillement + Défilement de la barre */
            animation: crt-flicker 0.15s infinite, crt-scan 8s linear infinite;
        }

        /* Animation du Scintillement (Flicker) */
        @keyframes crt-flicker {
            0% {
                opacity: 0.95;
            }

            50% {
                opacity: 0.92;
            }

            100% {
                opacity: 0.96;
            }
        }

        /* Animation de la barre de rafraîchissement (Rolling Scan) */
        @keyframes crt-scan {
            0% {
                background-position: 0% 0%, 0% -100%;
            }

            100% {
                background-position: 0% 0%, 0% 200%;
            }
        }

        /* --- STYLES SPÉCIFIQUES --- */
        .brutalist-card {
            border: 4px solid black;
            transition: all 0.2s ease;
        }

        .brutalist-card:hover {
            transform: translate(-4px, -4px);
            box-shadow: 12px 12px 0px 0px var(--color-text);
        }

        /* --- ANIMATIONS SCROLL TRIGGER --- */
        @keyframes moveGrid {
            0% {
                transform: translateY(0);
            }

            100% {
                transform: translateY(40px);
            }
        }

        @keyframes marquee-slow {
            0% {
                transform: translateX(0) rotate(-12deg);
            }

            100% {
                transform: translateX(-50%) rotate(-12deg);
            }
        }

        @keyframes marquee-reverse {
            0% {
                transform: translateX(-50%) rotate(12deg);
            }

            100% {
                transform: translateX(0) rotate(12deg);
            }
        }

        .animate-marquee-slow {
            animation: marquee-slow 15s linear infinite;
        }

        .animate-marquee-reverse {
            animation: marquee-reverse 10s linear infinite;
        }

        /* Animation Défilement Infini */
        @keyframes scroll-left {
            0% {
                transform: translateX(0);
            }

            100% {
                transform: translateX(-100%);
            }
        }

        .animate-scroll {
            animation: scroll-left 20s linear infinite;
            /* Ajustez 20s pour la vitesse */
        }

        /* --- ANIMATIONS SCROLL TRIGGER AVANCÉES --- */
        /* Texte détouré (Outline) pour les flèches */
        /* Fallback pour navigateurs sans support -webkit-text-stroke */
        .text-outline-white-arrow {
            color: white;
            /* Fallback visible pour Firefox et autres */
            text-shadow:
                -2px -2px 0 white,
                2px -2px 0 white,
                -2px 2px 0 white,
                2px 2px 0 white,
                0 -2px 0 white,
                0 2px 0 white,
                -2px 0 0 white,
                2px 0 0 white;
        }

        /* Support natif -webkit-text-stroke si disponible */
        @supports (-webkit-text-stroke: 2px white) {
            .text-outline-white-arrow {
                -webkit-text-stroke: 2px white;
                color: transparent;
                text-shadow: none;
                /* Désactiver text-shadow si -webkit-text-stroke fonctionne */
            }
        }

        /* Séquence d'animation des flèches */
        @keyframes arrow-sequence {

            0%,
            100% {
                opacity: 0.2;
                transform: translateY(0);
            }

            50% {
                opacity: 1;
                transform: translateY(5px);
            }
        }

        .animate-arrow-1 {
            animation: arrow-sequence 1s ease-in-out infinite 0.1s;
        }

        .animate-arrow-2 {
            animation: arrow-sequence 1s ease-in-out infinite 0.2s;
        }

        .animate-arrow-3 {
            animation: arrow-sequence 1s ease-in-out infinite 0.3s;
        }

        .animate-arrow-4 {
            animation: arrow-sequence 1s ease-in-out infinite 0.4s;
        }

        /* Animation de remplissage de la jauge */
        @keyframes fill-height {
            0% {
                height: 0%;
            }

            50% {
                height: 100%;
                background-color: var(--color-main);
            }

            51% {
                background-color: white;
            }

            100% {
                height: 0%;
                background-color: var(--color-main);
            }
        }

        .animate-fill-height {
            animation: fill-height 3s infinite linear;
        }

        /* --- CURSEUR CUSTOM NÉO-BRUTALISTE --- */
        /* Cache le curseur système par défaut - TOUS les éléments */
        *,
        *::before,
        *::after {
            cursor: none !important;
        }

        /* Double sécurité pour les éléments interactifs */
        html,
        body,
        a,
        button,
        input,
        select,
        textarea,
        [role="button"],
        [onclick],
        [href] {
            cursor: none !important;
        }

        /* État initial du curseur - Visible par défaut */
        #custom-cursor {
            opacity: 1;
            /* Position initiale au centre (sera mise à jour par JS) */
            left: 50%;
            top: 50%;
        }

        /* Sécurité : cacher le curseur sur tous les éléments, même ceux ajoutés dynamiquement */
        [style*="cursor"] {
            cursor: none !important;
        }

        /* Cacher le curseur même sur les éléments avec inline styles */
        [onclick],
        [href],
        [role="button"],
        [tabindex] {
            cursor: none !important;
        }

        /* Animation de rotation lente pour le style HUD */
        @keyframes spin-slow {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .animate-spin-slow {
            animation: spin-slow 10s linear infinite;
        }

        /* État Hover (quand on survole un lien) */
        .cursor-hover {
            transform: translate(-50%, -50%) scale(1.5) !important;
            /* Gros zoom */
        }

        .cursor-hover svg {
            animation-duration: 2s;
            /* Rotation plus rapide */
        }

        /* État Click */
        .cursor-click {
            transform: translate(-50%, -50%) scale(0.8) !important;
        }

        /* --- NAV SAFE AREA (iPhone X+) --- */
        nav {
            padding-top: env(safe-area-inset-top);
        }

        /* --- FOOTER CONTRASTE GARANTI POUR TOUS LES THÈMES --- */
        /* Garantir que le footer est visible et a un fond */
        footer {
            background-color: var(--color-accent) !important;
            position: relative;
            z-index: 1;
            min-height: 200px;
            /* Support Safe Area (iPhone X+) */
            padding-bottom: env(safe-area-inset-bottom);
        }

        /* Styles par défaut (thème NEO) */
        .footer-contrast {
            color: #000000;
            /* Noir sur fond cyan (#00E0FF) = bon contraste */
        }

        .footer-title {
            color: var(--color-main);
            /* Couleur principale du thème */
        }

        .footer-text {
            color: #000000;
            /* Noir sur fond cyan = bon contraste */
        }

        .footer-link {
            color: #000000;
            /* Noir sur fond cyan = bon contraste */
        }

        .footer-link:hover {
            color: var(--color-main);
            /* Couleur principale du thème au survol */
        }

        .footer-copyright {
            color: #000000;
            /* Noir sur fond cyan = bon contraste */
            opacity: 0.7;
            /* Légèrement transparent mais toujours lisible */
        }

        /* Thème ALBI (fond anthracite #1F2937) */
        body.theme-albi .footer-contrast {
            color: #FFFFFF;
            /* Blanc sur fond anthracite = excellent contraste */
        }

        body.theme-albi .footer-title {
            color: #E63946;
            /* Rouge Albi sur fond anthracite = bon contraste */
        }

        body.theme-albi .footer-text {
            color: #FFFFFF;
            /* Blanc sur fond anthracite = excellent contraste */
        }

        body.theme-albi .footer-link {
            color: #FFFFFF;
            /* Blanc sur fond anthracite = excellent contraste */
        }

        body.theme-albi .footer-link:hover {
            color: #E63946;
            /* Rouge Albi au survol */
        }

        body.theme-albi .footer-copyright {
            color: #FFFFFF;
            /* Blanc sur fond anthracite = excellent contraste */
        }

        /* Thème DATA (fond gris foncé #333333) */
        body.theme-data .footer-contrast {
            color: #FFFFFF;
            /* Blanc sur fond gris foncé = excellent contraste */
        }

        body.theme-data .footer-title {
            color: #00FF41;
            /* Vert terminal sur fond gris foncé = excellent contraste */
        }

        body.theme-data .footer-text {
            color: #FFFFFF;
            /* Blanc sur fond gris foncé = excellent contraste */
        }

        body.theme-data .footer-link {
            color: #FFFFFF;
            /* Blanc sur fond gris foncé = excellent contraste */
        }

        body.theme-data .footer-link:hover {
            color: #00FF41;
            /* Vert terminal au survol */
        }

        body.theme-data .footer-copyright {
            color: #FFFFFF;
            /* Blanc sur fond gris foncé = excellent contraste */
        }

        /* Thème SHOP (fond blanc #FFFFFF) - PROBLÈME RÉSOLU */
        body.theme-shop .footer-contrast {
            color: #000000;
            /* Noir sur fond blanc = excellent contraste */
        }

        body.theme-shop .footer-title {
            color: #FF00F5;
            /* Magenta sur fond blanc = bon contraste */
        }

        body.theme-shop .footer-text {
            color: #000000;
            /* Noir sur fond blanc = excellent contraste */
        }

        body.theme-shop .footer-link {
            color: #000000;
            /* Noir sur fond blanc = excellent contraste */
        }

        body.theme-shop .footer-link:hover {
            color: #FF00F5;
            /* Magenta au survol */
        }

        body.theme-shop .footer-copyright {
            color: #000000;
            /* Noir sur fond blanc = excellent contraste */
        }

        /* Thème VOTE (fond noir #000000) */
        body.theme-vote .footer-contrast {
            color: #FFFFFF;
            /* Blanc sur fond noir = excellent contraste */
        }

        body.theme-vote .footer-title {
            color: #00E0FF;
            /* Cyan sur fond noir = excellent contraste */
        }

        body.theme-vote .footer-text {
            color: #FFFFFF;
            /* Blanc sur fond noir = excellent contraste */
        }

        body.theme-vote .footer-link {
            color: #FFFFFF;
            /* Blanc sur fond noir = excellent contraste */
        }

        body.theme-vote .footer-link:hover {
            color: #00E0FF;
            /* Cyan au survol */
        }

        body.theme-vote .footer-copyright {
            color: #FFFFFF;
            /* Blanc sur fond noir = excellent contraste */
        }

        /* Thème SOCIALS (fond sombre #0A0A0A) */
        body.theme-socials .footer-contrast {
            color: #FFFFFF;
            /* Blanc sur fond sombre = excellent contraste */
        }

        body.theme-socials .footer-title {
            color: #FF00F5;
            /* Magenta sur fond sombre = excellent contraste */
        }

        body.theme-socials .footer-text {
            color: #FFFFFF;
            /* Blanc sur fond sombre = excellent contraste */
        }

        body.theme-socials .footer-link {
            color: #FFFFFF;
            /* Blanc sur fond sombre = excellent contraste */
        }

        body.theme-socials .footer-link:hover {
            color: #FF00F5;
            /* Magenta au survol */
        }

        body.theme-socials .footer-copyright {
            color: #FFFFFF;
            /* Blanc sur fond sombre = excellent contraste */
        }

        /* Support pour prefers-contrast: high */
        @media (prefers-contrast: high) {

            .footer-contrast,
            .footer-text,
            .footer-link,
            .footer-copyright {
                color: #000000 !important;
            }

            body.theme-albi .footer-contrast,
            body.theme-albi .footer-text,
            body.theme-albi .footer-link,
            body.theme-albi .footer-copyright,
            body.theme-data .footer-contrast,
            body.theme-data .footer-text,
            body.theme-data .footer-link,
            body.theme-data .footer-copyright,
            body.theme-vote .footer-contrast,
            body.theme-vote .footer-text,
            body.theme-vote .footer-link,
            body.theme-vote .footer-copyright,
            body.theme-socials .footer-contrast,
            body.theme-socials .footer-text,
            body.theme-socials .footer-link,
            body.theme-socials .footer-copyright {
                color: #FFFFFF !important;
            }

            body.theme-shop .footer-contrast,
            body.theme-shop .footer-text,
            body.theme-shop .footer-link,
            body.theme-shop .footer-copyright {
                color: #000000 !important;
            }
        }

        /* --- UTILITAIRES DE CONTRASTE WCAG AA --- */
        /* Classes utilitaires pour garantir un contraste minimum de 4.5:1 */
        .text-contrast-high {
            /* Force un contraste élevé pour le texte */
            color: #000000;
        }

        .bg-dark .text-contrast-high,
        .bg-black .text-contrast-high,
        body.theme-data .text-contrast-high,
        body.theme-vote .text-contrast-high,
        body.theme-socials .text-contrast-high {
            color: #FFFFFF;
        }

        .text-contrast-medium {
            /* Contraste moyen mais toujours lisible */
            opacity: 0.9;
        }

        /* --- FALLBACKS POUR MIX-BLEND --- */
        /* Fallback pour mix-blend-difference (non supporté sur tous les navigateurs) */
        @supports not (mix-blend-mode: difference) {
            .mix-blend-difference {
                /* Fallback : utiliser un filtre ou une opacité pour simuler l'effet */
                opacity: 0.9;
            }

            /* Pour le curseur custom, utiliser une couleur contrastée */
            #custom-cursor {
                filter: invert(1);
            }
        }

        /* Fallback pour mix-blend-hard-light */
        @supports not (mix-blend-mode: hard-light) {
            .mix-blend-hard-light {
                /* Fallback : utiliser une opacité ou un filtre */
                opacity: 0.95;
            }
        }

        /* --- SCROLLBAR DYNAMIQUE (PATCH FORCE MAC/SAFARI) --- */
        /* Webkit (Chrome, Safari, Edge, Opera) - Version améliorée avec fallbacks */
        html ::-webkit-scrollbar,
        ::-webkit-scrollbar {
            width: var(--scrollbar-width, 14px) !important;
            /* Fallback 14px si variable manquante */
            height: var(--scrollbar-width, 14px) !important;
            display: block !important;
            /* Force l'affichage sur Mac/Safari */
            -webkit-appearance: none !important;
            /* Désactive le style natif */
            background: var(--color-bg) !important;
            /* Fallback blanc */
        }

        html ::-webkit-scrollbar-track,
        ::-webkit-scrollbar-track {
            background: linear-gradient(180deg, var(--color-bg) 0%, var(--color-accent) 50%, var(--color-bg) 100%) !important;
            border-left: 3px solid var(--color-main) !important;
            /* Bordures épaissies pour visibilité */
            box-shadow: inset 0 0 10px color-mix(in srgb, var(--color-text, #000000) 30%, transparent) !important;
            -webkit-appearance: none !important;
        }

        html ::-webkit-scrollbar-thumb,
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, var(--color-main) 0%, var(--color-sec) 50%, var(--color-accent) 100%) !important;
            border: 3px solid var(--color-text, #000000) !important;
            /* Bordures épaissies */
            border-radius: 4px !important;
            box-shadow:
                inset 2px 2px 0px color-mix(in srgb, var(--color-bg) 30%, transparent),
                0 0 8px var(--color-main),
                inset 0 0 10px color-mix(in srgb, var(--color-text, #000000) 20%, transparent) !important;
            transition: all 0.3s ease !important;
            min-height: 40px !important;
            /* Taille min pour ne pas disparaître sur Mac */
            -webkit-appearance: none !important;
        }

        html ::-webkit-scrollbar-thumb:hover,
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, var(--color-sec) 0%, var(--color-accent) 50%, var(--color-main) 100%) !important;
            box-shadow:
                inset 2px 2px 0px color-mix(in srgb, var(--color-bg) 50%, transparent),
                0 0 15px var(--color-sec),
                inset 0 0 15px color-mix(in srgb, var(--color-bg) 10%, transparent) !important;
            transform: scaleX(1.1) !important;
        }

        html ::-webkit-scrollbar-thumb:active,
        ::-webkit-scrollbar-thumb:active {
            background: linear-gradient(180deg, var(--color-accent) 0%, var(--color-main) 50%, var(--color-sec) 100%) !important;
            box-shadow:
                inset 2px 2px 0px color-mix(in srgb, var(--color-bg) 60%, transparent),
                0 0 20px var(--color-accent) !important;
        }

        /* Coin en bas à droite (intersection de deux scrollbars) */
        html ::-webkit-scrollbar-corner,
        ::-webkit-scrollbar-corner {
            background: var(--color-bg) !important;
            /* Fond au lieu de transparent pour meilleure visibilité */
            -webkit-appearance: none !important;
        }

        /* Firefox - Ciblage HTML spécifique pour éviter les conflits */
        html {
            scrollbar-width: thin !important;
            scrollbar-color: var(--color-main) var(--color-bg) !important;
        }

        /* Fallback pour les navigateurs qui ne supportent pas scrollbar-color */
        @supports not (scrollbar-color: red blue) {
            html {
                scrollbar-width: thin;
            }
        }

        /* Fallback pour les navigateurs qui ne supportent pas color-mix() */
        @supports not (color: color-mix(in srgb, red 50%, blue)) {

            html ::-webkit-scrollbar-track,
            ::-webkit-scrollbar-track {
                box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.3) !important;
            }

            html ::-webkit-scrollbar-thumb,
            ::-webkit-scrollbar-thumb {
                box-shadow:
                    inset 2px 2px 0px rgba(255, 255, 255, 0.3),
                    0 0 8px var(--color-main),
                    inset 0 0 10px rgba(0, 0, 0, 0.2) !important;
            }

            html ::-webkit-scrollbar-thumb:hover,
            ::-webkit-scrollbar-thumb:hover {
                box-shadow:
                    inset 2px 2px 0px rgba(255, 255, 255, 0.5),
                    0 0 15px var(--color-sec),
                    inset 0 0 15px rgba(255, 255, 255, 0.1) !important;
            }

            html ::-webkit-scrollbar-thumb:active,
            ::-webkit-scrollbar-thumb:active {
                box-shadow:
                    inset 2px 2px 0px rgba(255, 255, 255, 0.6),
                    0 0 20px var(--color-accent) !important;
            }
        }


        /* --- PRELOADER STYLES --- */
        #preloader {
            position: fixed;
            inset: 0;
            background-color: #000;
            z-index: 99999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: 'Space Grotesk', monospace;
            transition: transform 0.8s cubic-bezier(0.76, 0, 0.24, 1);
            /* Effet rideau */
        }

        .loader-bar-container {
            width: 300px;
            max-width: 80%;
            height: 20px;
            border: 2px solid var(--color-main);
            padding: 2px;
            margin-top: 20px;
        }

        .loader-bar {
            height: 100%;
            background-color: var(--color-main);
            width: 0%;
            transition: width 0.1s linear;
        }

        .terminal-text {
            color: var(--color-main);
            font-size: 14px;
            margin-bottom: 5px;
            opacity: 0.7;
        }

        /* --- PATCH : VISIBILITÉ DU CURSEUR (FORCE Z-INDEX) --- */
        #custom-cursor {
            /* 999999 = Au-dessus du Preloader (99999) 
                            ET au-dessus du Resolution Lockdown (200000) 
                            !important = Priorité absolue sur Tailwind 
                            */
            z-index: 999999 !important;
        }

        /* Support pour prefers-reduced-motion */
        @media (prefers-reduced-motion: reduce) {

            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* --- RESOLUTION LOCKDOWN SYSTEM (BIOS ERROR) --- */
        #resolution-lockdown {
            display: none;
            /* Caché par défaut */
            position: fixed;
            inset: 0;
            background-color: #FF0000;
            /* Rouge Fatal */
            z-index: 200000;
            /* Au-dessus de TOUT (Preloader = 99999) */
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            text-align: center;
            font-family: 'Space Grotesk', sans-serif;
            overflow: hidden;
        }

        /* Scanlines pour l'effet écran crashé */
        #resolution-lockdown::before {
            content: "";
            position: absolute;
            inset: 0;
            background: linear-gradient(rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, 0.25) 50%);
            background-size: 100% 4px;
            pointer-events: none;
            animation: crt-scan 10s linear infinite;
        }

        @keyframes crt-scan {
            0% {
                transform: translateY(0);
            }

            100% {
                transform: translateY(4px);
            }
        }

        .pixelated {
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        /* DÉCLENCHEURS DE SÉCURITÉ */
        /* 1. Largeur < XS (375px) */
        @media (max-width: 374px) {
            #resolution-lockdown {
                display: flex !important;
            }
        }

        /* 2. Hauteur Insuffisante (Mode Paysage Mobile ou Fenêtre écrasée) */
        /* On met 500px pour garantir que le contenu respire */
        @media (max-height: 500px) {
            #resolution-lockdown {
                display: flex !important;
            }
        }

        /* SYSTÈME DE FILTRE JOBS - Transitions pour les cartes */
        .job-card {
            transition: opacity 0.2s ease, transform 0.2s ease;
            opacity: 1;
            transform: scale(1);
        }

        .job-card.hidden {
            display: none;
        }

        /* --- STYLES BOUTON MENU MOBILE --- */
        #menu-btn {
            height: 44px;
            align-items: center;
            justify-content: center;
            padding-left: 0.375rem;
            /* 6px */
            padding-right: 0.375rem;
            /* 6px */
            padding-top: 0;
            padding-bottom: 0;
        }

        /* Cacher le bouton menu sur les grands écrans (quand le menu desktop est visible) */
        @media (min-width: 1024px) {
            #menu-btn {
                display: none !important;
            }
        }

        #menu-btn i.ri-menu-4-fill {
            display: flex;
            align-items: center;
            justify-content: center;
            vertical-align: middle;
            line-height: 1;
            margin: 0;
        }

        /* --- CSS INVISIBLE --- */
        .hacker-char {
            /* On n'impose RIEN qui puisse changer la taille */
            display: inline;
            background: none;
            outline: none;
            border: none;
            text-decoration: inherit;
            /* Héritage strict des styles parents */
            font-family: inherit;
            font-size: inherit;
            font-weight: inherit;
            color: inherit;
            line-height: inherit;
        }

        /* --- ANIMATIONS --- */
        @keyframes loading {
            0% {
                transform: scaleX(0);
            }

            50% {
                transform: scaleX(0.7);
            }

            100% {
                transform: scaleX(1);
            }
        }

        /* Animation simple pour l'apparition des étapes */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* --- ANIMATIONS TOAST (SLIDE RIGHT) --- */
        #vote-toast {
            /* Transition fluide pour l'entrée et la sortie */
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            /* Important : On s'assure qu'il est au-dessus de tout */
            z-index: 9999;
        }

        /* ÉTAT CACHÉ (Par défaut) : Poussé vers la droite hors de l'écran */
        .toast-hidden {
            transform: translateX(120%) !important;
            opacity: 0;
            /* Sécurité supplémentaire */
        }

        /* ÉTAT VISIBLE : Remis à sa place d'origine */
        .toast-visible {
            transform: translateX(0) !important;
            opacity: 1;
        }

        /* Masquer la scrollbar */
        .scrollbar-hide {
            -ms-overflow-style: none;
            /* IE and Edge */
            scrollbar-width: none;
            /* Firefox */
        }

        .scrollbar-hide::-webkit-scrollbar {
            display: none;
            /* Chrome, Safari and Opera */
        }

        /* ============================================
                        PACK ULTIMATE V3.0 - STYLES IMMERSIFS
                        ============================================ */

        /* --- TOOLTIP SYSTÈME V2 (OPTIMISÉ GPU) --- */
        #cursor-tooltip {
            position: fixed;
            /* Fixed pour ne pas dépendre du scroll */
            top: 0;
            left: 0;
            z-index: 200000;
            pointer-events: none;
            /* Crucial: laisse passer les clics au travers */

            /* Performance : On prévient le navigateur que ça va bouger */
            will-change: transform;

            /* Style visuel */
            background: rgba(0, 0, 0, 0.95);
            color: white;
            padding: 6px 10px;
            border: 1px solid var(--color-main);
            font-family: 'Space Grotesk', monospace;
            font-size: 10px;
            font-weight: bold;
            text-transform: uppercase;
            box-shadow: 4px 4px 0px rgba(0, 0, 0, 0.5);

            /* État initial : Caché & hors champ */
            opacity: 0;
            transform: translate3d(-100vw, -100vh, 0);
            transition: opacity 0.15s ease;

            /* Sécurité overflow */
            max-width: 250px;
            white-space: normal;
            line-height: 1.2;
        }

        /* --- SÉCURITÉ MOBILE --- */
        /* Désactive totalement le tooltip sur les appareils tactiles pour éviter les bugs */
        @media (hover: none) and (pointer: coarse) {
            #cursor-tooltip {
                display: none !important;
            }
        }

        /* Animation pulsation pour le solde quand il change */
        @keyframes pulse-green {
            0% {
                transform: scale(1);
                color: #22c55e;
            }

            50% {
                transform: scale(1.2);
                color: #4ade80;
            }

            100% {
                transform: scale(1);
                color: #22c55e;
            }
        }

        .balance-update {
            animation: pulse-green 0.5s ease-out;
        }
    </style>

    <!-- Schema.org JSON-LD pour SEO IA -->
    <script type="application/ld+json">
                    {
                        "@context": "https://schema.org",
                        "@type": "VideoGame",
                        "name": "ALBI RP",
                        "alternateName": "ALBI RP™",
                        "description": "Serveur de jeu de rôle (Roleplay) multijoueur basé sur Roblox, situé dans une reproduction fictive de la ville d'Albi, France. Serveur Whitelist avec économie réaliste, système de factions et mapping exclusif.",
                        "genre": ["Roleplay", "Simulation", "Action", "Multijoueur"],
                        "gamePlatform": ["PC", "Roblox"],
                        "applicationCategory": "Game",
                        "operatingSystem": "Windows, macOS, iOS, Android",
                        "keywords": "Roblox RP, FiveM, Albi, Roleplay, Serious RP, Whitelist, Serveur RP France",
                        "url": "https://albirp.com",
                        "image": "https://albirp.com/assets/banner-og.jpg",
                        "author": {
                            "@type": "Organization",
                            "name": "ALBI RP™ Staff",
                            "url": "https://albirp.com"
                        },
                        "offers": {
                            "@type": "Offer",
                            "price": "0",
                            "priceCurrency": "EUR",
                            "availability": "https://schema.org/InStock"
                        },
                        "potentialAction": {
                            "@type": "JoinAction",
                            "target": "https://discord.gg/eVn8pKYwQy",
                            "name": "Rejoindre le Discord ALBI RP"
                        },
                        "gameLocation": {
                            "@type": "Place",
                            "name": "Albi",
                            "addressRegion": "Occitanie",
                            "addressLocality": "Albi",
                            "addressCountry": "FR"
                        }
                    }
    </script>

    <!--  Schema.org JSON-LD pour FAQ -->
    <script type="application/ld+json">
                    {
                        "@context": "https://schema.org",
                        "@type": "FAQPage",
                        "mainEntity": [{
                            "@type": "Question",
                            "name": "Comment rejoindre le serveur ALBI RP™ ?",
                            "acceptedAnswer": {
                            "@type": "Answer",
                            "text": "Pour rejoindre ALBI RP, vous devez rejoindre notre Discord, lire le règlement V2.1 et passer un entretien oral (Whitelist). Les candidatures sont actuellement ouvertes. ALBI RP™ est un serveur Roblox Roleplay Whitelist basé sur la ville d'Albi en France."
                            }
                        }, {
                            "@type": "Question",
                            "name": "Est-ce que ALBI RP™ est un serveur Free Access ?",
                            "acceptedAnswer": {
                            "@type": "Answer",
                            "text": "Non, ALBI RP™ est un serveur Whitelist pour garantir un Roleplay Strict et qualitatif. Vous devez passer un entretien et être accepté pour jouer sur le serveur Roblox."
                            }
                        }, {
                            "@type": "Question",
                            "name": "Quels sont les métiers disponibles sur Albi RP ?",
                            "acceptedAnswer": {
                            "@type": "Answer",
                            "text": "Vous pouvez rejoindre la Police (LSPD), le SAMU, devenir Vigneron, Mécanicien au Benny's, ou rejoindre des organisations illégales comme le Syndicat. Le serveur propose une économie réaliste avec de nombreux métiers légaux et illégaux."
                            }
                        }, {
                            "@type": "Question",
                            "name": "ALBI RP™ est-il un serveur Roblox ou FiveM ?",
                            "acceptedAnswer": {
                            "@type": "Answer",
                            "text": "ALBI RP™ est un serveur Roblox Roleplay. Il s'agit d'une expérience de jeu de rôle multijoueur sur la plateforme Roblox, basée sur la ville d'Albi en Occitanie, France."
                            }
                        }]
                    }
    </script>
</head>

<body class="bg-brand-bg text-brand-text font-sans crt relative transition-colors duration-300">

    <div class="mt-6 text-center">
        <p
            class="text-white font-black bg-red-600 px-4 py-2 inline-block transform -rotate-1 border-2 border-white text-sm">
            TAP TO CLOSE X
        </p>
    </div>

    <!-- GÉNÉRATEUR QR CODE D'URGENCE -->
    <script>
            // --- GÉNÉRATEUR QR CODE D'URGENCE ---
            (function initEmergencyQR() {
                const qrImg = document.getElementById('rescue-qr');
                if (qrImg) {
                    // Utilisation de l'API publique goqr.me ou qrserver pour générer le QR sans librairie lourde
                    // On encode l'URL actuelle du site
                    const currentUrl = encodeURIComponent(window.location.href);
                    qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&margin=0&data=${currentUrl}`;
                }
            })();

        // --- GESTION DU ZOOM QR CODE ---
        function toggleQRFullscreen(show) {
            const overlay = document.getElementById('qr-overlay');
            const smallQr = document.getElementById('rescue-qr');
            const bigQr = document.getElementById('qr-fullscreen-img');

            if (show) {
                // 1. Copier la source du petit QR vers le grand
                if (smallQr && bigQr) {
                    bigQr.src = smallQr.src;
                }
                // 2. Afficher l'overlay
                overlay.classList.remove('hidden');
                overlay.classList.add('flex');
            } else {
                // 3. Cacher l'overlay
                overlay.classList.add('hidden');
                overlay.classList.remove('flex');
            }
        }

        // Fermer l'overlay au clic
        document.addEventListener('DOMContentLoaded', () => {
            const overlay = document.getElementById('qr-overlay');
            if (overlay) {
                overlay.addEventListener('click', () => {
                    toggleQRFullscreen(false);
                });
            }
        });
    </script>

    <!-- Preloader BIOS -->
    <div id="preloader">
        <h1 class="text-4xl md:text-6xl font-black text-white mb-2 tracking-tighter">ALBI<span
                class="text-brand-main">RP</span><span class="sr-only"> - Serveur Roblox Roleplay France Whitelist
                Serious RP</span></h1>
        <div class="terminal-text font-mono" id="loader-text">INITIALIZING SYSTEM...</div>
        <div class="loader-bar-container">
            <div class="loader-bar" id="loader-bar"></div>
        </div>
        <div class="mt-4 font-mono text-xs text-gray-500"><span id="version-label">v1.0.0</span> - <span id="env-tag">PROD</span></div>
        <script>
            (function() {
                // Environment Detection
                const isDev = ['localhost', '127.0.0.1'].includes(window.location.hostname) || window.location.hostname.endsWith('.local');
                if (isDev) {
                    const tag = document.getElementById('env-tag');
                    if (tag) tag.textContent = 'DEV';
                }

                // Version Animation (Decoding Effect)
                const target = 'v1.0.0';
                const label = document.getElementById('version-label');
                if (label) {
                    const chars = '0123456789VX.'; 
                    let iteration = 0;
                    const interval = setInterval(() => {
                        label.textContent = target.split('')
                            .map((char, index) => {
                                if (index < iteration) return target[index];
                                return chars[Math.floor(Math.random() * chars.length)];
                            })
                            .join('');
                        
                        if (iteration >= target.length) {
                            clearInterval(interval);
                            label.textContent = target; 
                        }
                        
                        iteration += 1/4; // Adjust speed here
                    }, 50);
                }
            })();
        </script>
    </div>

    <!-- Cursor SVG custom Neo-brutalist -->
    <div id="custom-cursor"
        class="fixed top-0 left-0 w-6 h-6 md:w-12 md:h-12 pointer-events-none z-[100000] mix-blend-difference -translate-x-1/2 -translate-y-1/2 transition-transform duration-75 ease-out flex items-center justify-center">
        <svg class="w-full h-full text-white animate-spin-slow" viewBox="0 0 100 100" fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <circle cx="50" cy="50" r="40" stroke="currentColor" stroke-width="2" stroke-dasharray="10 5" />
            <line x1="50" y1="0" x2="50" y2="20" stroke="currentColor" stroke-width="4" />
            <line x1="50" y1="80" x2="50" y2="100" stroke="currentColor" stroke-width="4" />
            <line x1="0" y1="50" x2="20" y2="50" stroke="currentColor" stroke-width="4" />
            <line x1="80" y1="50" x2="100" y2="50" stroke="currentColor" stroke-width="4" />
            <circle cx="50" cy="50" r="2" fill="currentColor" />
        </svg>
    </div>

    <!-- Immediate cursor initialization script (before DOMContentLoaded) -->
    <script>
        (function () {
            'use strict';

            // Initialisation immédiate du curseur (sans attendre DOMContentLoaded)
            let cursor = null;

            // Fonction pour initialiser le curseur
            function initCursor() {
                try {
                    cursor = document.getElementById('custom-cursor');
                    if (!cursor) {
                        // Retry après un court délai si le DOM n'est pas encore prêt
                        setTimeout(initCursor, 10);
                        return;
                    }

                    // Position initiale au centre de l'écran
                    if (typeof window !== 'undefined') {
                        const centerX = window.innerWidth / 2;
                        const centerY = window.innerHeight / 2;
                        cursor.style.left = centerX + 'px';
                        cursor.style.top = centerY + 'px';
                    }
                } catch (e) {
                    console.warn('Erreur initialisation curseur:', e);
                }
            }

            // Démarrer l'initialisation immédiatement
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initCursor);
            } else {
                initCursor();
            }

            // Écouter les mouvements de la souris - Mise à jour directe (pas d'interpolation pour réactivité)
            document.addEventListener('mousemove', function (e) {
                if (cursor) {
                    // Mise à jour directe pour réactivité maximale
                    cursor.style.left = e.clientX + 'px';
                    cursor.style.top = e.clientY + 'px';
                }

                // Mise à jour des coordonnées (système de tracking)
                const coordX = document.getElementById('coord-x');
                const coordY = document.getElementById('coord-y');
                if (coordX && coordY) {
                    coordX.innerText = `X: ${e.pageX.toFixed(0).padStart(4, '0')}`;
                    coordY.innerText = `Y: ${e.pageY.toFixed(0).padStart(4, '0')}`;
                }
            }, { passive: true });

            // Gestion des erreurs globales
            window.addEventListener('error', function (e) {
                // En cas d'erreur, s'assurer que le curseur système reste caché
                if (document.body) {
                    document.body.style.cursor = 'none';
                }
            });
        })();
    </script>

    <!-- Vote Toast -->
    <div id="vote-toast" class="fixed top-32 right-0 z-[110] toast-hidden opacity-0 pointer-events-none pr-4">
        <div
            class="bg-black border-l-8 border-brand-main text-white p-4 shadow-[8px_8px_0_rgba(0,0,0,0.5)] flex items-center gap-4 min-w-[300px]">
            <i class="ri-checkbox-circle-fill text-3xl text-brand-main"></i>
            <div>
                <h4 class="font-black uppercase text-brand-main leading-none">VOTE ENREGISTRÉ</h4>
                <p class="font-mono text-xs text-gray-400 mt-1">Redirection vers le bureau de vote...</p>
            </div>
        </div>
    </div>

    <!-- Navbar -->
    <nav class="fixed top-0 w-full z-50 border-b-4 border-black bg-brand-main transition-colors duration-300">
        <!-- Banner informations -->
        <div id="info-banner"
            class="relative bg-black text-white border-b-4 border-brand-main h-12 group overflow-hidden z-50">

            <div class="h-full flex items-center justify-center px-12 relative">
                <div id="banner-text"
                    class="font-mono text-xs md:text-sm font-bold tracking-wide text-center transition-opacity duration-200 opacity-100">
                </div>
            </div>

            <button id="btn-prev"
                class="absolute left-0 top-0 bottom-0 bg-brand-main text-black px-3 font-black text-xl opacity-0 group-hover:opacity-100 hover:bg-white transition-all duration-200 border-r-2 border-black -translate-x-full group-hover:translate-x-0 z-20 flex items-center justify-center">
                &lt;
            </button>

            <button id="btn-next"
                class="absolute right-0 top-0 bottom-0 bg-brand-main text-black px-3 font-black text-xl opacity-0 group-hover:opacity-100 hover:bg-white transition-all duration-200 border-l-2 border-black translate-x-full group-hover:translate-x-0 z-20 flex items-center justify-center">
                &gt;
            </button>

            <div class="absolute bottom-0 left-0 h-1 bg-brand-sec transition-all duration-[5000ms] ease-linear w-0"
                id="progress-bar"></div>
        </div>

        <!-- Script for the info banner -->
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                // --- CONFIGURATION DES MESSAGES ---
                const messages = [
                    {
                        tag: "OFFICIEL",
                        color: "bg-brand-main", // Jaune/Rouge selon le thème
                        text: "Site web officiel : <a href='https://albirp.com' class='underline decoration-2 underline-offset-2 hover:text-brand-sec'>albirp.com</a>"
                    },
                    {
                        tag: "WHITELIST",
                        color: "bg-neo-blue", // Cyan
                        text: "Les candidatures sont actuellement : <span class='text-neo-blue'>OUVERTES</span>"
                    },
                    {
                        tag: "EVENT",
                        color: "bg-neo-pink", // Rose
                        text: "Soirée illégale au 'Garage' ce soir à 21h00."
                    },
                    {
                        tag: "REBOOT",
                        color: "bg-red-600", // Rouge alerte
                        text: "Prochain tempête (Reboot) : 02h00 & 14h00."
                    }
                ];

                let currentIndex = 0;
                let interval;
                const displayTime = 5000; // Temps d'affichage en ms

                const bannerText = document.getElementById('banner-text');
                const btnPrev = document.getElementById('btn-prev');
                const btnNext = document.getElementById('btn-next');
                const progressBar = document.getElementById('progress-bar');
                const bannerContainer = document.getElementById('info-banner');

                // --- FONCTION D'AFFICHAGE ---
                function showMessage(index) {
                    // 1. Fade Out
                    bannerText.style.opacity = '0';
                    progressBar.style.width = '0%';
                    progressBar.style.transition = 'none'; // Reset immédiat

                    setTimeout(() => {
                        // 2. Changement du contenu
                        const msg = messages[index];
                        // Construction du HTML avec le Tag coloré style badge
                        bannerText.innerHTML = `
                                            <span class="${msg.color} text-black px-2 py-0.5 mr-2 border border-white text-[10px] shadow-[2px_2px_0px_white]">${msg.tag}</span>
                                            ${msg.text}
                                        `;

                        // 3. Fade In
                        bannerText.style.opacity = '1';

                        // 4. Animation Barre de progression
                        setTimeout(() => {
                            progressBar.style.transition = `width ${displayTime}ms linear`;
                            progressBar.style.width = '100%';
                        }, 50);

                    }, 200); // Délai court pour l'effet de clignotement
                }

                // --- NAVIGATION ---
                function nextMessage() {
                    currentIndex = (currentIndex + 1) % messages.length;
                    showMessage(currentIndex);
                }

                function prevMessage() {
                    currentIndex = (currentIndex - 1 + messages.length) % messages.length;
                    showMessage(currentIndex);
                }

                // --- AUTO PLAY ---
                function startAutoPlay() {
                    // Lance la barre de progression immédiatement
                    progressBar.style.transition = `width ${displayTime}ms linear`;
                    progressBar.style.width = '100%';

                    interval = setInterval(nextMessage, displayTime);
                }

                function stopAutoPlay() {
                    clearInterval(interval);
                    // Fige la barre de progression ou la reset
                    const computedWidth = window.getComputedStyle(progressBar).width;
                    progressBar.style.transition = 'none';
                    progressBar.style.width = computedWidth;
                }

                // --- EVENTS LISTENERS ---
                btnNext.addEventListener('click', () => {
                    stopAutoPlay(); // Stop pour laisser l'utilisateur lire
                    nextMessage();
                });

                btnPrev.addEventListener('click', () => {
                    stopAutoPlay();
                    prevMessage();
                });

                // Pause au survol de la souris
                bannerContainer.addEventListener('mouseenter', stopAutoPlay);
                bannerContainer.addEventListener('mouseleave', () => {
                    // Reprend le cycle
                    nextMessage();
                    startAutoPlay();
                });

                // --- INITIALISATION ---
                showMessage(currentIndex);
                startAutoPlay();
            });
        </script>

        <!-- Navbar Content -->
        <div class="flex justify-between items-center p-4">
            <!-- Logo Brand Name -->
            <a href="/" onclick="router('home'); return false;"
                class="font-bold text-2xl tracking-tighter border-2 border-black p-1 bg-white text-black shadow-hard-sm rotate-1 hover:scale-105 transition-transform z-50 relative">
                ALBI<span class="text-brand-sec">RP</span>
            </a>

            <!-- Navbar Links -->
            <div class="hidden lg:flex gap-6 font-bold uppercase tracking-widest">
                <a href="#" onclick="router('lore'); return false;"
                    class="hover:underline decoration-4 decoration-black underline-offset-4 nav-link">Lore</a>
                <a href="#" onclick="router('factions'); return false;"
                    class="hover:underline decoration-4 decoration-black underline-offset-4 nav-link">Gangs</a>
                <a href="#" onclick="router('events'); return false;"
                    class="hover:underline decoration-4 decoration-black underline-offset-4 nav-link">Events</a>
                <a href="#" onclick="router('rules'); return false;"
                    class="hover:underline decoration-4 decoration-black underline-offset-4 nav-link text-brand-text">Règlement</a>
                <a href="#" onclick="router('whitelist'); return false;"
                    class="hover:underline decoration-4 decoration-black underline-offset-4 nav-link">Whitelist</a>
            </div>

            <!-- Play (CTA) Button & Menu Burger -->
            <div class="flex items-center gap-2 md:gap-4">
                <!-- TODO: Widget Profil (Balance + Inventaire) -->

                <!-- Button Play -->
                <button onclick="window.open('https://discord.gg/eVn8pKYwQy', '_blank', 'noopener,noreferrer')"
                    class="flex items-center gap-2 bg-black text-white px-3 py-1.5 md:px-6 md:py-2 font-bold hover:bg-white hover:text-black border-2 border-black transition-all shadow-hard-sm hover:shadow-black-top-left group"
                    data-tooltip="Jouer dès maintenant">
                    <i class="ri-gamepad-fill text-xl md:hidden"></i>
                    <svg class="w-6 h-6 transition-transform group-hover:rotate-[15deg] hidden md:block"
                        viewBox="0 0 150 150" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M31.6984 0L0 118.302L118.302 150L150 31.6984L31.6984 0ZM87.1031 95.9652L54.0454 87.1031L62.9075 54.0454L95.9784 62.9075L87.1031 95.9652Z"
                            fill="currentColor" />
                    </svg>
                    <span class="hidden md:inline tracking-wider">JOUER</span>
                </button>

                <!-- Button Menu Burger -->
                <button id="menu-btn"
                    class="lg:hidden bg-white text-black px-1.5 border-2 border-black shadow-hard-sm active:translate-y-1 active:shadow-none transition-all flex items-center justify-center">
                    <i class="ri-menu-4-fill text-2xl"></i>
                </button>
            </div>
        </div>

        <!-- Mobile Menu -->
        <div id="mobile-menu"
            class="absolute top-[124px] left-0 w-full bg-black border-b-4 border-brand-main transform -translate-y-[150%] opacity-0 lg:hidden z-05 p-6 flex flex-col gap-4 shadow-2xl transition-all duration-300">
            <a href="#" onclick="router('lore'); toggleMenu(); return false;"
                class="text-white font-black text-2xl uppercase pl-4 border-l-4 border-transparent hover:border-brand-main hover:translate-x-2 transition-all">Lore</a>
            <a href="#" onclick="router('factions'); toggleMenu(); return false;"
                class="text-white font-black text-2xl uppercase pl-4 border-l-4 border-transparent hover:border-brand-sec hover:translate-x-2 transition-all">Gangs</a>
            <a href="#" onclick="router('events'); toggleMenu(); return false;"
                class="text-white font-black text-2xl uppercase pl-4 border-l-4 border-transparent hover:border-neo-blue hover:translate-x-2 transition-all">Events</a>
            <a href="#" onclick="router('socials'); toggleMenu(); return false;"
                class="text-white font-black text-2xl uppercase pl-4 border-l-4 border-transparent hover:border-neo-pink hover:translate-x-2 transition-all">Socials</a>
            <a href="#" onclick="router('rules'); toggleMenu(); return false;"
                class="text-white font-black text-2xl uppercase pl-4 border-l-4 border-transparent hover:border-green-500 hover:translate-x-2 transition-all">Règlement</a>
            <a href="#" onclick="router('whitelist'); toggleMenu(); return false;"
                class="text-white font-black text-2xl uppercase pl-4 border-l-4 border-transparent hover:border-green-500 hover:translate-x-2 transition-all">Whitelist</a>
            <a href="#" onclick="router('shop'); toggleMenu(); return false;"
                class="text-white font-black text-2xl uppercase pl-4 border-l-4 border-transparent hover:border-pink-500 hover:translate-x-2 transition-all">Boutique</a>
            <a href="#" onclick="router('vote'); toggleMenu(); return false;"
                class="text-white font-black text-2xl uppercase pl-4 border-l-4 border-transparent hover:border-neo-blue hover:translate-x-2 transition-all">Vote</a>
            <a href="#" onclick="router('socials'); toggleMenu(); return false;"
                class="text-white font-black text-2xl uppercase pl-4 border-l-4 border-transparent hover:border-neo-pink hover:translate-x-2 transition-all">Réseaux</a>
        </div>
    </nav>

    <!-- Marquee -->
    <div
        class="top-40 mt-20 border-b-4 border-black bg-brand-sec py-3 mb-10 overflow-hidden -rotate-1 w-[105%] -ml-2 z-40 relative transition-colors duration-300">
        <div id="infinite-marquee" class="flex whitespace-nowrap overflow-hidden">
            <div class="marquee-item font-bold text-xl uppercase tracking-widest px-4">
                // BIENVENUE À ALBI // VILLE COMPLÈTE // RP STRICT // ÉCONOMIE RÉALISTE // REJOIGNEZ LA RÉSISTANCE
                //
                #FROMTHETARN // LIBERTÉ
            </div>
        </div>
    </div>

    <!-- App Container -->
    <div id="app-container" class="pt-32 min-h-screen">

        <!-- Fil d'Ariane Terminal Intelligent -->
        <div
            class="absolute top-[160px] left-4 z-40 pointer-events-none hidden md:flex flex-col gap-1 mix-blend-difference max-w-[40vw] group">
            <div
                class="flex justify-between items-center bg-black text-white text-[10px] font-mono px-2 py-0.5 border border-white border-b-0 w-max pointer-events-auto opacity-0 translate-y-full overflow-hidden group-hover:opacity-100 group-hover:translate-y-0 transition-all duration-300 ease-in-out">
                <span id="terminal-status" class="text-green-500 animate-pulse">● SECURE_CONN</span>
                <span id="session-id" class="ml-4 opacity-50">SES: ...</span>
            </div>

            <div id="breadcrumb-terminal"
                class="font-mono text-sm font-bold bg-black text-white p-2 border border-white shadow-[4px_4px_0px_0px_white] pointer-events-auto transition-all duration-300 flex flex-wrap items-center gap-x-2">
                <span class="text-brand-main animate-pulse">INITIALIZING...</span>
            </div>
        </div>

        <!-- View Home -->
        <section id="view-home" class="view-section active">
            <header class=" flex flex-col justify-center items-center relative overflow-hidden px-4">
                <div class="relative z-10 py-20 text-center flex flex-col items-center">
                    <h2 class="text-2xl md:text-4xl font-bold bg-black text-white inline-block px-4 py-1 mb-4 rotate-2">
                        L'ULTIME EXPÉRIENCE <span class="inline md:hidden">RP</span><span
                            class="hidden md:inline">ROLEPLAY</span>
                    </h2>
                    <h1 class="text-7xl md:text-9xl font-black leading-none mb-6 tracking-tighter mix-blend-hard-light">
                        ALBI <span class="text-outline">RP</span>
                    </h1>
                    <p
                        class="text-xl md:text-3xl font-bold max-w-2xl mx-auto bg-white border-2 border-black p-4 shadow-hard transform -rotate-1">
                        La Cité Épiscopale est tombée. Construis ton empire sur les briques rouges.
                    </p>
                    <div class="mt-12 flex justify-center gap-4">
                        <button onclick="router('lore')"
                            class="px-8 py-4 bg-brand-main border-4 border-black font-black text-xl shadow-hard hover:translate-y-1 hover:shadow-none transition-all uppercase">
                            DÉCOUVRIR
                        </button>
                    </div>
                </div>
            </header>

            <div id="scroll-trigger"
                class="py-20 bg-black text-white text-center border-y-8 border-white relative overflow-hidden group cursor-pointer"
                onclick="router('factions')">
                <div
                    class="absolute inset-0 opacity-20 bg-[radial-gradient(#fff_2px,transparent_2px)] [background-size:20px_20px]">
                </div>
                <h2
                    class="text-6xl md:text-8xl font-black uppercase relative z-10 group-hover:scale-110 transition-transform">
                    VOIR LES <span class="text-brand-main">FACTIONS</span>
                </h2>
                <p class="mt-4 font-mono text-sm animate-pulse">CLIQUEZ POUR ACCÉDER À LA BASE DE DONNÉES</p>
            </div>
        </section>

        <!-- View Lore -->
        <section id="view-lore" class="view-section">
            <div class="max-w-7xl mx-auto px-4 py-10">
                <h1 class="text-8xl font-black mb-12 text-center uppercase leading-none">
                    ARCHIVES <span class="text-brand-main bg-black px-4">T.A.R.N</span>
                </h1>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
                    <div class="border-l-4 border-black pl-8 space-y-12">
                        <div class="relative">
                            <span class="absolute -left-12 bg-black text-white px-2 font-mono">2023</span>
                            <h3 class="text-4xl font-medieval mb-4 pl-8">L'Effondrement</h3>
                            <p class="text-lg bg-white p-4 border-2 border-black shadow-hard">
                                La crise économique a frappé l'Occitanie. Les usines ont fermé, la cathédrale
                                Sainte-Cécile est devenue un refuge pour les sans-abris avant d'être fortifiée par
                                l'Évêché militarisé.
                            </p>
                        </div>

                        <div class="relative">
                            <span class="absolute -left-12 bg-brand-main text-white px-2 font-mono">2024</span>
                            <h3 class="text-4xl font-medieval mb-4 pl-8">Le Mur de Briques</h3>
                            <p class="text-lg bg-white p-4 border-2 border-black shadow-hard">
                                Albi s'est isolée. Les ponts sur le Tarn sont devenus des checkpoints contrôlés par
                                des
                                factions rivales. Le "Vieux Pont" est désormais une zone neutre de marché noir.
                            </p>
                        </div>

                        <div class="relative">
                            <span class="absolute -left-12 bg-brand-sec text-white px-2 font-mono">2025</span>
                            <h3 class="text-4xl font-medieval mb-4 pl-8">L'Isolation</h3>
                            <p class="text-lg bg-white p-4 border-2 border-black shadow-hard">
                                Albi est devenue une ville-état. Les ponts sur le Tarn sont devenus des checkpoints
                                contrôlés par des factions rivales. Le "Vieux Pont" est désormais une zone neutre de
                                marché noir.
                            </p>
                        </div>

                        <div class="relative">
                            <span class="absolute -left-12 bg-neo-blue text-white px-2 font-mono">2026</span>
                            <h3 class="text-4xl font-medieval mb-4 pl-8">La Révolution</h3>
                            <p class="text-lg bg-white p-4 border-2 border-black shadow-hard">
                                Prenez les commandes d'Albi. En tant que maire, vos décisions façonnent le destin de
                                la
                                cité épiscopale. Chaque choix compte, chaque alliance forge l'avenir.
                            </p>
                        </div>
                    </div>

                    <div class="space-y-8">
                        <div
                            class="bg-black text-green-500 font-mono p-6 border-4 border-brand-main h-full overflow-hidden relative">
                            <div
                                class="absolute top-0 left-0 w-full h-full pointer-events-none opacity-20 bg-[repeating-linear-gradient(0deg,transparent,transparent_1px,#00ff00_1px,#00ff00_2px)]">
                            </div>
                            <h4 class="border-b border-green-500 mb-4 pb-2">TOP SECRET // CLASSIFIED</h4>
                            <p>> UPLOAD DATASOURCE: ALBI_CITY</p>
                            <p>> ECONOMY: UNSTABLE</p>
                            <p>> CRIME RATE: +400%</p>
                            <p>> MAYOR STATUS: <span class="bg-red-500 text-black px-1">MISSING</span></p>
                            <br>
                            <p class="animate-pulse">_WAITING FOR NEW CITIZEN...</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- View Factions -->
        <section id="view-factions" class="view-section">
            <div class="max-w-7xl mx-auto px-4 py-10">
                <div class="flex justify-between items-end mb-16 border-b-8 border-black pb-4">
                    <h1 class="text-6xl md:text-8xl font-black uppercase">GANGS & LOIS</h1>
                    <div class="hidden md:block text-right font-mono">
                        <div class="bg-brand-main px-2">TERRITOIRES: DISPUTÉS</div>
                        <div class="bg-black text-white px-2">POLICE: ACTIVE</div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="brutalist-card bg-white relative group overflow-hidden">
                        <div
                            class="absolute top-0 right-0 bg-blue-600 text-white font-bold px-3 py-1 border-l-2 border-b-2 border-black z-10">
                            LOI</div>
                        <div class="h-64 bg-blue-500 border-b-4 border-black flex items-center justify-center">
                            <span class="text-9xl">👮</span>
                        </div>
                        <div class="p-6">
                            <h3 class="text-4xl font-black mb-2">L.S.P.D</h3>
                            <p class="font-mono text-sm mb-4">Police Nationale d'Albi. Ils contrôlent le
                                centre-ville et
                                la Cathédrale.</p>
                            <div class="space-y-2 font-bold text-xs uppercase">
                                <div class="flex justify-between"><span class="bg-gray-200 px-1">Force</span>
                                    <span>9/10</span>
                                </div>
                                <div class="w-full bg-gray-200 h-2 border border-black">
                                    <div class="bg-blue-600 h-full w-[90%]"></div>
                                </div>
                                <div class="flex justify-between"><span class="bg-gray-200 px-1">Corruption</span>
                                    <span>2/10</span>
                                </div>
                                <div class="w-full bg-gray-200 h-2 border border-black">
                                    <div class="bg-red-600 h-full w-[20%]"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="brutalist-card bg-brand-bg relative group overflow-hidden">
                        <div
                            class="absolute top-0 right-0 bg-red-600 text-white font-bold px-3 py-1 border-l-2 border-b-2 border-black z-10">
                            CRIME</div>
                        <div class="h-64 bg-red-600 border-b-4 border-black flex items-center justify-center">
                            <span class="text-9xl">🩸</span>
                        </div>
                        <div class="p-6">
                            <h3 class="text-4xl font-black mb-2">LE SYNDICAT</h3>
                            <p class="font-mono text-sm mb-4">Basés à la Madeleine. Trafic d'armes artisanales et
                                contrebande de vin.</p>
                            <div class="space-y-2 font-bold text-xs uppercase">
                                <div class="flex justify-between"><span class="bg-gray-200 px-1">Force</span>
                                    <span>7/10</span>
                                </div>
                                <div class="w-full bg-gray-200 h-2 border border-black">
                                    <div class="bg-red-600 h-full w-[70%]"></div>
                                </div>
                                <div class="flex justify-between"><span class="bg-gray-200 px-1">Richesse</span>
                                    <span>10/10</span>
                                </div>
                                <div class="w-full bg-gray-200 h-2 border border-black">
                                    <div class="bg-brand-main h-full w-full"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="brutalist-card bg-white relative group overflow-hidden">
                        <div
                            class="absolute top-0 right-0 bg-brand-main text-black font-bold px-3 py-1 border-l-2 border-b-2 border-black z-10">
                            CIVIL</div>
                        <div class="h-64 bg-gray-800 border-b-4 border-black flex items-center justify-center">
                            <span class="text-9xl">🔧</span>
                        </div>
                        <div class="p-6">
                            <h3 class="text-4xl font-black mb-2">MÉCANOS</h3>
                            <p class="font-mono text-sm mb-4">Le Benny's du Tarn. Ils réparent les 4L et les Twingo
                                blindées.</p>
                            <button onclick="router('jobs')"
                                class="mt-4 w-full bg-black text-white py-2 font-bold hover:bg-brand-main hover:text-black border-2 border-transparent hover:border-black transition-colors cursor-pointer">
                                VOIR LES OFFRES D'EMPLOI
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- View Jobs -->
        <section id="view-jobs" class="view-section">
            <div class="max-w-7xl mx-auto px-4 py-10">
                <div class="flex flex-col md:flex-row justify-between items-end mb-16 border-b-8 border-black pb-4">
                    <h1 class="text-6xl md:text-8xl font-black uppercase">MÉTIERS & ÉCONOMIE RP</h1>
                    <div class="font-mono text-right md:text-right text-left mt-4 md:mt-0">
                        <div class="bg-brand-main px-2 text-black font-bold inline-block">CHÔMAGE: 12%</div>
                        <div class="bg-black text-white px-2 inline-block">SALAIRE MOYEN: 1500€</div>
                    </div>
                </div>

                <div class="flex gap-4 mb-8 overflow-x-auto pb-4 no-scrollbar" id="job-filters">
                    <button onclick="filterJobs('all', this)"
                        class="job-filter-btn bg-black text-white px-6 py-2 font-bold border-2 border-black hover:bg-brand-main hover:text-black transition-colors shrink-0">TOUS</button>
                    <button onclick="filterJobs('public', this)"
                        class="job-filter-btn bg-white text-black px-6 py-2 font-bold border-2 border-black hover:bg-brand-main hover:text-black transition-colors shrink-0">SERVICE
                        PUBLIC</button>
                    <button onclick="filterJobs('entreprise', this)"
                        class="job-filter-btn bg-white text-black px-6 py-2 font-bold border-2 border-black hover:bg-brand-main hover:text-black transition-colors shrink-0">ENTREPRISES</button>
                    <button onclick="filterJobs('interim', this)"
                        class="job-filter-btn bg-white text-black px-6 py-2 font-bold border-2 border-black hover:bg-brand-main hover:text-black transition-colors shrink-0">INTÉRIM</button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="jobs-grid">

                    <div class="job-card border-4 border-black bg-white p-0 relative group hover:-translate-y-2 transition-all duration-300"
                        data-category="public">
                        <div
                            class="h-40 bg-red-500 flex items-center justify-center border-b-4 border-black overflow-hidden relative">
                            <div class="absolute inset-0 opacity-20"
                                style="background-image: radial-gradient(white 2px, transparent 2px); background-size: 10px 10px;">
                            </div>
                            <i
                                class="ri-pulse-line text-8xl text-white group-hover:scale-110 transition-transform duration-300"></i>
                        </div>
                        <div class="p-6">
                            <div class="flex justify-between items-start mb-4">
                                <h3 class="text-2xl font-black uppercase">S.A.M.U</h3>
                                <span class="bg-black text-white px-2 py-1 text-xs font-mono">PUBLIC</span>
                            </div>
                            <p class="font-mono text-sm mb-6 h-16 text-gray-600">Sauvez des vies dans les rues
                                d'Albi.
                                Urgences, réanimations et patrouilles en hélico.</p>
                            <div class="flex justify-between items-center border-t-2 border-dashed border-black pt-4">
                                <span class="font-bold text-xs uppercase">SALAIRE HEBDO:</span>
                                <span class="bg-brand-main px-1 font-bold">1800€</span>
                            </div>
                        </div>
                    </div>

                    <div class="job-card border-4 border-black bg-white p-0 relative group hover:-translate-y-2 transition-all duration-300"
                        data-category="entreprise">
                        <div
                            class="h-40 bg-purple-800 flex items-center justify-center border-b-4 border-black overflow-hidden relative">
                            <i
                                class="ri-goblet-fill text-8xl text-white group-hover:rotate-12 transition-transform duration-300"></i>
                        </div>
                        <div class="p-6">
                            <div class="flex justify-between items-start mb-4">
                                <h3 class="text-2xl font-black uppercase">VIGNERON</h3>
                                <span class="bg-black text-white px-2 py-1 text-xs font-mono">PRIVÉ</span>
                            </div>
                            <p class="font-mono text-sm mb-6 h-16 text-gray-600">Exploitez les vignes de Gaillac.
                                Récolte, fermentation et vente de grands crus.</p>
                            <div class="flex justify-between items-center border-t-2 border-dashed border-black pt-4">
                                <span class="font-bold text-xs uppercase">REVENU:</span>
                                <span class="bg-brand-main px-1 font-bold">VARIABLE</span>
                            </div>
                        </div>
                    </div>

                    <div class="job-card border-4 border-black bg-white p-0 relative group hover:-translate-y-2 transition-all duration-300"
                        data-category="entreprise">
                        <div
                            class="h-40 bg-gray-800 flex items-center justify-center border-b-4 border-black overflow-hidden relative">
                            <i
                                class="ri-tools-fill text-8xl text-white group-hover:-rotate-12 transition-transform duration-300"></i>
                        </div>
                        <div class="p-6">
                            <div class="flex justify-between items-start mb-4">
                                <h3 class="text-2xl font-black uppercase">BENNY'S</h3>
                                <span class="bg-black text-white px-2 py-1 text-xs font-mono">PRIVÉ</span>
                            </div>
                            <p class="font-mono text-sm mb-6 h-16 text-gray-600">Customisation et réparation. De la
                                Twingo à la Ferrari, tout passe entre vos mains.</p>
                            <div class="flex justify-between items-center border-t-2 border-dashed border-black pt-4">
                                <span class="font-bold text-xs uppercase">SALAIRE HEBDO:</span>
                                <span class="bg-brand-main px-1 font-bold">2000€</span>
                            </div>
                        </div>
                    </div>

                    <div class="job-card border-4 border-black bg-white p-0 relative group hover:-translate-y-2 transition-all duration-300"
                        data-category="public">
                        <div
                            class="h-40 bg-yellow-400 flex items-center justify-center border-b-4 border-black overflow-hidden relative">
                            <i
                                class="ri-taxi-fill text-8xl text-black group-hover:translate-x-4 transition-transform duration-300"></i>
                        </div>
                        <div class="p-6">
                            <div class="flex justify-between items-start mb-4">
                                <h3 class="text-2xl font-black uppercase">ALBI CAB</h3>
                                <span class="bg-black text-white px-2 py-1 text-xs font-mono">SERVICE</span>
                            </div>
                            <p class="font-mono text-sm mb-6 h-16 text-gray-600">Transportez les citoyens.
                                Connaissance
                                parfaite de la ville requise.</p>
                            <div class="flex justify-between items-center border-t-2 border-dashed border-black pt-4">
                                <span class="font-bold text-xs uppercase">SALAIRE:</span>
                                <span class="bg-brand-main px-1 font-bold">1500€ + TIPS</span>
                            </div>
                        </div>
                    </div>

                    <div class="job-card border-4 border-black bg-white p-0 relative group hover:-translate-y-2 transition-all duration-300"
                        data-category="entreprise">
                        <div
                            class="h-40 bg-pink-600 flex items-center justify-center border-b-4 border-black overflow-hidden relative">
                            <i
                                class="ri-music-2-fill text-8xl text-white group-hover:scale-110 transition-transform duration-300"></i>
                        </div>
                        <div class="p-6">
                            <div class="flex justify-between items-start mb-4">
                                <h3 class="text-2xl font-black uppercase">UNICORN</h3>
                                <span class="bg-black text-white px-2 py-1 text-xs font-mono">NUIT</span>
                            </div>
                            <p class="font-mono text-sm mb-6 h-16 text-gray-600">Bar, ambiance et organisation de
                                soirées privées. Le cœur de la nuit.</p>
                            <div class="flex justify-between items-center border-t-2 border-dashed border-black pt-4">
                                <span class="font-bold text-xs uppercase">REVENU:</span>
                                <span class="bg-brand-main px-1 font-bold">COMMISSION</span>
                            </div>
                        </div>
                    </div>

                    <div class="job-card border-4 border-black bg-gray-100 p-0 relative group hover:-translate-y-2 transition-all duration-300"
                        data-category="interim">
                        <div
                            class="h-40 bg-green-500 flex items-center justify-center border-b-4 border-black overflow-hidden relative">
                            <i
                                class="ri-briefcase-4-fill text-8xl text-black group-hover:rotate-6 transition-transform duration-300"></i>
                        </div>
                        <div class="p-6">
                            <div class="flex justify-between items-start mb-4">
                                <h3 class="text-2xl font-black uppercase">INTÉRIM</h3>
                                <span class="bg-black text-white px-2 py-1 text-xs font-mono">LIBRE</span>
                            </div>
                            <p class="font-mono text-sm mb-6 h-16 text-gray-600">Mineur, Abatteur, Pêcheur.
                                Travaillez
                                quand vous voulez, payé à la tâche.</p>
                            <div class="flex justify-between items-center border-t-2 border-dashed border-black pt-4">
                                <span class="font-bold text-xs uppercase">PAIEMENT:</span>
                                <span class="bg-brand-main px-1 font-bold">INSTANTANÉ</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-16 bg-black text-white p-8 border-4 border-brand-main text-center shadow-hard">
                    <h2 class="text-3xl font-black uppercase mb-4 text-brand-main">VOTRE ENTREPRISE ICI ?</h2>
                    <p class="font-mono mb-6 max-w-2xl mx-auto">Les entrepreneurs peuvent soumettre leur dossier à
                        la
                        mairie pour ouvrir leur propre business. (Avocat, Immobilier, Tabac, Concessionnaire...)</p>
                    <button onclick="window.open('https://discord.gg/eVn8pKYwQy')"
                        class="bg-white text-black px-8 py-3 font-bold hover:bg-brand-main border-2 border-transparent hover:border-white transition-all uppercase cursor-pointer">
                        DÉPOSER UN DOSSIER
                    </button>
                </div>
            </div>
        </section>

        <!-- View Events -->
        <section id="view-events" class="view-section">
            <div class="max-w-7xl mx-auto px-4 py-10">

                <div id="event-header"
                    class="border-b-8 border-black pb-8 mb-12 relative overflow-hidden p-8 transition-colors duration-500">
                    <div id="event-pattern" class="absolute inset-0 opacity-10 pointer-events-none"></div>

                    <div class="relative z-10 flex flex-col md:flex-row justify-between items-end">
                        <div>
                            <span id="event-badge"
                                class="bg-black text-white px-4 py-1 font-mono font-bold uppercase mb-2 inline-block animate-pulse">
                                CHARGEMENT...
                            </span>
                            <h1 id="event-title"
                                class="text-6xl md:text-8xl font-black uppercase leading-none mix-blend-hard-light">
                                CALENDRIER
                            </h1>
                        </div>

                        <div class="text-right mt-6 md:mt-0">
                            <div class="font-mono text-sm opacity-70">PROCHAIN ÉVÉNEMENT MAJEUR DANS</div>
                            <div id="event-countdown" class="text-4xl font-black font-mono">00J 00H 00M</div>
                        </div>
                    </div>
                </div>

                <div id="active-event-card"
                    class="border-4 border-black bg-white p-0 mb-16 relative group shadow-hard transition-all duration-300">
                    <div class="absolute top-0 right-0 bg-red-600 text-white font-bold px-4 py-2 z-20 animate-bounce">
                        EN
                        COURS</div>

                    <div class="grid grid-cols-1 md:grid-cols-2 h-full">
                        <div id="event-hero-visual"
                            class="h-64 md:h-auto bg-black flex items-center justify-center relative overflow-hidden border-b-4 md:border-b-0 md:border-r-4 border-black">
                            <i id="event-hero-icon"
                                class="ri-calendar-event-fill text-9xl text-white relative z-10"></i>
                            <div
                                class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-30">
                            </div>
                        </div>

                        <div class="p-8 flex flex-col justify-center">
                            <h2 id="hero-title" class="text-4xl md:text-6xl font-black uppercase mb-4">AUCUN
                                ÉVÉNEMENT
                            </h2>
                            <p id="hero-desc" class="font-mono text-lg mb-8 border-l-4 pl-4 border-black">
                                La ville est calme... pour le moment. Préparez vos affaires, la prochaine tempête
                                arrive
                                bientôt.
                            </p>

                            <div class="grid grid-cols-2 gap-4 mb-8 font-mono text-sm">
                                <div>
                                    <span class="block opacity-50">DÉBUT</span>
                                    <span id="hero-start" class="font-bold text-xl">--/--</span>
                                </div>
                                <div>
                                    <span class="block opacity-50">FIN</span>
                                    <span id="hero-end" class="font-bold text-xl">--/--</span>
                                </div>
                            </div>

                            <button
                                class="bg-black text-white px-8 py-4 font-black uppercase hover:bg-white hover:text-black border-4 border-transparent hover:border-black transition-all flex items-center justify-center gap-3">
                                <i class="ri-ticket-fill"></i> PARTICIPER
                            </button>
                        </div>
                    </div>
                </div>

                <h3 class="text-3xl font-black uppercase mb-8 border-l-8 border-black pl-4">FUTURS PLANNINGS</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="upcoming-events-grid">
                </div>

                <div class="text-center mt-8 mb-16">
                    <button onclick="router('timeline')"
                        class="bg-white text-black px-8 py-3 border-4 border-black font-black uppercase hover:bg-black hover:text-white transition-all shadow-hard hover:shadow-none flex items-center justify-center gap-2 mx-auto">
                        <i class="ri-list-check"></i> VOIR LE CALENDRIER COMPLET DE L'ANNÉE
                    </button>
                </div>

                <div class="mt-16 bg-gray-100 border-4 border-black p-8 text-center relative overflow-hidden">
                    <div
                        class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500">
                    </div>
                    <h3 class="text-2xl font-black uppercase mb-2">ORGANISATEUR D'ÉVÉNEMENTS</h3>
                    <p class="font-mono text-sm mb-6 max-w-2xl mx-auto opacity-70">
                        Mariages, Bar-Mitsva, Enterrements de vie de garçon, Courses illégales privées...
                        Louez l'Unicorn ou le Vigneron pour vos soirées privées.
                    </p>
                    <button onclick="window.open('https://discord.gg/eVn8pKYwQy')"
                        class="border-2 border-black px-6 py-2 font-bold hover:bg-black hover:text-white transition-colors uppercase text-sm">
                        RÉSERVER UNE DATE
                    </button>
                </div>

            </div>
        </section>

        <!-- View Timeline -->
        <section id="view-timeline" class="view-section">
            <div class="max-w-7xl mx-auto px-4 py-10">
                <div class="text-center mb-12">
                    <button onclick="router('events')" class="mb-4 text-xs font-bold underline hover:text-brand-main">
                        < RETOUR AUX EVENTS</button>
                            <h1 class="text-5xl md:text-7xl font-black uppercase mb-2">CHRONOLOGIE <span
                                    class="text-brand-main">2026</span></h1>
                            <p class="font-mono text-gray-500">L'année complète à Albi RP.</p>
                </div>

                <div class="container mx-auto w-full">
                    <div class="relative wrap overflow-hidden p-4">
                        <div class="border-2-2 absolute border-opacity-20 border-black border"
                            style="left: 50%; top: 0; bottom: 0;"></div>
                        <div id="timeline-container"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- View Rules -->
        <section id="view-rules" class="view-section">
            <div class="max-w-5xl mx-auto px-4 py-10">
                <div class="border-4 border-brand-main p-8 relative bg-black">
                    <div
                        class="absolute -top-6 -right-6 bg-brand-main text-black px-6 py-2 text-xl font-bold border-2 border-white rotate-3">
                        V2.1 LÉGAL</div>

                    <h1 class="text-5xl md:text-7xl font-black mb-12 text-center uppercase text-white">CODE PÉNAL
                        <span class="text-brand-main">RP</span>
                    </h1>

                    <div class="mb-8 border-2 border-white flex relative group">
                        <div
                            class="bg-white text-black px-4 py-2 font-bold font-mono border-r-2 border-black flex items-center shrink-0">
                            <span id="search-rule-label" class="hidden md:inline">SEARCH_RULE.EXE</span>
                            <span class="md:hidden">SEARCH</span>
                        </div>

                        <input type="text" id="rule-search-input"
                            placeholder="Rechercher une infraction (ex: Metagaming)..."
                            class="w-full bg-black text-white px-4 py-2 font-mono focus:outline-none placeholder-gray-600 uppercase"
                            autocomplete="off">

                        <div id="search-clear"
                            class="hidden bg-black text-red-500 px-4 py-2 font-bold hover:bg-white cursor-pointer border-l border-white/20">
                            X</div>

                        <div id="search-btn"
                            class="bg-brand-main text-black px-4 py-2 font-bold flex items-center justify-center cursor-pointer hover:bg-white transition-colors">
                            ↵</div>
                    </div>

                    <div id="no-results" class="hidden border-2 border-red-500 bg-red-500/10 p-4 text-center mb-8">
                        <p class="text-red-500 font-mono font-bold">ERROR 404: AUCUNE RÈGLE TROUVÉE</p>
                        <p class="text-xs text-red-400 font-mono">Veuillez affiner vos critères de recherche.</p>
                    </div>

                    <div id="rules-grid" class="grid grid-cols-1 lg:grid-cols-2 gap-6 text-left font-mono text-sm">

                        <div class="lg:col-span-2 mb-4 flex items-center gap-4 rule-header" data-section="1">
                            <div class="h-1 bg-brand-main flex-grow"></div>
                            <h2 class="text-xl font-black bg-brand-main text-black px-2 transform -rotate-1">I.
                                FONDAMENTAUX</h2>
                            <div class="h-1 bg-brand-main flex-grow"></div>
                        </div>

                        <div class="rule-card border-2 border-white p-6 relative group hover:border-brand-main transition-all hover:bg-white/5"
                            data-section="1">
                            <div
                                class="absolute -top-3 left-4 bg-black px-2 text-brand-main font-bold border border-brand-main">
                                §1.0</div>
                            <div
                                class="absolute top-4 right-4 bg-red-600 text-white text-[10px] font-bold px-2 py-0.5 border border-white">
                                BAN 24H</div>

                            <h3 class="text-2xl font-bold text-white mb-2 group-hover:text-brand-main">FEAR RP
                                (Peur)
                            </h3>
                            <p class="text-gray-300 mb-4 leading-relaxed search-content">
                                La vie de votre personnage est précieuse. Vous devez simuler la peur de mourir en
                                toute
                                circonstance.
                            </p>
                            <div class="bg-white/10 p-3 border-l-2 border-brand-main text-xs search-content">
                                <span class="text-brand-main font-bold">> EXEMPLE :</span> Si une arme est braquée
                                sur
                                vous, vous ne sortez pas la vôtre. Vous obéissez aux ordres.
                            </div>
                        </div>

                        <div class="rule-card border-2 border-white p-6 relative group hover:border-brand-main transition-all hover:bg-white/5"
                            data-section="1">
                            <div
                                class="absolute -top-3 left-4 bg-black px-2 text-brand-main font-bold border border-brand-main">
                                §2.0</div>
                            <div
                                class="absolute top-4 right-4 bg-yellow-500 text-black text-[10px] font-bold px-2 py-0.5 border border-white">
                                AVERTISSEMENT</div>

                            <h3 class="text-2xl font-bold text-white mb-2 group-hover:text-brand-main">POWERGAMING
                            </h3>
                            <p class="text-gray-300 mb-4 leading-relaxed search-content">
                                Interdiction de réaliser des actions impossibles humainement ou de forcer le RP sans
                                laisser de chance à l'autre.
                            </p>
                            <div class="bg-white/10 p-3 border-l-2 border-brand-main text-xs search-content">
                                <span class="text-brand-main font-bold">> EXEMPLE :</span> Sauter d'un pont et
                                courir,
                                parler radio menotté, sortir un fusil d'assaut de son slip.
                            </div>
                        </div>

                        <div class="rule-card border-2 border-white p-6 relative group hover:border-brand-main transition-all hover:bg-white/5"
                            data-section="1">
                            <div
                                class="absolute -top-3 left-4 bg-black px-2 text-brand-main font-bold border border-brand-main">
                                §3.0</div>
                            <div
                                class="absolute top-4 right-4 bg-red-600 text-white text-[10px] font-bold px-2 py-0.5 border border-white">
                                BAN PERMANENT</div>

                            <h3 class="text-2xl font-bold text-white mb-2 group-hover:text-brand-main">METAGAMING
                            </h3>
                            <p class="text-gray-300 mb-4 leading-relaxed search-content">
                                Utilisation d'informations OOC (Discord, Stream) pour agir IC. Ce que vous savez,
                                votre
                                personnage ne le sait pas forcément.
                            </p>
                            <div class="bg-white/10 p-3 border-l-2 border-brand-main text-xs search-content">
                                <span class="text-brand-main font-bold">> EXEMPLE :</span> Rejoindre une position
                                vue
                                sur un live Twitch ou reconnaître quelqu'un à sa voix s'il est masqué.
                            </div>
                        </div>

                        <div class="rule-card border-2 border-white p-6 relative group hover:border-brand-main transition-all hover:bg-white/5"
                            data-section="1">
                            <div
                                class="absolute -top-3 left-4 bg-black px-2 text-brand-main font-bold border border-brand-main">
                                §4.0</div>

                            <h3 class="text-2xl font-bold text-white mb-2 group-hover:text-brand-main">MASS RP</h3>
                            <p class="text-gray-300 mb-4 leading-relaxed search-content">
                                Albi n'est pas vide. Vous devez considérer qu'il y a des habitants (PNJ) partout. On
                                ne
                                tire pas en pleine rue sans conséquence.
                            </p>
                        </div>


                        <div class="lg:col-span-2 my-4 flex items-center gap-4 rule-header" data-section="2">
                            <div class="h-1 bg-brand-main flex-grow"></div>
                            <h2 class="text-xl font-black bg-brand-main text-black px-2 transform rotate-1">II.
                                ZONES &
                                COMBAT</h2>
                            <div class="h-1 bg-brand-main flex-grow"></div>
                        </div>

                        <div class="rule-card lg:col-span-2 border-2 border-white p-6 relative group hover:border-brand-main transition-all hover:bg-white/5"
                            data-section="2">
                            <div
                                class="absolute -top-3 left-4 bg-black px-2 text-brand-main font-bold border border-brand-main">
                                §5.0</div>
                            <div
                                class="absolute top-4 right-4 bg-brand-main text-black text-[10px] font-bold px-2 py-0.5 border border-white">
                                SANCTUAIRE</div>
                            <h3 class="text-2xl font-bold text-white mb-4 group-hover:text-brand-main">ZONES
                                SÉCURISÉES
                                (SAFE)</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center mb-4">
                                <div class="bg-gray-900 border border-gray-700 p-2">
                                    <div class="text-2xl">🏥</div>
                                    <div class="font-bold text-xs mt-1">HÔPITAL</div>
                                </div>
                                <div class="bg-gray-900 border border-gray-700 p-2">
                                    <div class="text-2xl">👮</div>
                                    <div class="font-bold text-xs mt-1">COMMISSARIAT</div>
                                </div>
                                <div class="bg-gray-900 border border-gray-700 p-2">
                                    <div class="text-2xl">🔧</div>
                                    <div class="font-bold text-xs mt-1">GARAGE</div>
                                </div>
                            </div>
                            <p class="text-gray-300 text-sm search-content"><span
                                    class="text-red-500 font-bold">INTERDICTION TOTALE</span> de voler, tuer,
                                braquer ou
                                insulter dans ces zones.</p>
                        </div>

                        <div class="rule-card border-2 border-white p-6 relative group hover:border-brand-main transition-all hover:bg-white/5"
                            data-section="2">
                            <div
                                class="absolute -top-3 left-4 bg-black px-2 text-brand-main font-bold border border-brand-main">
                                §6.0</div>
                            <div
                                class="absolute top-4 right-4 bg-red-600 text-white text-[10px] font-bold px-2 py-0.5 border border-white">
                                WIPE</div>
                            <h3 class="text-2xl font-bold text-white mb-2 group-hover:text-brand-main">FREEKILL /
                                RDM
                            </h3>
                            <p class="text-gray-300 mb-4 leading-relaxed search-content">Tuer quelqu'un sans raison
                                RP
                                valable ou sans interaction verbale préalable est strictement interdit.</p>
                        </div>

                        <div class="rule-card border-2 border-white p-6 relative group hover:border-brand-main transition-all hover:bg-white/5"
                            data-section="2">
                            <div
                                class="absolute -top-3 left-4 bg-black px-2 text-brand-main font-bold border border-brand-main">
                                §7.0</div>
                            <h3 class="text-2xl font-bold text-white mb-2 group-hover:text-brand-main">CARKILL / VDM
                            </h3>
                            <p class="text-gray-300 mb-4 leading-relaxed search-content">Utiliser son véhicule comme
                                une
                                arme pour écraser des joueurs est interdit.</p>
                        </div>
                    </div>

                    <div
                        class="mt-8 border-t-2 border-dashed border-white pt-4 flex justify-between items-center opacity-70 font-mono text-xs">
                        <div>
                            DOCUMENT ID: #882-ALBI-LEGAL<br>
                            DERNIÈRE RÉVISION: 30/12/2025
                        </div>
                        <div class="text-right">
                            APPROUVÉ PAR:<br>
                            <span class="font-medieval text-xl">Le Maire d'Albi</span>
                        </div>
                    </div>

                    <div class="mt-12 text-center">
                        <button onclick="generateRulesPDF(this)"
                            class="bg-white text-black px-8 py-3 font-bold hover:bg-brand-main border-2 border-transparent hover:border-white transition-all uppercase flex items-center justify-center gap-2 mx-auto group">
                            <span>TÉLÉCHARGER LE PDF COMPLET</span>
                            <span class="group-hover:translate-y-1 transition-transform">↓</span>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- View Shop -->
        <section id="view-shop" class="view-section">
            <div class="max-w-7xl mx-auto px-4 py-10">
                <div class="flex flex-col md:flex-row justify-between items-end mb-8 border-b-4 border-white pb-4">
                    <div>
                        <h1 class="text-6xl md:text-8xl font-black uppercase text-white"
                            style="text-shadow: 4px 4px 0 #FF00F5, -4px -4px 0 #FF00F5, 4px -4px 0 #FF00F5, -4px 4px 0 #FF00F5;">
                            BLACK <span class="text-brand-main">MARKET</span>
                        </h1>
                        <p class="font-mono text-white mt-2 opacity-80">CRYPTOS ACCEPTÉES // PAIEMENT SÉCURISÉ</p>
                    </div>

                    <div id="wallet-widget" class="mt-4 md:mt-0">
                        <button onclick="connectWallet()" id="btn-wallet"
                            class="bg-black border-2 border-brand-main text-brand-main px-6 py-2 font-mono text-sm font-bold hover:bg-brand-main hover:text-black transition-all flex items-center gap-2 shadow-[4px_4px_0_white]"
                            data-tooltip="Connexion Smart Wallet (Multi-Chain)">
                            <span class="w-2 h-2 bg-red-500 rounded-full animate-pulse" id="wallet-dot"></span>
                            <span id="wallet-text">CONNECTER WALLET</span>
                        </button>
                    </div>
                </div>

                <div class="flex gap-4 mb-10">
                    <button onclick="switchShopTab('packs')" id="tab-packs"
                        class="shop-tab active bg-white text-black px-8 py-3 font-black uppercase border-4 border-transparent hover:border-brand-main transition-all skew-x-[-10deg]">
                        <span class="block skew-x-[10deg]">PACKS UNIQUES</span>
                    </button>
                    <button onclick="switchShopTab('subs')" id="tab-subs"
                        class="shop-tab bg-black border-2 border-white text-gray-400 px-8 py-3 font-black uppercase hover:border-brand-sec transition-all skew-x-[-10deg]">
                        <span class="block skew-x-[10deg]">ABONNEMENTS VIP</span>
                    </button>
                </div>

                <div id="shop-content-packs" class="shop-content grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div
                        class="border-4 border-white bg-black p-6 relative group hover:border-brand-main transition-colors">
                        <h3 class="text-3xl font-black text-white mb-4">STARTER</h3>
                        <div class="text-5xl font-bold text-brand-main mb-6">5€</div>
                        <ul class="text-white font-mono text-sm space-y-2 mb-8 border-t border-white/20 pt-4">
                            <li>+ 50,000€ IN-GAME</li>
                            <li>+ 1 Véhicule Import</li>
                            <li>+ Priorité File (Bronze)</li>
                        </ul>
                        <button onclick="openShopModal('STARTER PACK', '5€', 'one-time')"
                            class="w-full bg-white text-black py-3 font-bold hover:bg-brand-main uppercase border-2 border-transparent hover:border-black transition-all"
                            data-tooltip="Paiement via Stripe ou Crypto (ETH/SOL)">ACHETER</button>
                    </div>

                    <div
                        class="border-4 border-brand-sec bg-black p-6 relative transform md:-translate-y-4 shadow-[0_0_20px_rgba(255,0,245,0.3)]">
                        <div class="absolute top-0 right-0 bg-brand-sec text-black font-bold px-2 py-1 text-xs">
                            POPULAIRE</div>
                        <h3 class="text-3xl font-black text-white mb-4">KINGPIN</h3>
                        <div class="text-5xl font-bold text-brand-sec mb-6">15€</div>
                        <ul class="text-white font-mono text-sm space-y-2 mb-8 border-t border-white/20 pt-4">
                            <li>+ 200,000€ IN-GAME</li>
                            <li>+ 2 Véhicules Import</li>
                            <li>+ Création Gang Offerte</li>
                            <li>+ Priorité File (Gold)</li>
                        </ul>
                        <button onclick="openShopModal('KINGPIN PACK', '15€', 'one-time')"
                            class="w-full bg-brand-sec text-black py-3 font-bold hover:bg-white border-2 border-transparent hover:border-black transition-all"
                            data-tooltip="Paiement via Stripe ou Crypto (ETH/SOL)">ACHETER</button>
                    </div>

                    <div
                        class="border-4 border-white bg-black p-6 relative group hover:border-brand-main transition-colors">
                        <h3 class="text-3xl font-black text-white mb-4">CUSTOM</h3>
                        <div class="text-5xl font-bold text-brand-main mb-6">30€</div>
                        <ul class="text-white font-mono text-sm space-y-2 mb-8 border-t border-white/20 pt-4">
                            <li>+ Mapping Privé</li>
                            <li>+ Véhicule Unique</li>
                            <li>+ Ped Personnalisé</li>
                            <li>+ Priorité File (Platine)</li>
                        </ul>
                        <button onclick="openShopModal('CUSTOM PACK', '30€', 'one-time')"
                            class="w-full bg-white text-black py-3 font-bold hover:bg-brand-main uppercase border-2 border-transparent hover:border-black transition-all"
                            data-tooltip="Paiement via Stripe ou Crypto (ETH/SOL)">ACHETER</button>
                    </div>
                </div>

                <div id="shop-content-subs" class="shop-content hidden grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div
                        class="border-4 border-gray-500 bg-[#1a1a1a] p-6 relative opacity-80 hover:opacity-100 transition-all">
                        <div class="flex justify-between items-start">
                            <h3 class="text-2xl font-black text-white mb-2">CITOYEN+</h3>
                            <i class="ri-refresh-line text-white animate-spin-slow"></i>
                        </div>
                        <div class="text-4xl font-bold text-white mb-1">4.99€<span
                                class="text-xs font-mono text-gray-400">/MOIS</span></div>
                        <p class="font-mono text-xs text-gray-400 mb-6">Renouvellement automatique.</p>

                        <ul class="text-white font-mono text-sm space-y-3 mb-8">
                            <li class="flex items-center gap-2"><i class="ri-check-line text-green-500"></i> Double
                                XP
                                Métier</li>
                            <li class="flex items-center gap-2"><i class="ri-check-line text-green-500"></i> Salaire
                                Chômage x2</li>
                            <li class="flex items-center gap-2"><i class="ri-check-line text-green-500"></i> Emote
                                Pack
                                Exclusif</li>
                        </ul>
                        <button onclick="openShopModal('ABO CITOYEN+', '4.99€/mois', 'sub')"
                            class="w-full border-2 border-white text-white py-3 font-bold hover:bg-white hover:text-black uppercase transition-all"
                            data-tooltip="Renouvellement automatique">S'ABONNER</button>
                    </div>

                    <div
                        class="border-4 border-yellow-400 bg-black p-6 relative transform scale-105 shadow-[0_0_30px_rgba(250,204,21,0.2)] z-10">
                        <div
                            class="absolute -top-4 left-1/2 -translate-x-1/2 bg-yellow-400 text-black font-black px-4 py-1 skew-x-[-10deg]">
                            LE + VENDU</div>
                        <div class="flex justify-between items-start mt-2">
                            <h3 class="text-3xl font-black text-yellow-400 mb-2">MAFIA VIP</h3>
                            <i class="ri-vip-diamond-fill text-yellow-400 text-2xl"></i>
                        </div>
                        <div class="text-5xl font-bold text-white mb-1">9.99€<span
                                class="text-xs font-mono text-gray-400">/MOIS</span></div>

                        <ul class="text-white font-mono text-sm space-y-3 mb-8 mt-6">
                            <li class="flex items-center gap-2"><i class="ri-check-double-line text-yellow-400"></i>
                                <b>Tout du Citoyen+</b>
                            </li>
                            <li class="flex items-center gap-2"><i class="ri-check-line text-yellow-400"></i>
                                Priorité
                                File (GOLD)</li>
                            <li class="flex items-center gap-2"><i class="ri-check-line text-yellow-400"></i> 1
                                Véhicule
                                Import / mois</li>
                            <li class="flex items-center gap-2"><i class="ri-check-line text-yellow-400"></i> Accès
                                Salon VIP Discord</li>
                        </ul>
                        <button onclick="openShopModal('ABO MAFIA VIP', '9.99€/mois', 'sub')"
                            class="w-full bg-yellow-400 text-black py-4 font-black hover:bg-white uppercase transition-all shadow-[4px_4px_0_white]"
                            data-tooltip="Renouvellement automatique">S'ABONNER</button>
                    </div>

                    <div
                        class="border-4 border-neo-blue bg-[#0a0a1a] p-6 relative hover:border-white transition-colors">
                        <div class="flex justify-between items-start">
                            <h3 class="text-2xl font-black text-neo-blue mb-2">PATRON</h3>
                            <i class="ri-shield-star-fill text-neo-blue"></i>
                        </div>
                        <div class="text-4xl font-bold text-white mb-1">24.99€<span
                                class="text-xs font-mono text-gray-400">/MOIS</span></div>

                        <ul class="text-white font-mono text-sm space-y-3 mb-8 mt-6">
                            <li class="flex items-center gap-2"><i class="ri-check-double-line text-neo-blue"></i>
                                <b>Tout du Mafia VIP</b>
                            </li>
                            <li class="flex items-center gap-2"><i class="ri-check-line text-neo-blue"></i> Priorité
                                File (ULTIMATE)</li>
                            <li class="flex items-center gap-2"><i class="ri-check-line text-neo-blue"></i> Création
                                Entreprise Gratuite</li>
                            <li class="flex items-center gap-2"><i class="ri-check-line text-neo-blue"></i> Slot
                                Garage
                                Illimité</li>
                        </ul>
                        <button onclick="openShopModal('ABO PATRON', '24.99€/mois', 'sub')"
                            class="w-full border-2 border-neo-blue text-neo-blue py-3 font-bold hover:bg-neo-blue hover:text-black uppercase transition-all"
                            data-tooltip="Renouvellement automatique">S'ABONNER</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- View Vote -->
        <section id="view-vote" class="view-section">
            <div class="max-w-6xl mx-auto px-4 py-10">
                <div class="text-center mb-12">
                    <span class="bg-black text-brand-main px-4 py-1 font-mono font-bold animate-pulse">SOUTENEZ LE
                        SERVEUR</span>
                    <h1 class="text-6xl md:text-9xl font-black uppercase mt-4 leading-none text-outline"
                        style="-webkit-text-stroke: 3px black; color: black; text-shadow: -3px -3px 0 black, 3px -3px 0 black, -3px 3px 0 black, 3px 3px 0 black, 0 -3px 0 black, 0 3px 0 black, -3px 0 0 black, 3px 0 0 black;">
                        PROPAGANDE
                    </h1>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">

                    <div class="border-4 border-black p-8 bg-white shadow-hard relative">
                        <div
                            class="absolute -top-6 -left-6 bg-brand-main border-2 border-black p-4 font-black text-xl rotate-[-5deg]">
                            RÉCOMPENSES
                        </div>
                        <h3 class="text-3xl font-black mb-6 mt-4">POURQUOI VOTER ?</h3>
                        <ul class="space-y-4 font-mono font-bold">
                            <li class="flex items-center gap-4">
                                <span class="bg-black text-white w-8 h-8 flex items-center justify-center">1</span>
                                <span>500€ Cash (In-Game)</span>
                            </li>
                            <li class="flex items-center gap-4">
                                <span class="bg-black text-white w-8 h-8 flex items-center justify-center">2</span>
                                <span>XP de Réputation Civile</span>
                            </li>
                            <li class="flex items-center gap-4">
                                <span class="bg-black text-white w-8 h-8 flex items-center justify-center">3</span>
                                <span>Soutien au référencement</span>
                            </li>
                        </ul>
                        <div class="mt-8 border-t-4 border-black pt-4 text-center">
                            <p class="text-xs uppercase text-gray-700">Reset des votes tous les 1er du mois</p>
                        </div>
                    </div>

                    <div class="flex flex-col gap-6">
                        <a href="javascript:void(0)" onclick="handleVote('https://top-serveurs.net/gta/vote/albi-rp')"
                            class="block group relative">
                            <div
                                class="bg-black text-white border-4 border-black p-6 flex justify-between items-center transition-transform group-hover:-translate-y-2 group-hover:shadow-hard cursor-pointer">
                                <span class="text-3xl font-black group-hover:text-brand-main transition-colors">TOP
                                    SERVEUR</span>
                                <span class="text-4xl">➔</span>
                            </div>
                        </a>

                        <a href="javascript:void(0)" onclick="handleVote('https://trackyserver.com/server/albi-rp')"
                            class="block group relative">
                            <div
                                class="bg-brand-main text-black border-4 border-black p-6 flex justify-between items-center transition-transform group-hover:-translate-y-2 group-hover:shadow-hard cursor-pointer">
                                <span class="text-3xl font-black">TRACKY</span>
                                <span class="text-4xl">➔</span>
                            </div>
                        </a>

                        <a href="javascript:void(0)" onclick="handleVote('https://discord.gg/eVn8pKYwQy')"
                            class="block group relative">
                            <div
                                class="bg-white text-black border-4 border-black p-6 flex justify-between items-center transition-transform group-hover:-translate-y-2 group-hover:shadow-hard cursor-pointer">
                                <span class="text-3xl font-black">DISCORD VOTE</span>
                                <span class="text-4xl">➔</span>
                            </div>
                        </a>
                    </div>
                </div>

                <div class="mt-16 border-t-4 border-black pt-12">
                    <div class="flex items-center gap-4 mb-8">
                        <div class="w-4 h-4 bg-red-600 animate-pulse"></div>
                        <h2 class="text-4xl font-black uppercase">SONDAGES COMMUNAUTAIRES</h2>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8" id="polls-container">
                        <div class="border-4 border-black bg-white p-6 shadow-hard relative group" id="poll-gameplay">
                            <h3 class="font-bold text-xl mb-2 uppercase">PRIORITÉ DÉVELOPPEMENT</h3>
                            <p class="font-mono text-xs text-gray-500 mb-6">Sur quoi le staff doit-il se concentrer
                                ce
                                mois-ci ?</p>

                            <div class="space-y-4 poll-options">
                                <button onclick="voteManager.submit('gameplay', 'opt1')"
                                    class="w-full text-left border-2 border-black p-3 hover:bg-black hover:text-white transition-all font-mono font-bold flex justify-between group-btn">
                                    <span>OPTIMISATION FPS</span>
                                    <span class="opacity-0 group-btn-hover:opacity-100">+</span>
                                </button>
                                <button onclick="voteManager.submit('gameplay', 'opt2')"
                                    class="w-full text-left border-2 border-black p-3 hover:bg-brand-main hover:text-black transition-all font-mono font-bold flex justify-between group-btn">
                                    <span>NOUVEAUX VÉHICULES</span>
                                    <span class="opacity-0 group-btn-hover:opacity-100">+</span>
                                </button>
                            </div>

                            <div class="space-y-4 poll-results hidden">
                                <div>
                                    <div class="flex justify-between font-mono text-xs mb-1">
                                        <span>OPTIMISATION FPS</span>
                                        <span class="result-pct-1 font-bold">0%</span>
                                    </div>
                                    <div class="w-full h-4 border-2 border-black bg-gray-200">
                                        <div class="result-bar-1 h-full bg-black w-0 transition-all duration-1000">
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between font-mono text-xs mb-1">
                                        <span>NOUVEAUX VÉHICULES</span>
                                        <span class="result-pct-2 font-bold">0%</span>
                                    </div>
                                    <div class="w-full h-4 border-2 border-black bg-gray-200">
                                        <div class="result-bar-2 h-full bg-brand-main w-0 transition-all duration-1000">
                                        </div>
                                    </div>
                                </div>
                                <p class="text-center font-mono text-[10px] text-gray-400 mt-2">VOTE ENREGISTRÉ
                                    ANONYMEMENT</p>
                            </div>
                        </div>

                        <div class="border-4 border-black bg-white p-6 shadow-hard relative group" id="poll-economy">
                            <h3 class="font-bold text-xl mb-2 uppercase">ÉQUILIBRAGE ÉCONOMIE</h3>
                            <p class="font-mono text-xs text-gray-500 mb-6">Quel aspect de l'économie doit être revu
                                ?
                            </p>

                            <div class="space-y-4 poll-options">
                                <button onclick="voteManager.submit('economy', 'opt1')"
                                    class="w-full text-left border-2 border-black p-3 hover:bg-brand-sec hover:text-white transition-all font-mono font-bold flex justify-between group-btn">
                                    <span>BAISSE PRIX IMPORT</span>
                                    <span class="opacity-0 group-btn-hover:opacity-100">+</span>
                                </button>
                                <button onclick="voteManager.submit('economy', 'opt2')"
                                    class="w-full text-left border-2 border-black p-3 hover:bg-blue-600 hover:text-white transition-all font-mono font-bold flex justify-between group-btn">
                                    <span>HAUSSE SALAIRES LSPD</span>
                                    <span class="opacity-0 group-btn-hover:opacity-100">+</span>
                                </button>
                            </div>

                            <div class="space-y-4 poll-results hidden">
                                <div>
                                    <div class="flex justify-between font-mono text-xs mb-1">
                                        <span>BAISSE PRIX IMPORT</span>
                                        <span class="result-pct-1 font-bold">0%</span>
                                    </div>
                                    <div class="w-full h-4 border-2 border-black bg-gray-200">
                                        <div class="result-bar-1 h-full bg-brand-sec w-0 transition-all duration-1000">
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between font-mono text-xs mb-1">
                                        <span>HAUSSE SALAIRES</span>
                                        <span class="result-pct-2 font-bold">0%</span>
                                    </div>
                                    <div class="w-full h-4 border-2 border-black bg-gray-200">
                                        <div class="result-bar-2 h-full bg-blue-600 w-0 transition-all duration-1000">
                                        </div>
                                    </div>
                                </div>
                                <p class="text-center font-mono text-[10px] text-gray-400 mt-2">VOTE ENREGISTRÉ
                                    ANONYMEMENT</p>
                            </div>
                        </div>
                    </div>

                    <div class="mt-12 border-4 border-black bg-[#0C0C0C] p-4 font-mono text-xs shadow-hard">
                        <div class="flex justify-between items-center border-b border-gray-800 pb-2 mb-2">
                            <span class="text-green-500 font-bold">● SYSTEM_LOGS // SERVER_1</span>
                            <span class="text-gray-500">LIVE FEED</span>
                        </div>
                        <div id="server-logs"
                            class="h-40 overflow-y-auto space-y-1 text-gray-300 font-mono scrollbar-hide">
                            <div class="opacity-50">Initializing database connection... [OK]</div>
                            <div class="opacity-50">Loading vote tables... [OK]</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- View Socials -->
        <section id="view-socials" class="view-section">
            <div class="max-w-7xl mx-auto px-4 py-10">
                <div
                    class="border-b-4 border-brand-main pb-4 mb-12 flex flex-col md:flex-row justify-between items-end">
                    <h1 class="text-6xl md:text-8xl font-black uppercase text-white mix-blend-difference">
                        FLUX <span class="text-brand-main">DATA</span>
                    </h1>
                    <div class="font-mono text-brand-main text-right">
                        <p>STATUS: CONNECTED</p>
                        <p>ENCRYPTION: NONE</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

                    <a href="#" target="_blank"
                        class="group relative h-80 border-4 border-white bg-black overflow-hidden hover:bg-white transition-colors duration-300">
                        <div
                            class="absolute inset-0 opacity-20 bg-[url('https://www.transparenttextures.com/patterns/diagmonds-light.png')]">
                        </div>
                        <div class="absolute inset-0 flex flex-col justify-between p-6 z-10">
                            <div class="flex justify-between items-start">
                                <i
                                    class="ri-twitter-x-fill text-5xl text-white group-hover:text-black transition-colors duration-300"></i>
                                <span
                                    class="bg-white text-black px-2 font-bold text-xs font-mono py-1 group-hover:bg-black group-hover:text-white transition-colors">OFFICIAL</span>
                            </div>
                            <div>
                                <h3
                                    class="text-3xl font-black text-white mb-2 group-hover:text-black transition-colors duration-300">
                                    TWITTER</h3>
                                <p
                                    class="font-mono text-sm text-gray-400 group-hover:text-black/80 transition-colors duration-300">
                                    Suivez les annonces et les dramas.</p>
                            </div>
                            <div
                                class="absolute bottom-6 right-6 opacity-0 group-hover:opacity-100 transition-all duration-300 translate-y-4 group-hover:translate-y-0">
                                <i class="ri-arrow-right-up-line text-4xl text-black"></i>
                            </div>
                        </div>
                    </a>

                    <a href="#" target="_blank"
                        class="group relative h-80 border-4 border-brand-sec bg-black overflow-hidden hover:bg-brand-sec transition-colors duration-300">
                        <div
                            class="absolute inset-0 opacity-20 bg-[radial-gradient(circle,white,transparent_20%)] [background-size:20px_20px]">
                        </div>
                        <div class="absolute inset-0 flex flex-col justify-between p-6 z-10">
                            <div class="flex justify-between items-start">
                                <i
                                    class="ri-instagram-fill text-5xl text-brand-sec group-hover:text-white transition-colors duration-300"></i>
                                <span
                                    class="bg-brand-sec text-white px-2 font-bold text-xs font-mono py-1 group-hover:bg-white group-hover:text-brand-sec transition-colors">GALLERY</span>
                            </div>
                            <div>
                                <h3 class="text-3xl font-black text-white mb-2 transition-colors duration-300">
                                    INSTAGRAM
                                </h3>
                                <p
                                    class="font-mono text-sm text-gray-400 group-hover:text-white/90 transition-colors duration-300">
                                    Les plus beaux clichés de la ville.</p>
                            </div>
                            <div
                                class="absolute bottom-6 right-6 opacity-0 group-hover:opacity-100 transition-all duration-300 translate-y-4 group-hover:translate-y-0">
                                <i class="ri-arrow-right-up-line text-4xl text-white"></i>
                            </div>
                        </div>
                    </a>

                    <a href="#" target="_blank"
                        class="group relative h-80 border-4 border-brand-main bg-black overflow-hidden hover:bg-brand-main transition-colors duration-300">
                        <div class="absolute inset-0 opacity-10"
                            style="background: repeating-linear-gradient(0deg, transparent, transparent 2px, #fff 2px, #fff 4px);">
                        </div>
                        <div class="absolute inset-0 flex flex-col justify-between p-6 z-10">
                            <div class="flex justify-between items-start">
                                <i
                                    class="ri-tiktok-fill text-5xl text-brand-main group-hover:text-black transition-colors duration-300"></i>
                                <span
                                    class="bg-brand-main text-black px-2 font-bold text-xs font-mono py-1 group-hover:bg-black group-hover:text-brand-main transition-colors">CLIPS</span>
                            </div>
                            <div>
                                <h3
                                    class="text-3xl font-black text-white mb-2 group-hover:text-black transition-colors duration-300">
                                    TIKTOK</h3>
                                <p
                                    class="font-mono text-sm text-gray-400 group-hover:text-black/80 transition-colors duration-300">
                                    Best-of, fails et edits.</p>
                            </div>
                            <div
                                class="absolute bottom-6 right-6 opacity-0 group-hover:opacity-100 transition-all duration-300 translate-y-4 group-hover:translate-y-0">
                                <i class="ri-arrow-right-up-line text-4xl text-black"></i>
                            </div>
                        </div>
                    </a>

                    <a href="https://discord.gg/eVn8pKYwQy" target="_blank"
                        class="md:col-span-3 group relative h-64 md:h-72 border-4 border-[#5865F2] bg-black overflow-hidden hover:bg-[#5865F2] transition-colors duration-300">
                        <div
                            class="absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]">
                        </div>
                        <div
                            class="absolute inset-0 flex flex-col md:flex-row items-center justify-between p-8 md:p-12 z-10">
                            <div class="flex items-center gap-6 mb-6 md:mb-0">
                                <i
                                    class="ri-discord-fill text-7xl md:text-8xl text-[#5865F2] group-hover:text-white transition-colors duration-300"></i>
                                <div>
                                    <div class="flex items-center gap-3 mb-2">
                                        <h3 class="text-4xl md:text-5xl font-black text-white uppercase italic">
                                            DISCORD
                                        </h3>
                                        <span
                                            class="bg-[#5865F2] text-white px-3 py-1 font-bold text-xs font-mono group-hover:bg-white group-hover:text-[#5865F2] transition-colors">MAIN
                                            HUB</span>
                                    </div>
                                    <p
                                        class="font-mono text-sm md:text-lg text-gray-400 group-hover:text-white/90 max-w-xl">
                                        Rejoignez <span class="text-white font-bold group-hover:underline">15,000+
                                            membres</span>. Whitelist, tickets support & vocal.
                                    </p>
                                </div>
                            </div>
                            <div class="flex items-center">
                                <span
                                    class="hidden md:flex items-center justify-center w-16 h-16 border-4 border-[#5865F2] rounded-full group-hover:border-white group-hover:bg-white group-hover:text-[#5865F2] transition-all duration-300">
                                    <i
                                        class="ri-arrow-right-up-line text-3xl text-white group-hover:text-[#5865F2]"></i>
                                </span>
                            </div>
                        </div>
                    </a>

                    <a href="https://www.roblox.com/games/..." target="_blank"
                        class="md:col-span-2 group relative h-64 border-4 border-white bg-black overflow-hidden hover:bg-white transition-colors duration-300">
                        <div class="absolute inset-0 opacity-10"
                            style="background-image: radial-gradient(white 1px, transparent 1px); background-size: 20px 20px;">
                        </div>

                        <div class="absolute inset-0 flex flex-col justify-between p-8 z-10">
                            <div class="flex justify-between items-start">
                                <svg class="w-12 h-12 text-white group-hover:text-black transition-colors duration-300"
                                    viewBox="0 0 150 150" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M31.6984 0L0 118.302L118.302 150L150 31.6984L31.6984 0ZM87.1031 95.9652L54.0454 87.1031L62.9075 54.0454L95.9784 62.9075L87.1031 95.9652Z"
                                        fill="currentColor" />
                                </svg>
                                <div class="flex items-center gap-2">
                                    <span class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></span>
                                    <span
                                        class="bg-white text-black px-2 font-bold text-xs font-mono py-1 group-hover:bg-black group-hover:text-white transition-colors">LIVE
                                        STATUS</span>
                                </div>
                            </div>

                            <div class="flex justify-between items-end">
                                <div>
                                    <h3
                                        class="text-4xl font-black text-white mb-2 group-hover:text-black transition-colors duration-300">
                                        SERVEUR ROBLOX</h3>
                                    <p
                                        class="font-mono text-sm text-gray-400 group-hover:text-black/80 transition-colors duration-300">
                                        Rejoignez la ville d'Albi maintenant.</p>
                                </div>
                                <span
                                    class="bg-white text-black px-6 py-2 font-black uppercase text-sm border-2 border-transparent group-hover:border-black group-hover:bg-transparent group-hover:text-black transition-all">
                                    CONNECT
                                </span>
                            </div>
                        </div>
                    </a>

                    <a href="mailto:contact@albirp.com"
                        class="md:col-span-1 group relative h-64 border-4 border-gray-500 bg-black overflow-hidden hover:bg-gray-500 transition-colors duration-300">
                        <div
                            class="absolute inset-0 opacity-10 bg-[repeating-linear-gradient(45deg,transparent,transparent_10px,#ffffff_10px,#ffffff_12px)]">
                        </div>

                        <div class="absolute inset-0 flex flex-col justify-between p-8 z-10">
                            <div class="flex justify-between items-start">
                                <i
                                    class="ri-mail-send-fill text-5xl text-gray-500 group-hover:text-white transition-colors duration-300"></i>
                                <span
                                    class="bg-gray-500 text-white px-2 font-bold text-xs font-mono py-1 group-hover:bg-white group-hover:text-gray-500 transition-colors">SUPPORT</span>
                            </div>

                            <div>
                                <h3
                                    class="text-3xl font-black text-white mb-1 group-hover:text-white transition-colors duration-300">
                                    CONTACT</h3>
                                <p
                                    class="font-mono text-xs text-gray-400 group-hover:text-white/90 transition-colors duration-300">
                                    contact@albirp.com</p>
                            </div>
                        </div>
                    </a>

                </div>
            </div>
        </section>

        <!-- View Whitelist -->
        <section id="view-whitelist" class="view-section">
            <div class="max-w-4xl mx-auto px-4 py-10">
                <div
                    class="bg-black text-brand-main border-4 border-brand-main p-8 shadow-hard relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-full opacity-10 pointer-events-none"
                        style="background-image: repeating-linear-gradient(0deg, transparent, transparent 2px, #00FF00 2px, #00FF00 4px);">
                    </div>

                    <h1 class="text-5xl md:text-7xl font-black mb-8 text-center border-b-4 border-brand-main pb-4">
                        PROTOCOLE D'ENTRÉE</h1>

                    <div class="space-y-8 relative z-10">
                        <div class="flex gap-4 items-start">
                            <div
                                class="bg-brand-main text-black font-black text-2xl w-12 h-12 flex items-center justify-center border-2 border-brand-main shrink-0">
                                01</div>
                            <div>
                                <h3 class="text-2xl font-bold text-white mb-2">REJOINDRE LE DISCORD</h3>
                                <p class="font-mono text-sm text-white mb-2">L'accès au serveur nécessite une
                                    présence
                                    sur notre Discord.</p>
                                <a href="https://discord.gg/eVn8pKYwQy" target="_blank"
                                    class="inline-block bg-white text-black px-4 py-1 font-bold hover:bg-brand-sec hover:text-white transition-colors">CONNEXION
                                    ></a>
                            </div>
                        </div>

                        <div class="flex gap-4 items-start">
                            <div
                                class="bg-transparent text-brand-main font-black text-2xl w-12 h-12 flex items-center justify-center border-2 border-brand-main shrink-0">
                                02</div>
                            <div>
                                <h3 class="text-2xl font-bold text-white mb-2">LIRE LE RÈGLEMENT</h3>
                                <p class="font-mono text-sm text-white">Règlement Légal (V2.1) & Code Pénal.</p>
                            </div>
                        </div>

                        <div class="flex gap-4 items-start">
                            <div
                                class="bg-transparent text-brand-main font-black text-2xl w-12 h-12 flex items-center justify-center border-2 border-brand-main shrink-0">
                                03</div>
                            <div>
                                <h3 class="text-2xl font-bold text-white mb-2">ENTRETIEN ORAL</h3>
                                <p class="font-mono text-sm text-white">Passez en salle d'attente "Douane". Un
                                    membre du
                                    staff validera votre visa.</p>
                            </div>
                        </div>

                        <div class="mt-12 border-2 border-dashed border-brand-main p-4 text-center">
                            <p class="font-mono text-xs mb-2">ÉTAT ACTUEL DES CANDIDATURES</p>
                            <span
                                class="text-4xl font-black bg-brand-main text-black px-4 py-1 animate-pulse">OUVERTES</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Footer -->
    <footer class="border-t-8 border-black pt-20 pb-10 px-4 footer-contrast"
        style="background-color: var(--color-accent);">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-start">
            <div class="mb-10 md:mb-0">
                <h1 class="text-6xl font-medieval mb-4 footer-title">ALBI RP™</h1>
                <p class="max-w-xs font-mono text-sm footer-text">Made in Albi with ❤️</p>
            </div>
            <div class="grid grid-cols-2 gap-12 font-bold text-xl">
                <div class="flex flex-col gap-2">
                    <a href="#" onclick="router('rules'); return false;"
                        class="footer-link hover:translate-x-2 transition-transform">RÈGLEMENT</a>
                    <a href="#" onclick="router('shop'); return false;"
                        class="footer-link hover:translate-x-2 transition-transform">BOUTIQUE</a>
                    <a href="#" onclick="router('vote'); return false;"
                        class="footer-link hover:translate-x-2 transition-transform">VOTE</a>
                </div>
                <div class="flex flex-col gap-2">
                    <a href="#" onclick="router('whitelist'); return false;"
                        class="footer-link hover:translate-x-2 transition-transform">WHITELIST</a>
                    <a href="#" onclick="router('socials'); return false;"
                        class="footer-link hover:translate-x-2 transition-transform">COMMUNAUTÉ</a>
                    <a href="#" onclick="router('events'); return false;"
                        class="footer-link hover:translate-x-2 transition-transform">EVENTS</a>
                </div>
            </div>
        </div>
        <div class="mt-20 text-center font-mono text-xs footer-copyright">
            © <span id="copyright-year"></span> ALBI RP™. Tous droits réservés. Toute reproduction non autorisée est
            strictement interdite. <br>
            <span id="disclaimer-text" class="opacity-70">Projet indépendant, non affilié à la Ville d'Albi ni au
                Conseil Départemental du Tarn.</span>
        </div>

        <!-- Section Keyword Cluster pour SEO (Indexation longue traîne) -->
        <section class="py-8">
            <div class="max-w-7xl mx-auto text-gray-800">
                <h2 class="text-brand-main font-bold text-xs uppercase mb-4 tracking-widest">INDEXATION SYSTÈME &
                    RÉGIONS</h2>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 font-mono text-[10px] text-gray-500 leading-tight">
                    <div>
                        <strong class="text-gray-400 block mb-1">UNIVERS RP</strong>
                        Roblox Roleplay France<br>
                        Serveur Roblox Whitelist<br>
                        Serious RP FR<br>
                        Start RP Débutant<br>
                        Meilleur serveur Roblox 2026
                    </div>
                    <div>
                        <strong class="text-gray-400 block mb-1">LÉGAL & JOBS</strong>
                        Recrutement Police RP<br>
                        SAMU / EMS France<br>
                        Vigneron Roleplay<br>
                        Entreprise Roblox<br>
                        Avocat & Justice RP
                    </div>
                    <div>
                        <strong class="text-gray-400 block mb-1">ILLÉGAL & GANGS</strong>
                        Création Gang Roblox<br>
                        Drogues & Circuits<br>
                        Braquages Banques<br>
                        Organisations Criminelles<br>
                        Trafic Roblox RP
                    </div>
                    <div>
                        <strong class="text-gray-400 block mb-1">GÉOGRAPHIE (LORE)</strong>
                        Albi (Tarn)<br>
                        Occitanie Roleplay<br>
                        Toulouse RP<br>
                        Map Custom Française<br>
                        Cathédrale Sainte-Cécile 3D
                    </div>
                </div>
                <p class="mt-6 text-[9px] text-gray-600 text-justify">
                    ALBI RP™ est une expérience de jeu multijoueur immersive basée sur la plateforme Roblox. Ce
                    projet
                    n'est pas affilié à Roblox Corporation ni à la Ville d'Albi. Nous proposons une économie
                    réaliste
                    simulée, une police active (LSPD), des services de secours et un système de justice complet. Le
                    serveur intègre des scripts exclusifs pour une expérience "Serious RP" stricte. Rejoignez notre
                    communauté Discord pour postuler à la Whitelist. Compatible PC Windows, macOS, iOS et Android
                    via
                    Roblox. Optimisé pour la performance FPS et l'expérience utilisateur.
                </p>
            </div>
        </section>

        <!-- Section Brand Name -->
        <section class="py-8 mt-64">
            <!-- Logo Brand Name -->
            <div class="max-w-7xl mx-auto text-gray-800 flex items-center justify-center">
                <a
                    class="font-bold text-7xl md:text-8xl lg:text-9xl xl:text-[12rem] tracking-tighter border-8 border-black p-3 md:p-4 bg-white text-black rotate-1 shadow-hard-md z-50 relative cursor-none block">
                    ALBI<span class="text-brand-sec">RP</span>
                </a>
            </div>
            <!-- Created by -->
            <div class="flex items-center justify-center">
                <p class="mt-3 text-[6px] font-mono text-gray-600 opacity-70 tracking-widest uppercase">
                    CONÇU & DÉVELOPPÉ PAR <span class="font-bold">AÏSSA BELKOUSSA</span>
                </p>
            </div>
        </section>
    </footer>

    <!-- Script de logs -->
    <script>
        // --- SYSTÈME DE LOGS & DEBUG (BLACK BOX) ---
        const Debug = {
            // Activez ceci à 'true' manuellement ou tapez Debug.on() dans la console
            // Auto-ON si en local (file:// ou localhost)
            enabled: localStorage.getItem('ALBI_DEBUG') === 'true' || location.protocol === 'file:' || location.hostname === 'localhost' || location.hostname === '127.0.0.1',

            on: function () {
                localStorage.setItem('ALBI_DEBUG', 'true');
                this.enabled = true;
                console.log("🟢 [SYSTEM] DEBUG MODE ACTIVÉ (Rechargement...)");
                location.reload();
            },

            off: function () {
                localStorage.removeItem('ALBI_DEBUG');
                this.enabled = false;
                console.log("🔴 [SYSTEM] DEBUG MODE DÉSACTIVÉ");
                location.reload();
            },

            log: function (component, message, data = null) {
                if (!this.enabled) return;
                const time = new Date().toISOString().split('T')[1].slice(0, -1); // HH:MM:SS.mmm
                const css = "background: #222; color: #bada55; border-radius: 3px; padding: 2px 5px; font-weight: bold";

                if (data) {
                    console.groupCollapsed(`%c[${time}] [${component}] ${message}`, css);
                    console.log("DATA DUMP:", data);
                    console.groupEnd();
                } else {
                    console.log(`%c[${time}] [${component}] ${message}`, css);
                }
            },

            error: function (component, message, err) {
                const time = new Date().toISOString().split('T')[1].slice(0, -1);
                const css = "background: #500; color: #fff; border-radius: 3px; padding: 2px 5px; font-weight: bold";
                console.error(`%c[${time}] [${component}] 🛑 ${message}`, css, err);
            }
        };

        // Message de bienvenue console pour savoir que le système est là
        console.log("%c ALBI RP™ SYSTEM V2.5 READY ", "background:black; color: white; font-size: 12px; border: 2px solid #D6FF00; padding: 5px;");
        if (!Debug.enabled) console.log("ℹ️ Tapez 'Debug.on()' pour activer les logs détaillés.");

        // --- CONFIGURATION AVANCÉE DU FIL D'ARIANE ---
        const breadcrumbConfig = {
            'home': {
                path: ['ROOT'],
                cmd: 'init_sequence.exe',
                color: 'text-brand-main',
                status: 'ONLINE'
            },
            'lore': {
                path: ['ROOT', 'ARCHIVES', 'T.A.R.N_HISTORY'],
                cmd: 'decrypt_data --force',
                color: 'text-albi-red',
                status: 'RESTRICTED'
            },
            'factions': {
                path: ['ROOT', 'DATABASE', 'GANGS_V2'],
                cmd: 'fetch_criminals -all',
                color: 'text-brand-sec',
                status: 'WARNING'
            },
            'jobs': {
                path: ['ROOT', 'CITY', 'EMPLOYMENT_CENTER'],
                cmd: 'list_jobs -available',
                color: 'text-brand-sec',
                status: 'OPEN'
            },
            'rules': {
                path: ['ROOT', 'SYSTEM', 'PENAL_CODE'],
                cmd: 'read_legal.doc',
                color: 'text-white',
                status: 'READ_ONLY'
            },
            'shop': {
                path: ['ROOT', 'NETWORK', 'BLACK_MARKET'],
                cmd: 'buy_crypto -trace',
                color: 'text-neo-pink',
                status: 'ENCRYPTED'
            },
            'whitelist': {
                path: ['ROOT', 'SYSTEM', 'ENTRY_PROTOCOL'],
                cmd: 'sudo user_add',
                color: 'text-green-500',
                status: 'ADMIN'
            },
            'vote': {
                path: ['ROOT', 'PUBLIC', 'BALLOT_BOX'],
                cmd: 'submit_vote.exe',
                color: 'text-neo-blue',
                status: 'PUBLIC'
            },
            'socials': {
                path: ['ROOT', 'NETWORK', 'SATELLITE_FEED'],
                cmd: 'connect_stream',
                color: 'text-brand-main',
                status: 'LIVE'
            },
            'events': {
                path: ['ROOT', 'CITY', 'CALENDAR'],
                cmd: 'sync_time --server',
                color: 'text-purple-500',
                status: 'SYNCED'
            },
            'timeline': {
                path: ['ROOT', 'CITY', 'CALENDAR', 'FULL_YEAR'],
                cmd: 'cat year_2026.log',
                color: 'text-brand-main',
                status: 'ARCHIVE'
            }
        };

        // --- SYSTÈME D'ÉVÉNEMENTS V6 (CORRECTIF AFFICHAGE COMPLET) ---
        const eventSystem = {
            calendar: [
                {
                    id: 'new_year',
                    title: "BONNE ANNÉE 2026",
                    desc: "C'est ce soir ! Feux d'artifice, XP doublé et alcool gratuit à l'Unicorn.",
                    icon: "ri-goblet-fill",
                    theme: { main: '#FFD700', sec: '#FFFFFF', bg: '#000000' },
                    start: { month: 11, day: 31 }, end: { month: 0, day: 5 }
                },
                {
                    id: 'epiphany',
                    title: "GALETTE DES ROIS",
                    desc: "Trouvez la fève, devenez le Roi. Attention aux indigestions.",
                    icon: "ri-vip-crown-fill",
                    theme: { main: '#F59E0B', sec: '#FCD34D', bg: '#FFFBEB' },
                    start: { month: 0, day: 6 }, end: { month: 0, day: 20 }
                },
                {
                    id: 'valentine',
                    title: "SAINT-VALENTIN",
                    desc: "Mariages gratuits à la Mairie et réductions au Black Market.",
                    icon: "ri-heart-pulse-fill",
                    theme: { main: '#E11D48', sec: '#FDA4AF', bg: '#FFF1F2' },
                    start: { month: 1, day: 10 }, end: { month: 1, day: 16 }
                },
                {
                    id: 'ramadan',
                    title: "NUITS DU RAMADAN",
                    desc: "Iftar géant place du Vigan tous les soirs.",
                    icon: "ri-moon-clear-fill",
                    theme: { main: '#FFD700', sec: '#1E3A8A', bg: '#0F172A' },
                    start: { month: 1, day: 17 }, end: { month: 2, day: 19 }
                },
                {
                    id: 'easter',
                    title: "CHASSE DE PÂQUES",
                    desc: "Œufs de contrebande cachés dans toute la ville.",
                    icon: "ri-plant-fill",
                    theme: { main: '#10B981', sec: '#FDE047', bg: '#ECFCCB' },
                    start: { month: 3, day: 1 }, end: { month: 3, day: 10 } // Date corrigée 2026
                },
                {
                    id: 'music_day',
                    title: "FÊTE DE LA MUSIQUE",
                    desc: "Scènes ouvertes, Battle Rap et Sound System.",
                    icon: "ri-music-2-fill",
                    theme: { main: '#3B82F6', sec: '#EC4899', bg: '#111827' },
                    start: { month: 5, day: 20 }, end: { month: 5, day: 22 }
                },
                {
                    id: 'summer',
                    title: "SUMMER HEATWAVE",
                    desc: "Beach party sur le Tarn. Tenue légère exigée.",
                    icon: "ri-sun-fill",
                    theme: { main: '#F59E0B', sec: '#EF4444', bg: '#FEF3C7' },
                    start: { month: 6, day: 1 }, end: { month: 7, day: 31 }
                },
                {
                    id: 'back_to_school',
                    title: "LA RENTRÉE",
                    desc: "Nouveaux jobs & Recrutements massifs en ville.",
                    icon: "ri-school-fill",
                    theme: { main: '#3B82F6', sec: '#F59E0B', bg: '#EFF6FF' },
                    start: { month: 8, day: 1 }, end: { month: 8, day: 15 }
                },
                {
                    id: 'halloween',
                    title: "HALLOWEEN",
                    desc: "Zombies, Citrouilles et Climat Apocalyptique.",
                    icon: "ri-ghost-fill",
                    theme: { main: '#EA580C', sec: '#7C3AED', bg: '#290505' },
                    start: { month: 9, day: 20 }, end: { month: 10, day: 3 }
                },
                {
                    id: 'christmas',
                    title: "NOËL",
                    desc: "Neige sur la map et Cadeaux quotidiens.",
                    icon: "ri-gift-2-fill",
                    theme: { main: '#DC2626', sec: '#15803D', bg: '#F0F9FF' },
                    start: { month: 11, day: 1 }, end: { month: 11, day: 26 }
                }
            ],

            defaultEvent: {
                id: 'default',
                title: "SAISON RÉGULIÈRE",
                desc: "Guerre de territoires en cours. Rejoignez une faction.",
                icon: "ri-building-2-fill",
                theme: { main: '#D6FF00', sec: '#000000', bg: '#FFFFFF' }
            },

            isDateInRange: (current, start, end) => {
                const cM = current.getMonth();
                const cD = current.getDate();
                if (start.month <= end.month) {
                    return (cM > start.month || (cM === start.month && cD >= start.day)) &&
                        (cM < end.month || (cM === end.month && cD <= end.day));
                } else {
                    return (cM > start.month || (cM === start.month && cD >= start.day)) ||
                        (cM < end.month || (cM === end.month && cD <= end.day));
                }
            },

            init: function () {
                const now = new Date();
                let activeEvent = this.defaultEvent;

                for (const event of this.calendar) {
                    if (this.isDateInRange(now, event.start, event.end)) {
                        activeEvent = event;
                        break;
                    }
                }

                // Force le rendu immédiat
                this.render(activeEvent);
                this.renderUpcoming(now);
                this.startCountdown(now);
            },

            render: function (event) {
                // Éléments du Header
                const header = document.getElementById('event-header');
                const badge = document.getElementById('event-badge');
                const title = document.getElementById('event-title');

                // Éléments de la Carte Principale (C'est ICI que ça manquait)
                const heroIcon = document.getElementById('event-hero-icon');
                const heroTitle = document.getElementById('hero-title');
                const heroDesc = document.getElementById('hero-desc'); // AJOUTÉ
                const heroStart = document.getElementById('hero-start'); // AJOUTÉ
                const heroEnd = document.getElementById('hero-end');     // AJOUTÉ

                const activeCard = document.getElementById('active-event-card');
                const heroVisual = document.getElementById('event-hero-visual');

                if (!header) return;

                // 1. Mise à jour du Header
                header.style.backgroundColor = event.theme.main;
                if (badge) {
                    badge.style.backgroundColor = event.theme.sec;
                    badge.style.color = event.theme.sec === '#000000' ? 'white' : 'black';
                    badge.innerText = `SAISON : ${event.id.toUpperCase()}`;
                }
                if (title) title.innerText = event.title;

                // 2. Mise à jour de la Carte Principale
                if (heroTitle) heroTitle.innerText = event.title;
                if (heroDesc) heroDesc.innerText = event.desc;
                if (heroIcon) heroIcon.className = `${event.icon} text-9xl text-white relative z-10`;

                // 3. Mise à jour des dates
                if (heroStart && event.id !== 'default') {
                    heroStart.innerText = `${event.start.day}/${String(event.start.month + 1).padStart(2, '0')}`;
                } else if (heroStart) heroStart.innerText = "--/--";

                if (heroEnd && event.id !== 'default') {
                    heroEnd.innerText = `${event.end.day}/${String(event.end.month + 1).padStart(2, '0')}`;
                } else if (heroEnd) heroEnd.innerText = "--/--";

                // 4. Styles visuels
                if (activeCard && heroVisual) {
                    if (event.id !== 'default') {
                        activeCard.style.borderColor = event.theme.sec;
                        heroVisual.style.backgroundColor = event.theme.sec;
                    } else {
                        activeCard.style.borderColor = 'black';
                        heroVisual.style.backgroundColor = 'black';
                    }
                }
            },

            renderUpcoming: function (now) {
                const grid = document.getElementById('upcoming-events-grid');
                if (!grid) return;
                grid.innerHTML = '';

                let upcoming = this.calendar.filter(evt => {
                    return !this.isDateInRange(now, evt.start, evt.end);
                }).slice(0, 3);

                upcoming.forEach(evt => {
                    const html = `
                                        <div class="border-4 border-black p-4 bg-white hover:-translate-y-1 hover:shadow-hard transition-all duration-300 group">
                                            <div class="flex justify-between items-center mb-4">
                                                <div class="w-12 h-12 flex items-center justify-center bg-black text-white group-hover:bg-[${evt.theme.main}] group-hover:text-black transition-colors border-2 border-black">
                                                    <i class="${evt.icon} text-2xl"></i>
                                                </div>
                                                <span class="font-mono text-xs font-bold bg-gray-200 px-2 py-1">SOON</span>
                                            </div>
                                            <h4 class="font-black text-xl uppercase mb-1 leading-none">${evt.title}</h4>
                                            <div class="w-full h-1 bg-black my-2"></div>
                                            <p class="text-xs font-mono font-bold text-gray-500">
                                                DÉBUT : ${evt.start.day}/${String(evt.start.month + 1).padStart(2, '0')}
                                            </p>
                                        </div>
                                    `;
                    grid.innerHTML += html;
                });
            },

            startCountdown: function (now) {
                const display = document.getElementById('event-countdown');
                if (!display) return;

                let nextEvent = null;
                let minDiff = Infinity;

                this.calendar.forEach(evt => {
                    let evtDate = new Date(now.getFullYear(), evt.start.month, evt.start.day);
                    if (evtDate < now) evtDate.setFullYear(now.getFullYear() + 1);

                    const diff = evtDate - now;
                    if (diff > 0 && diff < minDiff) {
                        minDiff = diff;
                        nextEvent = evtDate;
                    }
                });

                if (!nextEvent) return;

                const update = () => {
                    const current = new Date();
                    const diff = nextEvent - current;

                    if (diff <= 0) {
                        display.innerText = "EN COURS";
                        return;
                    }

                    const d = Math.floor(diff / (1000 * 60 * 60 * 24));
                    const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));

                    display.innerText = `${String(d).padStart(2, '0')}J ${String(h).padStart(2, '0')}H ${String(m).padStart(2, '0')}M`;
                };

                setInterval(update, 1000);
                update();
            },

            renderTimeline: function () {
                const container = document.getElementById('timeline-container');
                if (!container) return;
                container.innerHTML = '';

                const sorted = [...this.calendar].sort((a, b) => {
                    if (a.start.month === b.start.month) {
                        return a.start.day - b.start.day;
                    }
                    return a.start.month - b.start.month;
                });

                sorted.forEach((evt, index) => {
                    const isLeft = index % 2 === 0;
                    const monthName = new Date(2025, evt.start.month).toLocaleString('fr-FR', { month: 'long' });

                    const html = `
                                        <div class="mb-8 flex justify-between items-center w-full ${isLeft ? 'flex-row-reverse' : ''}">
                                            <div class="order-1 w-5/12"></div>
                                            <div class="z-20 flex items-center order-1 bg-black shadow-xl w-8 h-8 rounded-full border-4 border-white">
                                                <h1 class="mx-auto font-semibold text-lg text-white"></h1>
                                            </div>
                                            <div class="order-1 bg-white border-4 border-black shadow-hard rounded-none w-5/12 px-6 py-4 hover:scale-105 transition-transform duration-300 group">
                                                <div class="flex items-center gap-3 mb-2">
                                                    <div class="bg-[${evt.theme.main}] p-2 border-2 border-black text-white group-hover:text-black">
                                                        <i class="${evt.icon}"></i>
                                                    </div>
                                                    <h3 class="mb-1 font-bold text-gray-800 text-xl uppercase">${evt.title}</h3>
                                                </div>
                                                <p class="text-sm leading-snug tracking-wide text-gray-900 text-opacity-100 font-mono mb-2">${evt.desc}</p>
                                                <span class="bg-black text-white text-[10px] font-bold px-2 py-1 uppercase">${monthName}</span>
                                            </div>
                                        </div>
                                    `;
                    container.innerHTML += html;
                });

                const lockedHtml = `
                                    <div class="mt-24 relative w-full group" style="z-index: 50;">
                                        <div class="text-center opacity-80 transition-all duration-500 bg-gray-200 border-t-4 border-black border-dashed pt-8" style="filter: blur(5px);">
                                            <div class="inline-block bg-black text-white px-4 py-1 font-mono text-xs mb-4">SEASON 2027</div>
                                            <div class="border-4 border-black border-dashed p-10 bg-white mx-auto max-w-3xl">
                                                <h2 class="text-5xl font-black uppercase text-gray-400 mb-4">CLASSIFIED CONTENT</h2>
                                                <p class="font-mono text-gray-500 text-lg">PLAY TO UNLOCK FUTURE EVENTS</p>
                                                <div class="mt-8 space-y-3 opacity-30">
                                                    <div class="h-4 bg-black w-2/3 mx-auto"></div>
                                                    <div class="h-4 bg-black w-1/2 mx-auto"></div>
                                                    <div class="h-4 bg-black w-3/4 mx-auto"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="absolute inset-0 z-[60] flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none">
                                            <div class="bg-red-600 text-white font-black text-xl px-8 py-4 border-4 border-black transform -rotate-3 shadow-hard animate-bounce">
                                                🚫 ACCESS DENIED: PLAY FIRST
                                            </div>
                                        </div>
                                        <div class="absolute inset-0 z-[70] cursor-not-allowed"></div>
                                    </div>
                                `;
                container.innerHTML += lockedHtml;
            }
        };

        // --- DÉTECTION OS & ADAPTATION DES EXTENSIONS (.exe -> .sh/.apk/.ipa/.app) ---
        (function adaptExtensionsToOS() {
            const userAgent = navigator.userAgent.toLowerCase();
            const platform = navigator.platform.toLowerCase();
            let ext = { lower: '.exe', upper: '.EXE' }; // Défaut (Windows)

            // Détection
            if (userAgent.includes('mac') || platform.includes('mac')) {
                // macOS : préférer .app pour l'immersion native, fallback .sh pour terminal
                ext = { lower: '.app', upper: '.APP' }; // macOS (Application native)
            } else if (userAgent.includes('linux') || platform.includes('linux')) {
                ext = { lower: '.sh', upper: '.SH' }; // Linux (Terminal style)
            } else if (userAgent.includes('android')) {
                ext = { lower: '.apk', upper: '.APK' }; // Android
            } else if (userAgent.includes('iphone') || userAgent.includes('ipad') || userAgent.includes('ipod')) {
                ext = { lower: '.ipa', upper: '.IPA' }; // iOS
            }

            // 1. Mise à jour de la configuration du Fil d'Ariane (breadcrumbConfig)
            // On parcourt toutes les clés de l'objet pour remplacer .exe
            for (const key in breadcrumbConfig) {
                if (breadcrumbConfig[key].cmd && breadcrumbConfig[key].cmd.includes('.exe')) {
                    breadcrumbConfig[key].cmd = breadcrumbConfig[key].cmd.replace('.exe', ext.lower);
                }
            }

            // 2. Mise à jour du DOM (Barre de recherche règlement)
            // On attend que le DOM soit prêt au cas où ce script tourne avant le chargement complet
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', () => {
                    const searchLabel = document.getElementById('search-rule-label');
                    if (searchLabel) {
                        searchLabel.textContent = searchLabel.textContent.replace('.EXE', ext.upper);
                    }
                });
            } else {
                // DOM déjà chargé
                const searchLabel = document.getElementById('search-rule-label');
                if (searchLabel) {
                    searchLabel.textContent = searchLabel.textContent.replace('.EXE', ext.upper);
                }
            }
        })();

        // Fonction de génération d'empreinte numérique du navigateur
        async function generateBrowserFingerprint() {
            const fingerprint = [];

            // 1. User-Agent
            fingerprint.push(navigator.userAgent || '');

            // 2. Résolution d'écran
            fingerprint.push(`${screen.width}x${screen.height}x${screen.colorDepth}`);

            // 3. Timezone
            fingerprint.push(Intl.DateTimeFormat().resolvedOptions().timeZone || '');
            fingerprint.push(new Date().getTimezoneOffset().toString());

            // 4. Langue
            fingerprint.push(navigator.language || '');
            fingerprint.push(navigator.languages ? navigator.languages.join(',') : '');

            // 5. Platform
            fingerprint.push(navigator.platform || '');

            // 6. Hardware Concurrency
            fingerprint.push(navigator.hardwareConcurrency?.toString() || '');

            // 7. Device Memory (si disponible)
            fingerprint.push(navigator.deviceMemory?.toString() || '');

            // 8. Canvas Fingerprinting
            try {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                if (ctx) {
                    canvas.width = 200;
                    canvas.height = 50;
                    ctx.textBaseline = 'top';
                    ctx.font = '14px Arial';
                    ctx.fillStyle = '#f60';
                    ctx.fillRect(125, 1, 62, 20);
                    ctx.fillStyle = '#069';
                    ctx.fillText('ALBI RP™ Fingerprint', 2, 15);
                    ctx.fillStyle = 'rgba(102, 204, 0, 0.7)';
                    ctx.fillText('ALBI RP™ Fingerprint', 4, 17);
                    fingerprint.push(canvas.toDataURL());
                }
            } catch (e) {
                fingerprint.push('canvas-error');
            }

            // 9. WebGL Fingerprinting
            try {
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                if (gl) {
                    const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                    if (debugInfo) {
                        fingerprint.push(gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL));
                        fingerprint.push(gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL));
                    }
                    fingerprint.push(gl.getParameter(gl.VERSION));
                    fingerprint.push(gl.getParameter(gl.SHADING_LANGUAGE_VERSION));
                }
            } catch (e) {
                fingerprint.push('webgl-error');
            }

            // 10. AudioContext Fingerprinting
            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                if (AudioContext) {
                    const context = new AudioContext();
                    const oscillator = context.createOscillator();
                    const analyser = context.createAnalyser();
                    const gainNode = context.createGain();
                    const scriptProcessor = context.createScriptProcessor(4096, 1, 1);

                    gainNode.gain.value = 0;
                    oscillator.connect(analyser);
                    analyser.connect(scriptProcessor);
                    scriptProcessor.connect(gainNode);
                    gainNode.connect(context.destination);
                    oscillator.start(0);

                    const audioFingerprint = [];
                    scriptProcessor.onaudioprocess = (e) => {
                        const input = e.inputBuffer.getChannelData(0);
                        let sum = 0;
                        for (let i = 0; i < input.length; i++) {
                            sum += Math.abs(input[i]);
                        }
                        audioFingerprint.push(sum.toString());
                    };

                    // Attendre un court instant pour collecter les données audio
                    await new Promise(resolve => setTimeout(resolve, 100));

                    oscillator.stop();
                    context.close();
                    fingerprint.push(audioFingerprint.join(','));
                }
            } catch (e) {
                fingerprint.push('audio-error');
            }

            // 11. Plugins
            if (navigator.plugins) {
                const plugins = [];
                for (let i = 0; i < navigator.plugins.length; i++) {
                    plugins.push(navigator.plugins[i].name);
                }
                fingerprint.push(plugins.join(','));
            }

            // 12. MIME Types
            if (navigator.mimeTypes) {
                const mimeTypes = [];
                for (let i = 0; i < navigator.mimeTypes.length; i++) {
                    mimeTypes.push(navigator.mimeTypes[i].type);
                }
                fingerprint.push(mimeTypes.join(','));
            }

            // 13. Fonts disponibles (échantillonnage)
            const testFonts = ['Arial', 'Verdana', 'Times New Roman', 'Courier New', 'Helvetica', 'Comic Sans MS'];
            const fontFingerprint = [];
            const testString = 'mmmmmmmmmmlli';
            const testSize = '72px';
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            if (ctx) {
                const baselineWidths = {};
                ctx.font = `${testSize} monospace`;
                baselineWidths['monospace'] = ctx.measureText(testString).width;

                for (const font of testFonts) {
                    ctx.font = `${testSize} ${font}, monospace`;
                    const width = ctx.measureText(testString).width;
                    fontFingerprint.push(`${font}:${width}`);
                }
                fingerprint.push(fontFingerprint.join(','));
            }

            // 14. LocalStorage et SessionStorage (capacité)
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                fingerprint.push('localStorage:ok');
            } catch (e) {
                fingerprint.push('localStorage:blocked');
            }

            try {
                sessionStorage.setItem('test', 'test');
                sessionStorage.removeItem('test');
                fingerprint.push('sessionStorage:ok');
            } catch (e) {
                fingerprint.push('sessionStorage:blocked');
            }

            // 15. Do Not Track
            fingerprint.push(navigator.doNotTrack || 'unknown');

            // 16. Cookie enabled
            fingerprint.push(navigator.cookieEnabled ? 'cookies:enabled' : 'cookies:disabled');

            // 17. Online status
            fingerprint.push(navigator.onLine ? 'online' : 'offline');

            // 18. Battery API (si disponible)
            try {
                if (navigator.getBattery) {
                    const battery = await navigator.getBattery();
                    fingerprint.push(`battery:${battery.level}-${battery.charging}`);
                }
            } catch (e) {
                fingerprint.push('battery:unavailable');
            }

            // Combiner toutes les données et générer un hash
            const fingerprintString = fingerprint.join('|');

            // Fonction de hash simple mais efficace (djb2-like)
            let hash = 5381;
            for (let i = 0; i < fingerprintString.length; i++) {
                hash = ((hash << 5) + hash) + fingerprintString.charCodeAt(i);
                hash = hash & hash; // Convertir en 32-bit integer
            }

            // Prendre les 6 premiers caractères hexadécimaux et formater
            const hexHash = Math.abs(hash).toString(16).toUpperCase().padStart(6, '0').substring(0, 6);
            return '0x' + hexHash;
        }

        // Génération d'un ID de session basé sur l'empreinte numérique du navigateur
        generateBrowserFingerprint().then(sessionID => {
            const sessionIdElement = document.getElementById('session-id');
            if (sessionIdElement) {
                sessionIdElement.textContent = `SES: ${sessionID}`;
            }
            // Stocker l'ID dans sessionStorage pour persistance
            try {
                sessionStorage.setItem('albi_session_id', sessionID);
            } catch (e) {
                // Ignorer si sessionStorage n'est pas disponible
            }
        }).catch(() => {
            // Fallback en cas d'erreur
            const fallbackID = '0x' + Math.floor(Math.random() * 16777215).toString(16).toUpperCase().padStart(6, '0');
            const sessionIdElement = document.getElementById('session-id');
            if (sessionIdElement) {
                sessionIdElement.textContent = `SES: ${fallbackID}`;
            }
        });

        // Variable pour stocker le timeout de l'effet machine à écrire (pour pouvoir l'annuler si on change de page vite)
        let typingInterval = null;

        function updateBreadcrumb(viewId) {
            Debug.log("BREADCRUMB", `Mise à jour demandée pour: ${viewId}`);
            const container = document.getElementById('breadcrumb-terminal');
            const statusLabel = document.getElementById('terminal-status');

            if (!container) {
                Debug.error("BREADCRUMB", "Conteneur introuvable ! Abandon.");
                return;
            }

            const config = breadcrumbConfig[viewId] || breadcrumbConfig['home'];

            // 1. Mise à jour du Status (Sécurité Visuelle)
            if (statusLabel) {
                statusLabel.textContent = `● ${config.status}`;
                // Change la couleur du point selon le contexte
                statusLabel.className = viewId === 'lore' || viewId === 'factions' ? 'text-red-500 animate-pulse' : 'text-green-500 animate-pulse';
            }

            // 2. Nettoyage sécurisé du conteneur (Pas de innerHTML global)
            container.innerHTML = ''; // Vide le conteneur

            // 3. Ajout du User (Non cliquable)
            const userSpan = document.createElement('span');
            userSpan.className = 'opacity-50 select-none mr-2';
            userSpan.textContent = 'USER@ALBIRP:~';
            container.appendChild(userSpan);

            // 4. Construction du chemin (DOM Building)
            config.path.forEach((step, index) => {
                const isLast = index === config.path.length - 1;

                // Séparateur (sauf pour le premier élément si tu veux, mais ici on suit le style dossier)
                const slash = document.createElement('span');
                slash.className = 'text-gray-500 mx-1';
                slash.textContent = '/';
                container.appendChild(slash);

                if (step === 'ROOT') {
                    // Lien HOME interactif
                    const link = document.createElement('a');
                    link.href = "#";
                    link.className = "hover:underline hover:text-brand-main cursor-pointer pointer-events-auto transition-colors";
                    link.textContent = "HOME";
                    link.onclick = (e) => { e.preventDefault(); router('home'); };
                    container.appendChild(link);
                } else if (isLast) {
                    // Dossier courant (Coloré + Animé)
                    const current = document.createElement('span');
                    // Utilisation sécurisée des classes via template string
                    current.className = `${config.color} font-bold`;
                    current.textContent = step;
                    container.appendChild(current);
                } else {
                    // Dossiers parents (Texte simple)
                    const parent = document.createElement('span');
                    parent.textContent = step;
                    container.appendChild(parent);
                }
            });

            // 5. Effet Machine à écrire pour la commande (Visual Candy)
            // On crée un conteneur pour la commande
            const cmdContainer = document.createElement('span');
            cmdContainer.className = "ml-4 opacity-50 border-l border-white pl-2 italic text-xs hidden lg:inline-block whitespace-nowrap overflow-hidden";
            cmdContainer.textContent = "$ "; // Prompt de départ
            container.appendChild(cmdContainer);

            // Annule l'animation précédente si elle tourne encore
            if (typingInterval) clearInterval(typingInterval);

            let charIndex = 0;
            const cmdText = config.cmd;

            // Fonction d'écriture
            typingInterval = setInterval(() => {
                if (charIndex < cmdText.length) {
                    cmdContainer.textContent += cmdText.charAt(charIndex);
                    charIndex++;
                } else {
                    clearInterval(typingInterval);
                    typingInterval = null;
                    // Ajout d'un curseur clignotant à la fin
                    const cursor = document.createElement('span');
                    cursor.className = "animate-pulse font-bold";
                    cursor.textContent = "█";
                    cmdContainer.appendChild(cursor);
                }
            }, 30); // Vitesse de frappe (ms)

            // 6. Effet de "Recul" (Feedback physique)
            container.style.transform = 'scale(0.98)';
            container.style.opacity = '0.8';
            setTimeout(() => {
                container.style.transform = 'scale(1)';
                container.style.opacity = '1';
            }, 150);
        }

        // --- ROUTER & NAVIGATION ---
        // Variable pour éviter les boucles infinies lors de la navigation
        let isNavigating = false;

        // Fonction utilitaire pour obtenir la vue actuelle depuis l'URL
        function getCurrentView() {
            const hash = window.location.hash.slice(1);
            if (hash && breadcrumbConfig[hash]) {
                return hash;
            }
            return 'home';
        }

        function router(viewId, skipHistory = false) {
            Debug.log("ROUTER", `Navigation vers -> ${viewId}`, { skipHistory });

            if (isNavigating) {
                Debug.log("ROUTER", "🚫 Navigation annulée (Déjà en cours)");
                return;
            }
            isNavigating = true;

            // --- PATCH JS : Forcer la fermeture du toast si on change de page ---
            if (typeof toastManager !== 'undefined') {
                toastManager.hide();
            }

            // --- Fermeture automatique du menu mobile lors de la navigation ---
            const mobileMenu = document.getElementById('mobile-menu');
            const menuBtn = document.getElementById('menu-btn');
            if (mobileMenu && menuBtn && !mobileMenu.classList.contains('-translate-y-[150%]')) {
                mobileMenu.classList.add('-translate-y-[150%]', 'opacity-0');
                mobileMenu.classList.remove('translate-y-0', 'opacity-100');
                menuBtn.innerHTML = '<i class="ri-menu-4-fill text-2xl"></i>';
                // Reset couleurs du bouton
                menuBtn.classList.remove('bg-black', 'text-white');
                menuBtn.classList.add('bg-white', 'text-black');
            }

            // 1. Déclencher l'effet Glitch sur le Body
            document.body.classList.add('glitch-mode');

            // 2. Mise à jour du Fil d'Ariane
            updateBreadcrumb(viewId);

            // 3. Gestion de l'historique du navigateur (si pas skipHistory)
            if (!skipHistory) {
                const url = viewId === 'home' ? '/' : `/#${viewId}`;
                const title = `ALBI RP™ | ${viewId.charAt(0).toUpperCase() + viewId.slice(1)}`;

                // Ajouter une entrée dans l'historique
                history.pushState({ viewId: viewId }, title, url);

                // Mettre à jour le titre de la page
                document.title = title;
            }

            // 4. Gestion du Thème de couleur selon la page
            setTimeout(() => {
                // Reset classes
                document.body.classList.remove('theme-albi', 'theme-data', 'theme-shop', 'theme-vote', 'theme-socials');

                // Appliquer le thème spécifique
                if (viewId === 'lore' || viewId === 'factions' || viewId === 'jobs') {
                    document.body.classList.add('theme-albi'); // Rouge/Brique
                } else if (viewId === 'whitelist' || viewId === 'rules') {
                    document.body.classList.add('theme-data'); // Vert/Terminal
                } else if (viewId === 'shop') {
                    document.body.classList.add('theme-shop'); // Cyberpunk Magenta/Jaune
                } else if (viewId === 'vote') {
                    document.body.classList.add('theme-vote'); // Cyan/Bleu Électrique
                } else if (viewId === 'socials') {
                    document.body.classList.add('theme-socials'); // Violet/Rose Dark Mode
                } else if (viewId === 'timeline') {
                    document.body.classList.add('theme-vote'); // Cyan/Bleu Électrique (réutilisé pour timeline)
                }
                // 'home' reste le défaut (Neo/Jaune)

                // Mise à jour du disclaimer selon le thème
                updateDisclaimerText();

                // 5. Masquer toutes les sections
                document.querySelectorAll('.view-section').forEach(el => {
                    el.classList.remove('active');
                });

                // 6. Afficher la section demandée
                const target = document.getElementById('view-' + viewId);
                if (target) {
                    target.classList.add('active');
                    window.scrollTo(0, 0); // Remonter en haut
                }

                // 6.5. Appliquer le système d'événements si on est sur la vue events ou timeline
                if (viewId === 'events') {
                    // Initialiser le système d'événements saisonniers
                    if (typeof eventSystem !== 'undefined') {
                        eventSystem.init();
                    }
                }
                else if (viewId === 'timeline') {
                    // Initialiser et générer la timeline
                    if (typeof eventSystem !== 'undefined') {
                        eventSystem.renderTimeline();
                    }
                }

                // 7. Retirer l'effet Glitch
                document.body.classList.remove('glitch-mode');

                // 8. Réinitialiser les effets hover du curseur après changement de vue
                setTimeout(() => {
                    const cursor = document.getElementById('custom-cursor');
                    if (cursor) {
                        const interactiveElements = document.querySelectorAll('a, button, .brutalist-card, [onclick]');
                        interactiveElements.forEach(el => {
                            el.addEventListener('mouseenter', () => {
                                cursor.classList.add('cursor-hover');
                            });
                            el.addEventListener('mouseleave', () => {
                                cursor.classList.remove('cursor-hover');
                            });
                        });
                    }
                }, 300);

                // Réinitialiser le flag de navigation
                isNavigating = false;
            }, 200); // Délai pour que le glitch cache le changement de contenu
        }

        // Gestion des boutons précédent/suivant du navigateur
        window.addEventListener('popstate', (event) => {
            // Récupérer la vue depuis l'état de l'historique ou l'URL
            let viewId = 'home';

            if (event.state && event.state.viewId) {
                viewId = event.state.viewId;
            } else {
                // Parser l'URL pour déterminer la vue
                viewId = getCurrentView();
            }

            // Naviguer vers la vue sans ajouter une nouvelle entrée dans l'historique
            router(viewId, true);
        });

        // Fonction pour mettre à jour le texte du disclaimer selon le thème
        function updateDisclaimerText() {
            const disclaimerText = document.getElementById('disclaimer-text');
            if (!disclaimerText) return;

            // Version 1 : Juridiquement Carrée (pour theme-albi et défaut)
            const version1 = 'Projet indépendant, non affilié à la Ville d\'Albi ni au Conseil Départemental du Tarn.';

            // Version 2 : Néo-Brutalist (pour theme-shop, theme-vote, theme-socials)
            const version2 = 'PROJET OFFICIEL // AUCUNE AFFILIATION INSTITUTIONNELLE AVEC LA VILLE D\'ALBI.';

            // Version 3 : Fluide (pour theme-data)
            const version3 = 'Ce serveur est une œuvre de fiction non affiliée à la Mairie d\'Albi ou au Département du Tarn.';

            // Déterminer le thème actif
            const body = document.body;
            let selectedVersion = version1; // Par défaut

            if (body.classList.contains('theme-data')) {
                selectedVersion = version3; // Fluide pour le thème terminal/data
            } else if (body.classList.contains('theme-shop') ||
                body.classList.contains('theme-vote') ||
                body.classList.contains('theme-socials')) {
                selectedVersion = version2; // Néo-Brutalist pour les thèmes stylés
            } else {
                selectedVersion = version1; // Juridiquement Carrée pour theme-albi et défaut
            }

            disclaimerText.textContent = selectedVersion;
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Mise à jour automatique de l'année du copyright
            const copyrightYear = document.getElementById('copyright-year');
            if (copyrightYear) {
                copyrightYear.textContent = new Date().getFullYear();
            }

            // Initialiser le disclaimer au chargement
            updateDisclaimerText();

            // --- GESTION MENU BURGER MOBILE ---
            const mobileMenu = document.getElementById('mobile-menu');
            const menuBtn = document.getElementById('menu-btn');
            let isMenuOpen = false;

            if (menuBtn && mobileMenu) {
                menuBtn.addEventListener('click', toggleMenu);

                function toggleMenu() {
                    isMenuOpen = !isMenuOpen;
                    if (isMenuOpen) {
                        // Ouvrir le menu
                        mobileMenu.classList.remove('-translate-y-[150%]', 'opacity-0');
                        mobileMenu.classList.add('translate-y-0', 'opacity-100');

                        // Changer l'icône en CROIX (X)
                        menuBtn.innerHTML = '<i class="ri-close-fill text-2xl"></i>';

                        // Optionnel : Inverser les couleurs du bouton pour le style
                        menuBtn.classList.add('bg-black', 'text-white');
                        menuBtn.classList.remove('bg-white', 'text-black');
                    } else {
                        // Fermer le menu
                        mobileMenu.classList.add('-translate-y-[150%]', 'opacity-0');
                        mobileMenu.classList.remove('translate-y-0', 'opacity-100');

                        // Remettre l'icône MENU
                        menuBtn.innerHTML = '<i class="ri-menu-4-fill text-2xl"></i>';

                        // Reset couleurs
                        menuBtn.classList.remove('bg-black', 'text-white');
                        menuBtn.classList.add('bg-white', 'text-black');
                    }
                }

                // Exposer la fonction globalement pour les liens onclick
                window.toggleMenu = toggleMenu;
            }

            // Gestion de la copie d'IP
            const copyIpBtn = document.getElementById('copy-ip-btn');
            const copyIcon = document.getElementById('copy-icon');
            const checkIcon = document.getElementById('check-icon');
            const copyFeedback = document.getElementById('copy-feedback');
            const ipText = document.getElementById('ip-text');
            const ipAddress = 'play.albirp.com:30120';
            let copyTimeout = null;

            if (copyIpBtn && copyIcon && checkIcon && copyFeedback) {
                const handleCopy = async () => {
                    try {
                        // Vérifier si l'API Clipboard est disponible
                        if (!navigator.clipboard || !navigator.clipboard.writeText) {
                            // Fallback pour les navigateurs plus anciens
                            const textArea = document.createElement('textarea');
                            textArea.value = ipAddress;
                            textArea.style.position = 'fixed';
                            textArea.style.opacity = '0';
                            document.body.appendChild(textArea);
                            textArea.select();

                            try {
                                document.execCommand('copy');
                                showSuccess();
                            } catch (err) {
                                showError('Impossible de copier. Veuillez sélectionner manuellement.');
                            } finally {
                                document.body.removeChild(textArea);
                            }
                            return;
                        }

                        // Copie moderne avec l'API Clipboard
                        await navigator.clipboard.writeText(ipAddress);
                        showSuccess();
                    } catch (err) {
                        console.error('Erreur lors de la copie:', err);
                        showError('Erreur lors de la copie. Veuillez réessayer.');
                    }
                };

                const showSuccess = () => {
                    // Changer l'icône
                    copyIcon.classList.add('hidden');
                    checkIcon.classList.remove('hidden');

                    // Afficher le message de confirmation
                    copyFeedback.textContent = '✓ IP copiée dans le presse-papiers';
                    copyFeedback.classList.remove('opacity-0', 'text-red-500');
                    copyFeedback.classList.add('opacity-100', 'text-brand-main');

                    // Réinitialiser après 3 secondes
                    if (copyTimeout) clearTimeout(copyTimeout);
                    copyTimeout = setTimeout(() => {
                        copyIcon.classList.remove('hidden');
                        checkIcon.classList.add('hidden');
                        copyFeedback.classList.remove('opacity-100');
                        copyFeedback.classList.add('opacity-0');
                    }, 3000);
                };

                const showError = (message) => {
                    copyFeedback.textContent = `✗ ${message}`;
                    copyFeedback.classList.remove('opacity-0', 'text-brand-main');
                    copyFeedback.classList.add('opacity-100', 'text-red-500');

                    if (copyTimeout) clearTimeout(copyTimeout);
                    copyTimeout = setTimeout(() => {
                        copyFeedback.classList.remove('opacity-100');
                        copyFeedback.classList.add('opacity-0');
                    }, 3000);
                };

                // Gestion du clic
                copyIpBtn.addEventListener('click', handleCopy);

                // Gestion du clavier (accessibilité)
                copyIpBtn.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        handleCopy();
                    }
                });
            }

            // Initialiser en fonction de l'URL (support des liens directs)
            function initializeRouter() {
                const viewId = getCurrentView();

                // Initialiser l'état de l'historique pour la page actuelle
                const url = viewId === 'home' ? '/' : `/#${viewId}`;
                const title = `ALBI RP™ | ${viewId.charAt(0).toUpperCase() + viewId.slice(1)}`;

                // Remplacer l'état actuel (sans ajouter d'entrée dans l'historique)
                history.replaceState({ viewId: viewId }, title, url);
                document.title = title;

                // Naviguer vers la vue initiale (sans ajouter d'entrée dans l'historique)
                router(viewId, true);
            }

            // --- SÉQUENCE DE DÉMARRAGE ROBUSTE (V3) ---
            const startSystem = () => {
                if (window.__ALBI_STARTED) return; // Éviter double démarrage
                window.__ALBI_STARTED = true;

                Debug.log("BOOT", "🚀 Démarrage du système...", { readyState: document.readyState });

                // 1. Vérification des éléments critiques
                const term = document.getElementById('breadcrumb-terminal');
                const app = document.getElementById('app-container');

                if (!term) Debug.error("BOOT", "CRITIQUE: #breadcrumb-terminal introuvable !");
                if (!app) Debug.error("BOOT", "CRITIQUE: #app-container introuvable !");

                // 2. Lancement du Router
                try {
                    Debug.log("BOOT", "Tentative lancement initializeRouter()...");

                    if (typeof initializeRouter === 'function') {
                        initializeRouter();
                        Debug.log("BOOT", "✅ initializeRouter() appelé avec succès");
                    } else {
                        Debug.error("BOOT", "Fonction initializeRouter non définie !");
                    }
                } catch (e) {
                    Debug.error("BOOT", "Crash pendant initializeRouter", e);
                }

                // 3. Watchdog (Chien de garde)
                setTimeout(() => {
                    const status = term ? term.innerText : "NULL";
                    Debug.log("WATCHDOG", "Vérification état terminal...", { currentText: status });

                    if (status.includes("INITIALIZING") || status.includes("...")) {
                        Debug.error("WATCHDOG", "⚠️ BLOCAGE DÉTECTÉ ! Le texte n'a pas changé.");

                        // Tentative de débogage automatique
                        if (typeof updateBreadcrumb === 'function') {
                            Debug.log("WATCHDOG", "Tentative forcée de updateBreadcrumb('home')...");
                            updateBreadcrumb('home');
                        } else {
                            Debug.error("WATCHDOG", "Impossible de forcer : updateBreadcrumb n'existe pas.");
                        }
                    } else {
                        Debug.log("WATCHDOG", "Système stable. Démarrage réussi.");
                    }
                }, 500); // Délai réduit pour réactivité
            };

            // Démarrage intelligent
            if (document.readyState === 'complete' || document.readyState === 'interactive') {
                // Si le document est déjà prêt, on lance direct
                Debug.log("BOOT", "DOM déjà prêt, lancement immédiat.");
                startSystem();
            } else {
                // Sinon on attend l'événement
                document.addEventListener('DOMContentLoaded', () => {
                    Debug.log("BOOT", "🔥 DOMContentLoaded déclenché");
                    startSystem();
                });
            }

            // Fallback ultime (si DOMContentLoaded a été manqué d'une façon ou d'une autre)
            window.onload = () => {
                if (!window.__ALBI_STARTED) {
                    Debug.log("BOOT", "⚠️ Fallback window.onload déclenché");
                    startSystem();
                }
            };

            // --- 1. GESTION DU CURSEUR CUSTOM NÉO-BRUTALISTE (Améliorée) ---
            const cursor = document.getElementById('custom-cursor');
            const coordX = document.getElementById('coord-x');
            const coordY = document.getElementById('coord-y');

            // Vérification de sécurité : si le curseur n'existe pas, on cache quand même le curseur système
            if (!cursor) {
                console.warn('Curseur personnalisé non trouvé, curseur système caché par sécurité');
                // Double sécurité : forcer le curseur none partout
                const style = document.createElement('style');
                style.textContent = '* { cursor: none !important; }';
                document.head.appendChild(style);
            } else {
                // S'assurer que le curseur est visible
                cursor.style.opacity = '1';

                // Liens interactifs pour l'effet de survol
                const links = document.querySelectorAll('a, button, input, .brutalist-card, [role="button"], [onclick]');

                // Mise à jour des coordonnées uniquement (le mouvement du curseur est géré par le script immédiat)
                // Note: coordX et coordY ne sont plus dans le DOM avec le nouveau système, donc on ignore cette partie

                // Effet de Click (Recul de l'arme) avec vérification
                document.addEventListener('mousedown', () => {
                    if (cursor) {
                        cursor.classList.add('cursor-click');
                    }
                });
                document.addEventListener('mouseup', () => {
                    if (cursor) {
                        cursor.classList.remove('cursor-click');
                    }
                });

                // Fonction pour ajouter les effets hover sur les éléments interactifs
                const addHoverEffect = () => {
                    const interactiveElements = document.querySelectorAll('a, button, .brutalist-card, [onclick]');
                    interactiveElements.forEach(el => {
                        el.addEventListener('mouseenter', () => {
                            if (cursor) {
                                cursor.classList.add('cursor-hover');
                            }
                        });
                        el.addEventListener('mouseleave', () => {
                            if (cursor) {
                                cursor.classList.remove('cursor-hover');
                            }
                        });
                    });
                };

                // Initialiser les effets hover
                addHoverEffect();

                // Gestion de la sortie de la fenêtre (cacher le curseur)
                document.addEventListener('mouseleave', () => {
                    if (cursor) {
                        cursor.style.opacity = '0';
                    }
                });
                document.addEventListener('mouseenter', () => {
                    if (cursor) {
                        cursor.style.opacity = '1';
                    }
                });
            }

            // Sécurité supplémentaire : observer les nouveaux éléments ajoutés dynamiquement
            const observer = new MutationObserver(function (mutations) {
                mutations.forEach(function (mutation) {
                    mutation.addedNodes.forEach(function (node) {
                        if (node.nodeType === 1) { // Element node
                            if (node.style) {
                                node.style.cursor = 'none';
                            }
                            // Appliquer aux enfants
                            const children = node.querySelectorAll ? node.querySelectorAll('*') : [];
                            children.forEach(function (child) {
                                if (child.style) {
                                    child.style.cursor = 'none';
                                }
                            });
                        }
                    });
                });
            });

            // Observer les changements dans le body
            if (document.body) {
                observer.observe(document.body, {
                    childList: true,
                    subtree: true
                });
            }

            // --- GÉNÉRATEUR PDF DYNAMIQUE (SYNCHRONISÉ AVEC LE HTML) ---
            window.generateRulesPDF = async function (btnElement) {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                // Feedback visuel sur le bouton
                const originalText = btnElement.innerHTML;
                btnElement.innerHTML = "EXTRACTION DES DONNÉES...";
                btnElement.classList.add("animate-pulse");
                btnElement.disabled = true;

                // --- CONFIGURATION STYLE ---
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                const margin = 20;
                let y = 20; // Curseur vertical

                // Fonction utilitaire pour dessiner le header sur chaque page
                function drawHeader(pageNo) {
                    doc.setFont("courier", "bold");
                    doc.setFontSize(10);
                    doc.setTextColor(150); // Gris
                    doc.text("ALBI RP™ // ARCHIVES LEGALES // CONFIDENTIEL", margin, 10);
                    doc.text(`PAGE 0€{pageNo}`, pageWidth - margin - 20, 10);

                    // Bordure brute autour de la page
                    doc.setDrawColor(0); // Noir
                    doc.setLineWidth(0.5);
                    doc.rect(10, 15, pageWidth - 20, pageHeight - 25);
                }

                // --- PAGE 1 : COUVERTURE ---
                drawHeader(1);
                y = 60;

                doc.setFont("courier", "bold");
                doc.setTextColor(0);
                doc.setFontSize(40);
                doc.text("CODE PENAL", margin + 10, y);
                y += 15;
                doc.setTextColor(230, 57, 70); // Rouge Albi
                doc.text("V2.1", margin + 10, y);

                y += 40;

                doc.setDrawColor(230, 57, 70);
                doc.setLineWidth(2);
                doc.rect(margin + 10, y, 80, 20);
                doc.setFontSize(16);
                doc.setTextColor(230, 57, 70);
                doc.text("DOCUMENT CLASSIFIE", margin + 15, y + 13);

                y += 50;

                doc.setTextColor(0);
                doc.setFontSize(12);
                doc.setFont("courier", "normal");
                const metaData = [
                    "DATE: " + new Date().toLocaleDateString('fr-FR'),
                    "JURIDICTION: ALBI / T.A.R.N",
                    "STATUT: EN VIGUEUR",
                    "AUTORITE: MAIRIE & LSPD",
                    "DOCUMENT ID: #882-ALBI-LEGAL",
                    "SOURCE: DATABASE WEB" // Indique que c'est synchro
                ];

                metaData.forEach(line => {
                    doc.text("> " + line, margin + 10, y);
                    y += 10;
                });

                y += 20;
                doc.setFont("courier", "bold");
                doc.text("APPROUVE PAR:", margin + 10, y);
                y += 10;
                doc.setFont("courier", "normal");
                doc.text("Le Maire d'Albi", margin + 10, y);

                // --- PAGE 2+ : EXTRACTION DYNAMIQUE DES RÈGLES ---
                doc.addPage();
                y = 30;
                drawHeader(2);

                // Récupération de toutes les cartes de règles présentes dans le DOM
                const ruleCards = document.querySelectorAll('.rule-card');
                let currentSection = null;

                ruleCards.forEach((card) => {
                    // 1. Extraction des données HTML
                    const ruleNumber = card.querySelector('.absolute.-top-3').innerText.trim(); // §1.0
                    const ruleName = card.querySelector('h3').innerText.trim(); // FEAR RP
                    const title = `${ruleNumber} ${ruleName}`;

                    // Sanction (si existe)
                    const sanctionEl = card.querySelector('.absolute.top-4.right-4');
                    const sanction = sanctionEl ? sanctionEl.innerText.trim() : "";

                    // Description
                    const desc = card.querySelector('p.search-content').innerText.trim();

                    // Exemple (nettoyage du texte "> EXEMPLE :")
                    const exampleEl = card.querySelector('.bg-white\\/10');
                    let example = "";
                    if (exampleEl) {
                        // On enlève le préfixe car on le rajoute proprement dans le PDF
                        example = exampleEl.innerText.replace(/>\s*EXEMPLE\s*:\s*/i, '').trim();
                    }

                    // Gestion des Sections (I. FONDAMENTAUX, etc.)
                    const sectionId = card.getAttribute('data-section');

                    // Si on change de section ou si c'est la première
                    if (sectionId !== currentSection) {
                        currentSection = sectionId;

                        // Récupérer le titre de la section depuis le DOM
                        const headerEl = document.querySelector(`.rule-header[data-section="${sectionId}"] h2`);
                        const headerTitle = headerEl ? headerEl.innerText.trim() : `SECTION ${sectionId}`;

                        // Saut de ligne avant nouvelle section (sauf si haut de page)
                        if (y > 30) y += 10;

                        // Vérif place disponible pour le titre
                        if (y > pageHeight - 40) {
                            doc.addPage();
                            drawHeader(doc.internal.getNumberOfPages());
                            y = 30;
                        }

                        doc.setFont("courier", "bold");
                        doc.setFontSize(18);
                        doc.setTextColor(0); // Noir
                        doc.text(headerTitle, margin, y);
                        y += 15;
                    }

                    // 2. Vérification saut de page pour la règle
                    // On estime la hauteur nécessaire grossièrement
                    if (y > pageHeight - 50) {
                        doc.addPage();
                        drawHeader(doc.internal.getNumberOfPages());
                        y = 30;
                    }

                    // 3. Écriture de la Règle
                    // Titre
                    doc.setFont("courier", "bold");
                    doc.setFontSize(14);
                    doc.setTextColor(0);
                    doc.text(title, margin, y);

                    // Sanction (Badge simulé à droite)
                    if (sanction) {
                        doc.setTextColor(255, 0, 0); // Rouge
                        doc.setFontSize(10);
                        doc.text(`[${sanction}]`, pageWidth - margin - 40, y);
                    }

                    y += 7;

                    // Description
                    doc.setFont("courier", "normal");
                    doc.setTextColor(60);
                    doc.setFontSize(11);
                    const splitText = doc.splitTextToSize(desc, pageWidth - (margin * 2));
                    doc.text(splitText, margin, y);

                    y += (splitText.length * 5) + 5;

                    // Exemple
                    if (example) {
                        doc.setFont("courier", "italic");
                        doc.setTextColor(100);
                        doc.setFontSize(10);
                        const exampleText = doc.splitTextToSize("> EXEMPLE: " + example, pageWidth - (margin * 2) - 10);
                        doc.text(exampleText, margin + 5, y);
                        y += (exampleText.length * 5) + 10;
                    } else {
                        y += 5; // Espace
                    }
                });

                // --- FIN ---
                doc.save("ALBIRP_REGLEMENT_OFFICIEL_V2.1.pdf");

                // Reset bouton
                setTimeout(() => {
                    btnElement.innerHTML = originalText;
                    btnElement.classList.remove("animate-pulse");
                    btnElement.disabled = false;
                }, 1000);
            };
        });
    </script>

    <!-- Script de recherche en temps réel des règles -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const searchInput = document.getElementById('rule-search-input');
            const searchClear = document.getElementById('search-clear');
            const searchBtn = document.getElementById('search-btn');
            const ruleCards = document.querySelectorAll('.rule-card');
            const headers = document.querySelectorAll('.rule-header');
            const noResultsMsg = document.getElementById('no-results');

            // Vérification de sécurité
            if (!searchInput || !ruleCards.length) return;

            // Fonction pour normaliser le texte (enlever accents pour recherche plus souple)
            function normalizeText(text) {
                return text.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
            }

            // Fonction principale de recherche
            function performSearch() {
                const query = normalizeText(searchInput.value.trim());
                let visibleCount = 0;

                // 1. Gestion du bouton Clear
                if (query.length > 0) {
                    searchClear.classList.remove('hidden');
                } else {
                    searchClear.classList.add('hidden');
                }

                // 2. Filtrage des cartes
                ruleCards.forEach(card => {
                    // On cherche dans tout le texte de la carte
                    const content = normalizeText(card.innerText);

                    if (content.includes(query)) {
                        card.style.display = ''; // Affiche (reset au CSS par défaut)
                        visibleCount++;
                    } else {
                        card.style.display = 'none'; // Masque
                    }
                });

                // 3. Gestion intelligente des titres de section
                headers.forEach(header => {
                    const sectionId = header.getAttribute('data-section');

                    // On récupère les cartes de cette section spécifique
                    // On vérifie le style display direct plutôt qu'un sélecteur CSS fragile
                    const cardsInSection = Array.from(document.querySelectorAll(`.rule-card[data-section="${sectionId}"]`));
                    const hasVisibleCards = cardsInSection.some(card => card.style.display !== 'none');

                    if (hasVisibleCards) {
                        header.style.display = '';
                    } else {
                        header.style.display = 'none';
                    }
                });

                // 4. Message Aucun Résultat
                if (visibleCount === 0 && query.length > 0) {
                    noResultsMsg.classList.remove('hidden');
                } else {
                    noResultsMsg.classList.add('hidden');
                }
            }

            // Écouteur : Frappe au clavier (Temps réel)
            searchInput.addEventListener('input', performSearch);

            // Écouteur : Clic sur le bouton Clear
            searchClear.addEventListener('click', () => {
                searchInput.value = '';
                performSearch();
                searchInput.focus();
            });

            // Écouteur : Touche Entrée
            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    searchInput.blur(); // Ferme le clavier sur mobile
                }
            });

            // Écouteur : Clic sur le bouton de recherche (Flèche)
            if (searchBtn) {
                searchBtn.addEventListener('click', () => {
                    performSearch(); // Force une recherche (utile si copier-coller souris)
                    searchInput.focus();
                });
            }
        });

        // --- LOGIQUE BOUTIQUE AVANCÉE (SUBSCRIPTIONS & WALLET) ---
        const shopModal = document.getElementById('shop-modal');
        const shopModalContent = document.getElementById('shop-modal-content');

        // Gestion des Onglets (Packs vs Abos)
        window.switchShopTab = function (tabName) {
            // Reset styles boutons
            document.querySelectorAll('.shop-tab').forEach(el => {
                el.classList.remove('bg-white', 'text-black', 'active', 'border-transparent');
                el.classList.add('bg-black', 'text-gray-400', 'border-2', 'border-white');
            });

            // Activer le bouton cliqué
            const activeBtn = document.getElementById(`tab-${tabName}`);
            activeBtn.classList.remove('bg-black', 'text-gray-400', 'border-2', 'border-white');
            activeBtn.classList.add('bg-white', 'text-black', 'active', 'border-4', 'border-transparent');

            // Afficher le contenu
            document.getElementById('shop-content-packs').classList.add('hidden');
            document.getElementById('shop-content-subs').classList.add('hidden');

            // Animation d'entrée
            const content = document.getElementById(`shop-content-${tabName}`);
            content.classList.remove('hidden');
            content.style.opacity = '0';
            content.style.transform = 'translateY(20px)';
            setTimeout(() => {
                content.style.transition = 'all 0.3s ease';
                content.style.opacity = '1';
                content.style.transform = 'translateY(0)';
            }, 50);
        };

        // Simulation Connexion Wallet (Web3)
        // --- SYSTÈME WALLET MANAGER V2 (MULTI-PROVIDER + SESSION) ---

        // --- SYSTÈME WALLET MANAGER V3 (SMART FALLBACKS & DEEP LINKS) ---
        const walletManager = {
            isConnected: false,
            currentAddress: null,
            providerType: null,

            // Initialisation
            init: function () {
                const savedSession = localStorage.getItem('albi_wallet_session');
                if (savedSession) {
                    try {
                        const session = JSON.parse(savedSession);
                        if (session.address && session.provider) {
                            this.updateUI(session.address, session.provider);
                        }
                    } catch (e) { localStorage.removeItem('albi_wallet_session'); }
                }
            },

            // Gestion de la Modale
            openModal: function () {
                const modal = document.getElementById('wallet-modal');
                const content = document.getElementById('wallet-modal-content');

                // Reset état erreur
                const errorMsg = document.getElementById('wallet-error-msg');
                if (errorMsg) errorMsg.classList.add('hidden');

                modal.classList.remove('hidden');
                setTimeout(() => {
                    modal.classList.remove('opacity-0');
                    content.classList.remove('scale-95');
                    content.classList.add('scale-100');
                }, 10);
            },

            closeModal: function () {
                const modal = document.getElementById('wallet-modal');
                const content = document.getElementById('wallet-modal-content');

                modal.classList.add('opacity-0');
                content.classList.remove('scale-100');
                content.classList.add('scale-95');

                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 300);
            },

            // --- CŒUR DU SYSTÈME : CONNEXION INTELLIGENTE ---
            connect: async function (providerId) {
                let address = null;
                const errorMsg = document.getElementById('wallet-error-msg');

                // Reset visuel du message d'erreur
                if (errorMsg) {
                    errorMsg.classList.add('hidden');
                    errorMsg.classList.remove('bg-yellow-400', 'text-black', 'border-yellow-600');
                    errorMsg.classList.add('bg-red-600', 'text-white', 'border-black');
                }

                // Détection Mobile (pour le Deep Linking)
                const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
                const currentUrl = window.location.host + window.location.pathname; // URL sans le protocole

                // Liens de secours (Deep Links & Stores)
                const fallbacks = {
                    'metamask': {
                        download: 'https://metamask.io/download/',
                        // Ouvre le site DANS l'app MetaMask sur mobile
                        deepLink: `https://metamask.app.link/dapp/${currentUrl}`
                    },
                    'phantom': {
                        download: 'https://phantom.app/download',
                        deepLink: `https://phantom.app/ul/browse/${currentUrl}?ref=${currentUrl}`
                    },
                    'coinbase': {
                        download: 'https://www.coinbase.com/wallet/downloads',
                        deepLink: `https://go.cb-w.com/dapp?cb_url=${encodeURIComponent(window.location.href)}`
                    },
                    'trust': {
                        download: 'https://trustwallet.com/browser-extension',
                        deepLink: `https://link.trustwallet.com/open_url?coin_id=60&url=${encodeURIComponent(window.location.href)}`
                    }
                };

                try {
                    // 1. DÉTECTION DU PROVIDER
                    let provider = null;

                    if (providerId === 'metamask' || providerId === 'coinbase' || providerId === 'trust') {
                        // Standard EVM
                        if (typeof window.ethereum !== 'undefined') {
                            provider = window.ethereum;
                            // Cas spécifique : Si plusieurs wallets sont installés, MetaMask peut être window.ethereum.providers[...]
                            // On simplifie ici en prenant l'injection par défaut qui est souvent celle désirée ou prioritaire.
                        }
                    } else if (providerId === 'phantom') {
                        // Solana
                        if (window.phantom?.solana?.isPhantom) {
                            provider = window.phantom.solana;
                        }
                    }

                    // 2. LOGIQUE DE "SÉCURITÉ" (FALLBACK)
                    if (!provider) {
                        // PAS DE WALLET DÉTECTÉ

                        if (isMobile) {
                            // CAS MOBILE (Safari iOS / Chrome Android) -> Deep Link
                            // On tente d'ouvrir l'app native directement
                            window.location.href = fallbacks[providerId].deepLink;
                            throw new Error("REDIRECTION VERS L'APP...");
                        } else {
                            // CAS DESKTOP (Chrome/Safari/Edge) -> Installation
                            window.open(fallbacks[providerId].download, '_blank');
                            throw new Error(`EXTENSION MANQUANTE : ${providerId.toUpperCase()}`);
                        }
                    }

                    // 3. CONNEXION STANDARD (Si Provider trouvé)
                    if (providerId === 'phantom') {
                        const resp = await provider.connect();
                        address = resp.publicKey.toString();
                    } else {
                        // MetaMask & co
                        const accounts = await provider.request({ method: 'eth_requestAccounts' });
                        address = accounts[0];
                    }

                    // 4. SUCCÈS
                    if (address) {
                        this.saveSession(address, providerId);
                        this.updateUI(address, providerId);
                        this.closeModal();

                        if (typeof audioSystem !== 'undefined') audioSystem.play('success');
                        toastManager.show("CONNEXION RÉUSSIE", `Wallet ${providerId.toUpperCase()} lié.`);
                    }

                } catch (err) {
                    console.warn("Wallet System:", err.message);
                    if (typeof audioSystem !== 'undefined') audioSystem.play('error');

                    if (errorMsg) {
                        // Gestion des messages "Intelligents"
                        if (err.message.includes("EXTENSION") || err.message.includes("REDIRECTION")) {
                            // Mode Info/Alerte (Jaune)
                            errorMsg.classList.remove('bg-red-600', 'text-white', 'border-black');
                            errorMsg.classList.add('bg-yellow-400', 'text-black', 'border-yellow-600');

                            if (err.message.includes("REDIRECTION")) {
                                errorMsg.innerText = "OUVERTURE DE L'APPLICATION...";
                            } else {
                                errorMsg.innerText = `${err.message} - PAGE OUVERTE`;
                            }
                        } else {
                            // Mode Erreur (Rouge)
                            errorMsg.innerText = "CONNEXION REFUSÉE";
                        }
                        errorMsg.classList.remove('hidden');
                    }
                }
            },

            // Persistance
            saveSession: function (address, provider) {
                this.isConnected = true;
                this.currentAddress = address;
                localStorage.setItem('albi_wallet_session', JSON.stringify({
                    address: address, provider: provider, timestamp: Date.now()
                }));
            },

            // Déconnexion
            disconnect: function () {
                localStorage.removeItem('albi_wallet_session');
                this.isConnected = false;

                // Reset UI Bouton
                const btn = document.getElementById('btn-wallet');
                const dot = document.getElementById('wallet-dot');
                const txt = document.getElementById('wallet-text');

                txt.innerText = "CONNECTER WALLET";
                dot.className = "w-2 h-2 bg-red-500 rounded-full animate-pulse";
                btn.className = "bg-black border-2 border-brand-main text-brand-main px-6 py-2 font-mono text-sm font-bold hover:bg-brand-main hover:text-black transition-all flex items-center gap-2 shadow-[4px_4px_0_white]";

                // Retirer l'event de déconnexion et remettre l'ouverture de modale
                btn.onclick = function () { walletManager.openModal(); };

                toastManager.show("DÉCONNECTÉ", "Session terminée.");
            },

            // Mise à jour UI
            updateUI: function (address, provider) {
                const btn = document.getElementById('btn-wallet');
                const dot = document.getElementById('wallet-dot');
                const txt = document.getElementById('wallet-text');

                const shortAddr = address.substring(0, 4) + "..." + address.substring(address.length - 4);
                txt.innerText = shortAddr.toUpperCase();

                dot.className = "w-2 h-2 bg-green-500 rounded-full animate-pulse";
                btn.classList.remove('bg-black', 'text-brand-main', 'border-brand-main');
                btn.classList.add('bg-brand-main', 'text-black', 'border-black');

                btn.onclick = function () {
                    if (confirm(`Déconnecter le wallet ${provider.toUpperCase()} ?`)) {
                        walletManager.disconnect();
                    }
                };
            }
        };

        // --- FONCTIONS GLOBALES (POUR LE HTML) ---

        // Remplace l'ancienne fonction connectWallet()
        window.connectWallet = function () {
            if (walletManager.isConnected) {
                // Si déjà connecté, on ne fait rien ou on propose déconnexion (géré par updateUI)
            } else {
                walletManager.openModal();
            }
        };

        // Appelée par les boutons de la modale
        window.selectWalletProvider = function (provider) {
            walletManager.connect(provider);
        };

        // Appelée par le bouton croix
        window.closeWalletModal = function () {
            walletManager.closeModal();
        };

        // Fermer si on clique en dehors (Sécurisé)
        document.addEventListener('DOMContentLoaded', () => {
            const walletModal = document.getElementById('wallet-modal');
            if (walletModal) {
                walletModal.addEventListener('click', (e) => {
                    if (e.target.id === 'wallet-modal') walletManager.closeModal();
                });
            }
        });

        // Lancement automatique au chargement pour vérifier les cookies/localStorage
        document.addEventListener('DOMContentLoaded', () => {
            walletManager.init();
        });

        // Ouvrir la modale (Mise à jour pour gérer le type d'achat)
        window.openShopModal = function (itemName, price, type) {
            document.getElementById('modal-item-name').innerText = itemName;
            document.getElementById('modal-item-price').innerText = price;

            // Reset complet
            const step1 = document.getElementById('payment-step-1');
            const step2 = document.getElementById('payment-step-2');
            if (step1) step1.classList.remove('hidden');
            if (step2) step2.classList.add('hidden');
            document.getElementById('payment-loader').classList.add('hidden');
            document.getElementById('shop-username').value = "";
            const botStatus = document.getElementById('bot-check-status');
            if (botStatus) botStatus.innerHTML = "";

            // Personnalisation selon le type
            const typeBadge = document.getElementById('modal-type-badge');
            if (typeBadge) {
                if (type === 'sub') {
                    typeBadge.innerText = "ABONNEMENT MENSUEL";
                    typeBadge.className = "bg-yellow-400 text-black px-2 font-bold text-xs";
                } else {
                    typeBadge.innerText = "ACHAT UNIQUE";
                    typeBadge.className = "bg-white text-black px-2 font-bold text-xs";
                }
            }

            // Animation d'entrée
            shopModal.classList.remove('hidden');
            setTimeout(() => {
                shopModal.classList.remove('opacity-0');
                shopModalContent.classList.remove('scale-95');
                shopModalContent.classList.add('scale-100');
            }, 10);
        };

        window.closeShopModal = function () {
            shopModal.classList.add('opacity-0');
            shopModalContent.classList.remove('scale-100');
            shopModalContent.classList.add('scale-95');
            setTimeout(() => {
                shopModal.classList.add('hidden');
            }, 300);
        };

        // Étape 1 : Vérification via Bot Discord (Simulation)
        window.verifyDiscordLink = function () {
            const username = document.getElementById('shop-username').value;
            const statusDiv = document.getElementById('bot-check-status');
            const btn = document.getElementById('btn-verify-discord');

            if (!username) {
                if (statusDiv) statusDiv.innerHTML = "<span class='text-red-500'>ERREUR: Pseudo requis</span>";
                return;
            }

            // UI Loading
            btn.disabled = true;
            btn.innerHTML = `<i class="ri-loader-4-line animate-spin"></i> VÉRIFICATION ALBI_BOT...`;

            setTimeout(() => {
                // Succès simulé
                btn.disabled = false;
                btn.innerHTML = `VÉRIFIER LE COMPTE ➔`; // Reset pour prochaine fois

                // Passage à l'étape 2 (Paiement)
                document.getElementById('payment-step-1').classList.add('hidden');
                document.getElementById('payment-step-2').classList.remove('hidden');

                // Remplir les infos récupérées (Fake)
                const verifiedUser = document.getElementById('verified-user');
                const verifiedId = document.getElementById('verified-id');
                if (verifiedUser) verifiedUser.innerText = username;
                if (verifiedId) verifiedId.innerText = "ID: " + Math.floor(Math.random() * 99999999999999);

            }, 1500);
        };

        // Étape 2 : Paiement Final
        window.processFinalPayment = function () {
            const btn = document.getElementById('btn-pay-final');
            const loader = document.getElementById('payment-loader');

            btn.classList.add('hidden');
            loader.classList.remove('hidden');

            setTimeout(() => {
                closeShopModal();
                const itemName = document.getElementById('modal-item-name').innerText;

                // Notification Discord simulée
                toastManager.show("COMMANDE VALIDÉE", `Le bot livre votre ${itemName}. Vérifiez vos MPs Discord.`);

                // Reset pour la prochaine fois
                btn.classList.remove('hidden');
            }, 2000);
        };

        // Fermer au clic dehors
        if (shopModal) {
            shopModal.addEventListener('click', (e) => {
                if (e.target === shopModal) closeShopModal();
            });
        }

        // --- SYSTÈME DE NOTIFICATION AVANCÉ (TOAST MANAGER) ---
        const toastManager = {
            element: document.getElementById('vote-toast'),
            timer: null,
            duration: 4000, // Temps de présence (4 secondes)

            show: function (title, message, type = 'success') {
                if (!this.element) return;

                // Configuration du contenu
                this.element.querySelector('h4').innerText = title;
                this.element.querySelector('p').innerText = message;

                // Gestion des couleurs/icones selon le type
                const icon = this.element.querySelector('i');
                const borderDiv = this.element.querySelector('div');
                const titleEl = this.element.querySelector('h4');

                if (type === 'error') {
                    borderDiv.classList.replace('border-brand-main', 'border-red-500');
                    titleEl.classList.replace('text-brand-main', 'text-red-500');
                    icon.className = 'ri-error-warning-fill text-3xl text-red-500';
                } else {
                    borderDiv.classList.replace('border-red-500', 'border-brand-main');
                    titleEl.classList.replace('text-red-500', 'text-brand-main');
                    icon.className = 'ri-checkbox-circle-fill text-3xl text-brand-main';
                }

                // Animation d'ENTRÉE
                this.element.classList.remove('toast-hidden');
                this.element.classList.add('toast-visible');

                // Reset du timer précédent si on spam le bouton
                if (this.timer) clearTimeout(this.timer);

                // Timer de SORTIE (Vers la droite)
                this.timer = setTimeout(() => {
                    this.hide();
                }, this.duration);
            },

            hide: function () {
                if (!this.element) return;
                // Animation de SORTIE vers la droite
                this.element.classList.remove('toast-visible');
                this.element.classList.add('toast-hidden');
            }
        };

        // Remplacement global de la fonction window.showToast
        window.showToast = function (title, message, type) {
            toastManager.show(title, message, type);
        };


        // --- BACKEND SIMULÉ (PERSISTANT & CENTRALISÉ LOCALEMENT) ---
        class ServerDatabase {
            constructor() {
                this.dbName = 'ALBIRP_CENTRAL_DB';
                // VRAIES DONNÉES INITIALES (Pas de random)
                this.defaultSchema = {
                    meta: { version: '1.0', server_start: Date.now() },
                    polls: {
                        'gameplay': {
                            title: "PRIORITÉ DEV",
                            options: { 'opt1': 482, 'opt2': 315 } // Données fixes de départ
                        },
                        'economy': {
                            title: "ÉCONOMIE",
                            options: { 'opt1': 890, 'opt2': 124 } // Données fixes de départ
                        }
                    },
                    logs: [], // Historique des actions
                    sessions_voted: [] // IDs des utilisateurs ayant voté
                };
                this.init();
            }

            init() {
                // Charge ou Crée la DB
                if (!localStorage.getItem(this.dbName)) {
                    this.save(this.defaultSchema);
                    this.log("Database created successfully.");
                } else {
                    this.log("Database loaded from local storage.");
                }
                this.refreshLogsUI();
            }

            get() {
                return JSON.parse(localStorage.getItem(this.dbName));
            }

            save(data) {
                localStorage.setItem(this.dbName, JSON.stringify(data));
            }

            log(action) {
                const data = this.get();
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = `[${timestamp}] ${action}`;

                // Ajout au début du tableau (plus récent en haut)
                data.logs.unshift(logEntry);
                if (data.logs.length > 50) data.logs.pop(); // Garder les 50 derniers logs

                this.save(data);
                this.refreshLogsUI(data.logs);
            }

            refreshLogsUI(logs = null) {
                const container = document.getElementById('server-logs');
                if (!container) return;

                const logData = logs || this.get().logs;
                container.innerHTML = logData.map(l => `<div class="border-b border-gray-900 pb-0.5"><span class="text-brand-main">></span> ${l}</div>`).join('');
            }

            // Transaction de vote sécurisée
            submitVote(pollId, optionId, sessionId) {
                const data = this.get();
                const voteKey = `${sessionId}_${pollId}`;

                // Vérification unicité (Simulation IP check)
                if (data.sessions_voted.includes(voteKey)) {
                    return { success: false, msg: "Double vote detected (IP Logged)" };
                }

                // Incrémentation
                if (data.polls[pollId] && data.polls[pollId].options[optionId] !== undefined) {
                    data.polls[pollId].options[optionId]++;
                    data.sessions_voted.push(voteKey);

                    this.save(data);
                    this.log(`VOTE_RCVD: ${pollId.toUpperCase()}:${optionId} FROM ${sessionId}`);

                    return { success: true, stats: data.polls[pollId].options };
                }

                return { success: false, msg: "Invalid Poll ID" };
            }

            getStats(pollId) {
                const data = this.get();
                return data.polls[pollId] ? data.polls[pollId].options : null;
            }

            checkIfVoted(pollId, sessionId) {
                const data = this.get();
                return data.sessions_voted.includes(`${sessionId}_${pollId}`);
            }
        }

        // --- INTERFACE UTILISATEUR (VOTE MANAGER) ---
        const serverDB = new ServerDatabase();

        // Récupération de l'ID de session généré plus haut dans votre code
        // (Assurez-vous que le code generateBrowserFingerprint s'est exécuté avant)
        const getCurrentSessionID = () => {
            const el = document.getElementById('session-id');
            if (el && el.innerText && el.innerText !== 'SES: ...') {
                return el.innerText.replace('SES: ', '');
            }
            // Fallback vers sessionStorage
            try {
                const stored = sessionStorage.getItem('albi_session_id');
                if (stored) return stored;
            } catch (e) {
                // Ignorer si sessionStorage n'est pas disponible
            }
            return 'ANONYMOUS';
        };

        const voteManager = {
            init: function () {
                const sessionId = getCurrentSessionID();

                // Chargement initial des états
                ['gameplay', 'economy'].forEach(pollId => {
                    const hasVoted = serverDB.checkIfVoted(pollId, sessionId);
                    const stats = serverDB.getStats(pollId);

                    if (hasVoted) {
                        this.showResults(pollId, stats, false);
                    }
                });
            },

            submit: function (pollId, optionId) {
                const sessionId = getCurrentSessionID();
                const transaction = serverDB.submitVote(pollId, optionId, sessionId);

                if (transaction.success) {
                    // 1. Notification Toast (Succès)
                    toastManager.show("VOTE ENREGISTRÉ", "Données transmises au serveur.");

                    // 2. Mise à jour UI avec animation
                    this.showResults(pollId, transaction.stats, true);
                } else {
                    // Notification Toast (Erreur)
                    toastManager.show("ERREUR SYSTÈME", transaction.msg, "error");
                }
            },

            showResults: function (pollId, stats, animate) {
                const container = document.getElementById(`poll-${pollId}`);
                if (!container) return;

                const optionsDiv = container.querySelector('.poll-options');
                const resultsDiv = container.querySelector('.poll-results');

                // Bascule UI
                optionsDiv.classList.add('hidden');
                resultsDiv.classList.remove('hidden');

                // Calculs Pourcentages
                const total = stats.opt1 + stats.opt2;
                const pct1 = total === 0 ? 0 : ((stats.opt1 / total) * 100).toFixed(1);
                const pct2 = total === 0 ? 0 : ((stats.opt2 / total) * 100).toFixed(1);

                // Injection Données
                container.querySelector('.result-pct-1').innerText = `${pct1}% (${stats.opt1})`;
                container.querySelector('.result-pct-2').innerText = `${pct2}% (${stats.opt2})`;

                // Animation des barres
                const bar1 = container.querySelector('.result-bar-1');
                const bar2 = container.querySelector('.result-bar-2');

                // Reset width pour animation
                if (animate) {
                    bar1.style.width = '0%';
                    bar2.style.width = '0%';
                    setTimeout(() => {
                        bar1.style.width = `${pct1}%`;
                        bar2.style.width = `${pct2}%`;
                    }, 100);
                } else {
                    bar1.style.width = `${pct1}%`;
                    bar2.style.width = `${pct2}%`;
                }
            }
        };

        // Redéfinition de handleVote pour les liens externes aussi
        window.handleVote = function (url) {
            toastManager.show("REDIRECTION...", "Connexion au serveur de vote externe.");
            serverDB.log(`OUTBOUND_LINK: User clicked external vote ${url}`);
            setTimeout(() => {
                window.open(url, '_blank');
            }, 1000);
        };

        // Lancement au chargement
        document.addEventListener('DOMContentLoaded', () => {
            // Petit délai pour laisser le temps au SessionID de se générer
            setTimeout(() => voteManager.init(), 500);
        });


    </script>

    <!-- Modales Boutique et Vote -->
    <div id="shop-modal"
        class="fixed inset-0 z-[100] hidden flex items-center justify-center bg-black/90 backdrop-blur-sm transition-opacity duration-300 opacity-0 font-sans">
        <div class="bg-white border-4 border-black p-0 max-w-lg w-full relative shadow-[16px_16px_0_#FF00F5] transform scale-95 transition-transform duration-300"
            id="shop-modal-content">
            <div class="bg-black text-white p-3 flex justify-between items-center border-b-4 border-black">
                <div class="flex items-center gap-2">
                    <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                    <span class="font-mono text-xs">SECURE_GATEWAY // ALBI_BOT LINKED</span>
                </div>
                <button onclick="closeShopModal()" class="text-white hover:text-red-500 font-bold px-2">X</button>
            </div>

            <div class="p-8">
                <div class="flex justify-between items-start mb-6 border-b-2 border-dashed border-gray-300 pb-4">
                    <div>
                        <span id="modal-type-badge" class="bg-white text-black px-2 font-bold text-xs">TYPE</span>
                        <h3 id="modal-item-name" class="text-2xl font-black mt-1">NOM PACK</h3>
                    </div>
                    <div id="modal-item-price"
                        class="text-3xl font-bold text-brand-main bg-black px-2 transform rotate-2">0€</div>
                </div>

                <div id="payment-step-1">
                    <label class="block font-bold mb-2 text-xs uppercase flex justify-between">
                        <span>Lier Compte Discord</span>
                        <span class="text-gray-400 font-normal normal-case">Requis pour la livraison auto</span>
                    </label>

                    <div class="relative group">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i
                                class="ri-discord-fill text-gray-400 text-xl group-focus-within:text-[#5865F2] transition-colors"></i>
                        </div>
                        <input type="text" id="shop-username"
                            class="w-full border-4 border-black pl-10 p-3 font-mono focus:outline-none focus:border-[#5865F2] transition-colors"
                            placeholder="VotrePseudo#0000">
                    </div>

                    <div id="bot-check-status" class="h-6 mt-1 text-xs font-mono"></div>

                    <button onclick="verifyDiscordLink()" id="btn-verify-discord"
                        class="w-full mt-4 bg-black text-white font-black py-4 border-4 border-transparent hover:bg-[#5865F2] transition-all text-lg uppercase flex items-center justify-center gap-2">
                        VÉRIFIER LE COMPTE ➔
                    </button>
                </div>

                <div id="payment-step-2" class="hidden animate-[fadeIn_0.3s_ease-out]">
                    <div class="bg-[#5865F2]/10 border-l-4 border-[#5865F2] p-3 mb-6">
                        <p class="text-xs font-bold text-[#5865F2]">✓ COMPTE VÉRIFIÉ</p>
                        <p class="text-sm font-bold" id="verified-user">User</p>
                        <p class="text-[10px] font-mono opacity-60" id="verified-id">ID: 000</p>
                    </div>

                    <p class="font-bold text-xs uppercase mb-2">MÉTHODE DE PAIEMENT</p>
                    <div class="grid grid-cols-2 gap-3 mb-6">
                        <button
                            class="border-2 border-black p-2 hover:bg-black hover:text-white transition-colors flex flex-col items-center justify-center gap-1 focus:bg-black focus:text-white"
                            data-tooltip="Paiement sécurisé par carte bancaire via Stripe">
                            <i class="ri-bank-card-fill text-2xl"></i>
                            <span class="text-[10px] font-bold">CARTE / STRIPE</span>
                        </button>
                        <button
                            class="border-2 border-black p-2 hover:bg-black hover:text-white transition-colors flex flex-col items-center justify-center gap-1 focus:bg-black focus:text-white"
                            data-tooltip="Paiement en cryptomonnaies (ETH, SOL, BTC)">
                            <i class="ri-bit-coin-fill text-2xl"></i>
                            <span class="text-[10px] font-bold">CRYPTO</span>
                        </button>
                    </div>

                    <button onclick="processFinalPayment()" id="btn-pay-final"
                        class="w-full bg-green-500 text-black font-black py-4 border-4 border-transparent hover:border-black hover:bg-green-400 transition-all text-xl uppercase shadow-hard"
                        data-tooltip="Paiement sécurisé via Stripe ou Crypto">
                        CONFIRMER & PAYER
                    </button>

                    <div id="payment-loader" class="hidden text-center py-4">
                        <div
                            class="inline-block w-8 h-8 border-4 border-black border-t-transparent rounded-full animate-spin">
                        </div>
                        <p class="font-mono text-xs mt-2 font-bold animate-pulse">TRANSACTION BLOCKCHAIN...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- COMPTE À REBOURS LIVE -->
    <script>
        // --- PATCH : COMPTE À REBOURS LIVE ---
        function startEventCountdown() {
            const display = document.getElementById('event-countdown');
            if (!display) return;

            function update() {
                const now = new Date();
                let nextEventDate = null;

                // Trouver le prochain événement dans le futur
                // (On suppose que eventSystem est déjà chargé)
                if (typeof eventSystem !== 'undefined' && eventSystem.calendar) {
                    for (const evt of eventSystem.calendar) {
                        // Créer une date pour l'année en cours
                        let evtDate = new Date(now.getFullYear(), evt.start.month, evt.start.day);

                        // Si la date est passée, regarder l'année prochaine
                        if (evtDate < now) {
                            evtDate.setFullYear(now.getFullYear() + 1);
                        }

                        // On prend le plus proche
                        if (!nextEventDate || evtDate < nextEventDate) {
                            nextEventDate = evtDate;
                        }
                    }
                }

                // Si pas de date trouvée, fallback
                if (!nextEventDate) return;

                const diff = nextEventDate - now;

                // Calculs
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));

                // Formatage 00
                const d = String(days).padStart(2, '0');
                const h = String(hours).padStart(2, '0');
                const m = String(minutes).padStart(2, '0');

                display.innerText = `${d}J ${h}H ${m}M`;
            }

            setInterval(update, 1000);
            update(); // Init immédiat
        }

        // Lancer au chargement
        document.addEventListener('DOMContentLoaded', startEventCountdown);
    </script>

    <!-- EFFET HACKER TEXT -->
    <script>
        const symbols = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+";

        // Fonction récursive : isole les vraies lettres et ignore le formatage HTML (espaces/entrées)
        function processNode(node, charData) {
            if (node.nodeType === Node.TEXT_NODE) {
                const rawText = node.textContent;

                // PATCH 1 : Si le nœud ne contient que des espaces/sauts de ligne (indentation), on l'ignore TOTALEMENT.
                // Cela empêche la création de "blocs" vides qui décalent la mise en page.
                if (!rawText.replace(/\s/g, '').length) return;

                const fragment = document.createDocumentFragment();

                rawText.split('').forEach(char => {
                    // PATCH 2 : On sépare les caractères invisibles (espaces) des vraies lettres.
                    // Seules les lettres deviennent des <span class="hacker-char"> animés.
                    if (char === ' ' || char === '\n' || char === '\t') {
                        fragment.appendChild(document.createTextNode(char));
                    } else {
                        const span = document.createElement('span');
                        span.className = 'hacker-char';
                        span.textContent = char;
                        span.dataset.real = char; // Mémorise la vraie lettre
                        charData.push(span);      // Ajoute à la liste d'animation
                        fragment.appendChild(span);
                    }
                });

                node.parentNode.replaceChild(fragment, node);
            }
            else if (node.nodeType === Node.ELEMENT_NODE) {
                // On descend dans les enfants pour respecter le gras, les couleurs, etc.
                Array.from(node.childNodes).forEach(child => processNode(child, charData));
            }
        }

        document.querySelectorAll('h1, h2, .hacker-effect').forEach(element => {
            // Sauvegarde de l'état original pur
            element.dataset.originalHtml = element.innerHTML;

            element.addEventListener('mouseenter', function (e) {
                const target = e.currentTarget;
                if (target.dataset.animating === "true") return;

                // 1. VERROUILLAGE PHYSIQUE (Empêche le layout de bouger)
                // On capture les dimensions exactes actuelles
                const width = target.offsetWidth;
                const height = target.offsetHeight;

                // On force ces dimensions en style inline
                target.style.width = `${width}px`;
                target.style.height = `${height}px`;
                target.style.display = 'inline-block'; // Nécessaire pour que width/height s'appliquent
                target.style.overflow = 'hidden';      // COUPE tout ce qui dépasse (sécurité absolue)
                target.style.verticalAlign = 'bottom'; // Garde l'alignement sur la ligne
                target.style.whiteSpace = 'nowrap';    // Empêche le retour à la ligne forcé

                target.dataset.animating = "true";

                // 2. TRANSFORMATION DU DOM
                const animatableChars = [];

                // On repart du HTML propre pour éviter les bugs si on survole vite
                target.innerHTML = target.dataset.originalHtml;

                // On lance la découpe intelligente
                processNode(target, animatableChars);

                // 3. ANIMATION
                let iteration = 0;
                const interval = setInterval(() => {
                    // Changement des lettres
                    animatableChars.forEach(span => {
                        if (!span.dataset.locked) {
                            span.textContent = symbols[Math.floor(Math.random() * symbols.length)];
                        }
                    });

                    // Verrouillage progressif (Gauche -> Droite)
                    const charsToLock = Math.floor(iteration);

                    for (let i = 0; i < charsToLock && i < animatableChars.length; i++) {
                        const span = animatableChars[i];
                        if (!span.dataset.locked) {
                            span.textContent = span.dataset.real; // Restaure la vraie lettre
                            span.dataset.locked = "true";
                        }
                    }

                    // Fin de l'animation
                    if (charsToLock > animatableChars.length + 2) {
                        clearInterval(interval);

                        // 4. RESTAURATION TOTALE
                        // On remet le code EXACT d'origine (plus de spans, plus de styles inline)
                        target.innerHTML = target.dataset.originalHtml;

                        // On nettoie les styles forcés
                        target.style.width = '';
                        target.style.height = '';
                        target.style.display = '';
                        target.style.overflow = '';
                        target.style.verticalAlign = '';
                        target.style.whiteSpace = '';

                        target.dataset.animating = "false";
                    }

                    iteration += 1 / 2; // Vitesse
                }, 30);
            });
        });
    </script>

    <!-- SYSTÈME DE MONITORING RÉSOLUTION -->
    <script>
        // --- SYSTÈME DE MONITORING RÉSOLUTION ---
        const resDisplay = document.getElementById('current-res');

        function updateResMonitor() {
            if (resDisplay) {
                const w = window.innerWidth;
                const h = window.innerHeight;
                resDisplay.innerText = `CURRENT: ${w}x${h}`;

                // Change la couleur si critique
                if (w < 375 || h < 500) {
                    resDisplay.style.color = 'red';
                    resDisplay.style.fontWeight = 'bold';
                } else {
                    resDisplay.style.color = 'green';
                }
            }
        }

        window.addEventListener('resize', updateResMonitor);
        // Init
        updateResMonitor();
    </script>

    <!-- SYSTÈME DE FILTRE JOBS -->
    <script>
        // --- SYSTÈME DE FILTRE JOBS ---
        function filterJobs(category, btnElement) {
            // 1. Gestion visuelle des boutons (Active/Inactive)
            const buttons = document.querySelectorAll('.job-filter-btn');
            buttons.forEach(btn => {
                // Reset style (Devient Blanc)
                btn.classList.remove('bg-black', 'text-white');
                btn.classList.add('bg-white', 'text-black');
            });

            // Activer le bouton cliqué (Devient Noir)
            if (btnElement) {
                btnElement.classList.remove('bg-white', 'text-black');
                btnElement.classList.add('bg-black', 'text-white');
            }

            // 2. Filtrage des cartes avec animation
            const cards = document.querySelectorAll('.job-card');

            cards.forEach(card => {
                const cardCat = card.getAttribute('data-category');

                // Animation de sortie
                card.style.opacity = '0';
                card.style.transform = 'scale(0.95)';

                setTimeout(() => {
                    if (category === 'all' || cardCat === category) {
                        // Afficher
                        card.classList.remove('hidden');
                        // Petit délai pour permettre l'animation d'entrée
                        setTimeout(() => {
                            card.style.opacity = '1';
                            card.style.transform = 'scale(1)';
                        }, 50);
                    } else {
                        // Masquer complètement du flux
                        card.classList.add('hidden');
                    }
                }, 200); // Attendre la fin de l'animation de sortie
            });
        }

        // ============================================
        // PACK ULTIMATE V3.0 - SYSTÈME IMMERSIF
        // ============================================

        // --- MOTEUR AUDIO (SFX GÉNÉRÉS EN TEMPS RÉEL) ---
        const audioSystem = {
            ctx: null,

            init: function () {
                // Initialisation différée pour éviter les problèmes d'autoplay
                this.ctx = new (window.AudioContext || window.webkitAudioContext)();
            },

            play: function (type) {
                if (!this.ctx) this.init();
                if (this.ctx.state === 'suspended') this.ctx.resume();

                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.connect(gain);
                gain.connect(this.ctx.destination);

                const now = this.ctx.currentTime;

                if (type === 'hover') {
                    // Petit "Blip" aigu et court
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(800, now);
                    osc.frequency.exponentialRampToValueAtTime(1200, now + 0.05);
                    gain.gain.setValueAtTime(0.05, now);
                    gain.gain.exponentialRampToValueAtTime(0.001, now + 0.05);
                    osc.start(now);
                    osc.stop(now + 0.05);
                }
                else if (type === 'click') {
                    // Son de validation "Tech"
                    osc.type = 'square';
                    osc.frequency.setValueAtTime(200, now);
                    osc.frequency.exponentialRampToValueAtTime(50, now + 0.1);
                    gain.gain.setValueAtTime(0.1, now);
                    gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
                    osc.start(now);
                    osc.stop(now + 0.1);
                }
                else if (type === 'success') {
                    // Mélodie de succès (Arpège)
                    this.playNote(440, now, 0.1);       // A4
                    this.playNote(554.37, now + 0.1, 0.1); // C#5
                    this.playNote(659.25, now + 0.2, 0.2); // E5
                }
                else if (type === 'error') {
                    // Buzzer d'erreur
                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(100, now);
                    osc.frequency.linearRampToValueAtTime(50, now + 0.2);
                    gain.gain.setValueAtTime(0.2, now);
                    gain.gain.linearRampToValueAtTime(0.001, now + 0.2);
                    osc.start(now);
                    osc.stop(now + 0.2);
                }
            },

            playNote: function (freq, time, duration) {
                if (!this.ctx) this.init();
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.connect(gain);
                gain.connect(this.ctx.destination);

                osc.type = 'triangle';
                osc.frequency.value = freq;
                gain.gain.setValueAtTime(0.1, time);
                gain.gain.exponentialRampToValueAtTime(0.001, time + duration);

                osc.start(time);
                osc.stop(time + duration);
            }
        };

        // --- SYSTÈME ÉCONOMIQUE (USER PROFILE) ---
        const userProfile = {
            balance: 1500, // Solde fictif de départ
            inventory: [],

            updateUI: function () {
                const balanceDisplay = document.getElementById('user-balance');
                if (balanceDisplay) {
                    // Animation du compteur
                    const currentVal = parseInt(balanceDisplay.innerText.replace('€', '').replace(/\s/g, '')) || 0;
                    animateValue(balanceDisplay, currentVal, this.balance, 1000);
                }
            },

            pay: function (amount) {
                if (this.balance >= amount) {
                    this.balance -= amount;
                    this.updateUI();
                    return true;
                }
                return false;
            },

            addItem: function (itemName) {
                this.inventory.push({ name: itemName, date: new Date() });
                audioSystem.play('success');
            }
        };

        // Fonction utilitaire pour animer les nombres
        function animateValue(obj, start, end, duration) {
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                const current = Math.floor(progress * (end - start) + start);
                obj.innerHTML = current.toLocaleString('fr-FR') + "€";
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }

        // --- GESTIONNAIRE D'INTERACTIONS GLOBALES (SONS & TOOLTIPS) ---
        document.addEventListener('DOMContentLoaded', () => {
            // 1. Sons sur tous les éléments interactifs
            const interactives = document.querySelectorAll('button, a, input, .job-card, .shop-tab');
            interactives.forEach(el => {
                el.addEventListener('mouseenter', () => audioSystem.play('hover'));
                el.addEventListener('click', () => audioSystem.play('click'));
            });

            // 2. Initialisation des Tooltips (SYSTÈME V2 - STABLE & SÉCURISÉ)
            const tooltipSystem = {
                element: null,
                targetX: 0,
                targetY: 0,
                currentX: 0,
                currentY: 0,
                isVisible: false,
                rafId: null,

                init: function () {
                    // Création unique (Singleton)
                    if (document.getElementById('cursor-tooltip')) return;

                    this.element = document.createElement('div');
                    this.element.id = 'cursor-tooltip';
                    document.body.appendChild(this.element);

                    // Écouteurs optimisés
                    document.addEventListener('mousemove', (e) => {
                        this.targetX = e.clientX;
                        this.targetY = e.clientY;

                        // Lancer la boucle d'animation seulement si le tooltip est visible
                        if (this.isVisible && !this.rafId) {
                            this.loop();
                        }
                    }, { passive: true }); // passive: true améliore le scroll

                    // Délégation d'événements (plus performant que d'attacher à chaque bouton)
                    document.body.addEventListener('mouseover', (e) => this.handleHover(e));
                    document.body.addEventListener('mouseout', (e) => this.handleOut(e));
                },

                handleHover: function (e) {
                    // On cherche l'attribut data-tooltip sur l'élément ou ses parents
                    const target = e.target.closest('[data-tooltip]');

                    if (target) {
                        const text = target.getAttribute('data-tooltip');
                        if (text) {
                            // SÉCURITÉ : Utiliser textContent et non innerHTML pour éviter les failles XSS
                            this.element.textContent = text;
                            this.isVisible = true;
                            this.element.style.opacity = '1';
                        }
                    }
                },

                handleOut: function (e) {
                    const target = e.target.closest('[data-tooltip]');
                    if (target) {
                        this.isVisible = false;
                        this.element.style.opacity = '0';
                        // Arrêter la boucle d'animation quand le tooltip n'est plus visible
                        if (this.rafId) {
                            cancelAnimationFrame(this.rafId);
                            this.rafId = null;
                        }
                    }
                },

                loop: function () {
                    // Interpolation pour un effet de suivi fluide (optionnel, ici direct pour réactivité)
                    this.currentX = this.targetX;
                    this.currentY = this.targetY;

                    if (this.element) {
                        // --- INTELLIGENCE DE POSITIONNEMENT (BOUNDARY CHECK) ---
                        const tooltipRect = this.element.getBoundingClientRect();
                        const viewportWidth = window.innerWidth;
                        const viewportHeight = window.innerHeight;

                        let finalX = this.currentX + 15; // Décalage par défaut (droite)
                        let finalY = this.currentY + 15; // Décalage par défaut (bas)

                        // Si ça dépasse à droite, on met à gauche de la souris
                        if (finalX + tooltipRect.width > viewportWidth) {
                            finalX = this.currentX - tooltipRect.width - 10;
                        }

                        // Si ça dépasse en bas, on met au-dessus de la souris
                        if (finalY + tooltipRect.height > viewportHeight) {
                            finalY = this.currentY - tooltipRect.height - 10;
                        }

                        // Application via transform (Accélération GPU)
                        this.element.style.transform = `translate3d(${finalX}px, ${finalY}px, 0)`;
                    }

                    // Continuer la boucle tant que le tooltip est visible
                    // La boucle s'arrêtera automatiquement quand isVisible = false
                    this.rafId = requestAnimationFrame(() => this.loop());
                }
            };

            // Initialiser le système de tooltip
            tooltipSystem.init();

            // Initialisation de l'affichage du solde
            userProfile.updateUI();
        });

        // --- MODIFICATION DE processFinalPayment POUR INTÉGRER L'ÉCONOMIE ---
        // Sauvegarde de l'ancienne fonction pour compatibilité
        const originalProcessFinalPayment = window.processFinalPayment;

        // Nouvelle version avec économie
        window.processFinalPayment = function () {
            const btn = document.getElementById('btn-pay-final');
            const loader = document.getElementById('payment-loader');

            btn.classList.add('hidden');
            loader.classList.remove('hidden');

            setTimeout(() => {
                const priceText = document.getElementById('modal-item-price').innerText;
                const price = parseFloat(priceText.replace('€', '').replace('/MOIS', '').replace(/\s/g, '')) || 0;
                const itemName = document.getElementById('modal-item-name').innerText;

                // Vérification Solde (Simulation)
                // Ici on triche : on laisse passer même si solde insuffisant car c'est un achat "externe" (CB/Crypto)
                // Mais on simule l'ajout au compte in-game

                userProfile.addItem(itemName);
                // On ajoute de l'argent virtuel pour simuler le pack "Starter" par exemple
                if (itemName.includes('STARTER')) userProfile.balance += 50000;
                if (itemName.includes('KINGPIN')) userProfile.balance += 200000;
                if (itemName.includes('CUSTOM')) userProfile.balance += 300000;
                userProfile.updateUI();

                closeShopModal();
                if (typeof toastManager !== 'undefined') {
                    toastManager.show("PAIEMENT VALIDÉ", `${itemName} ajouté à votre inventaire.`);
                }

                // Reset
                btn.classList.remove('hidden');
                loader.classList.add('hidden');
            }, 2000);
        };

        // --- MARQUEE INFINI ---
        document.addEventListener("DOMContentLoaded", () => {
            const marqueeContainer = document.getElementById('infinite-marquee');
            if (!marqueeContainer) return;

            const originalContent = marqueeContainer.querySelector('.marquee-item');
            if (!originalContent) return;

            // 1. Cloner le contenu pour avoir une boucle sans coupure
            const clonedContent = originalContent.cloneNode(true);

            // 2. Ajouter l'attribut aria-hidden pour l'accessibilité (lecteurs d'écran)
            clonedContent.setAttribute('aria-hidden', 'true');

            // 3. Ajouter le clone au conteneur
            marqueeContainer.appendChild(clonedContent);

            // 4. Appliquer la classe d'animation aux DEUX éléments
            originalContent.classList.add('animate-scroll');
            clonedContent.classList.add('animate-scroll');
        });
    </script>
    <script>
        (function () {
            let originalTitle = document.title;
            let titleInterval = null;
            let isAnimating = false;

            // --- 1. DÉTECTION OS (Récupération intelligente de l'extension) ---
            const userAgent = navigator.userAgent.toLowerCase();
            const platform = navigator.platform.toLowerCase();
            let fileExt = ".exe"; // Défaut (Windows)

            if (userAgent.includes('mac') || platform.includes('mac')) {
                fileExt = ".app"; // macOS
            } else if (userAgent.includes('android')) {
                fileExt = ".apk"; // Android
            } else if (userAgent.includes('iphone') || userAgent.includes('ipad')) {
                fileExt = ".ipa"; // iOS
            } else if (userAgent.includes('linux')) {
                fileExt = ".sh";  // Linux
            }

            // --- 2. CONFIGURATION CONTEXTUELLE (Messages par page) ---
            // Le script va piocher ici selon l'ID de la vue actuelle (hash)
            // {{EXT}} sera remplacé par l'extension détectée plus haut
            const contextAlerts = {
                'default': [
                    "⚠️ ALBI A BESOIN DE TOI",
                    "🛑 NE PARS PAS...",
                    "SYSTEM_FAILURE{{EXT}}",
                    "🚔 POLICE EN ROUTE",
                    "DISCONNECTED..."
                ],
                'shop': [
                    "💸 PAIEMENT EN ATTENTE",
                    "💎 PROMO EXPIRÉE ?",
                    "WALLET_ERROR{{EXT}}",
                    "🛒 TON PANIER T'ATTEND",
                    "⚠️ TRANSACTION SUSPENDUE"
                ],
                'whitelist': [
                    "🚫 ACCÈS REFUSÉ",
                    "📝 CANDIDATURE PAUSE",
                    "ADMIN_CHECK{{EXT}}",
                    "👮 DOUANE EN ATTENTE",
                    "NE QUITTEZ PAS LA FILE"
                ],
                'vote': [
                    "⭐ TU AS OUBLIÉ DE VOTER",
                    "🎁 RÉCOMPENSE PERDUE ?",
                    "VOTE_SCRIPT{{EXT}}",
                    "📈 SOUTIENS LE SERVEUR",
                    "CLASSEMENT EN BAISSE 📉"
                ],
                'rules': [
                    "⚖️ CODE PÉNAL NON LU",
                    "👮 ATTENTION AUX BAN",
                    "LEGAL_DOCS{{EXT}}",
                    "⚠️ NUL N'EST CENSÉ...",
                    "IGNORER LA LOI ?"
                ],
                'lore': [
                    "📁 ARCHIVES FERMÉES",
                    "ENCRYPTING_DATA{{EXT}}",
                    "🔒 HISTOIRE SECRÈTE",
                    "LA VILLE T'APPELLE"
                ],
                'factions': [
                    "🔫 GUERRE DE GANGS",
                    "TERRITOIRE PERDU ⚠️",
                    "WANTED_LEVEL{{EXT}}",
                    "🩸 REJOINS LE SYNDICAT"
                ]
            };

            const loadingChars = ["|", "/", "—", "\\"];
            let loadingIndex = 0;
            let alertIndex = 0;

            // --- 3. LOGIQUE D'ANIMATION INTELLIGENTE ---
            function startTitleAnimation() {
                if (isAnimating) return;
                isAnimating = true;

                // Sauvegarde de sécurité
                if (!document.title.includes("⚠️") && !document.title.includes("SYSTEM")) {
                    originalTitle = document.title;
                }

                // A. Détection de la page actuelle
                let currentView = window.location.hash.replace('#', '') || 'home';

                // B. Sélection des messages appropriés
                let activeMessages = contextAlerts[currentView] || contextAlerts['default'];

                // Fallback si la liste est vide pour une raison X
                if (activeMessages.length === 0) activeMessages = contextAlerts['default'];

                titleInterval = setInterval(() => {
                    const spinner = loadingChars[loadingIndex];

                    // C. Sélection et Formatage du message
                    // On remplace {{EXT}} par la vraie extension OS (ex: .app sur Mac)
                    let rawMsg = activeMessages[alertIndex];
                    const msg = rawMsg.replace('{{EXT}}', fileExt);

                    document.title = `[ ${spinner} ] ${msg}`;

                    // Rotation
                    loadingIndex = (loadingIndex + 1) % loadingChars.length;
                    if (loadingIndex === 0) {
                        alertIndex = (alertIndex + 1) % activeMessages.length;
                    }
                }, 500);
            }

            function stopTitleAnimation() {
                if (!isAnimating) return;
                isAnimating = false;
                clearInterval(titleInterval);
                document.title = originalTitle;
                alertIndex = 0; // Reset pour commencer par le message 1 la prochaine fois
            }

            // --- 4. DÉTECTION CROSS-BROWSER (Alsacreations Standard) ---
            let hidden, visibilityChange;
            if (typeof document.hidden !== "undefined") {
                hidden = "hidden"; visibilityChange = "visibilitychange";
            } else if (typeof document.mozHidden !== "undefined") {
                hidden = "mozHidden"; visibilityChange = "mozvisibilitychange";
            } else if (typeof document.msHidden !== "undefined") {
                hidden = "msHidden"; visibilityChange = "msvisibilitychange";
            } else if (typeof document.webkitHidden !== "undefined") {
                hidden = "webkitHidden"; visibilityChange = "webkitvisibilitychange";
            }

            function handleVisibilityChange() {
                if (document[hidden]) startTitleAnimation();
                else stopTitleAnimation();
            }

            if (typeof document.addEventListener !== "undefined" && typeof hidden !== "undefined") {
                document.addEventListener(visibilityChange, handleVisibilityChange, false);
            }

            // Fallback
            window.addEventListener('blur', function () { if (!hidden) startTitleAnimation(); });
            window.addEventListener('focus', function () { stopTitleAnimation(); });

        })();
    </script>

    <!-- Wallet Modal -->
    <div id="wallet-modal"
        class="fixed inset-0 z-[100] hidden flex items-center justify-center bg-black/95 backdrop-blur-md transition-opacity duration-300 opacity-0 font-sans">
        <div class="bg-white border-4 border-black p-0 max-w-md w-full relative shadow-[16px_16px_0_#D6FF00] transform scale-95 transition-transform duration-300"
            id="wallet-modal-content">

            <div class="bg-black text-white p-4 flex justify-between items-center border-b-4 border-black">
                <div class="flex items-center gap-2">
                    <i id="status-icon" class="ri-wallet-3-fill text-brand-main animate-pulse"></i>

                    <span class="font-mono text-xs font-bold tracking-widest text-white">
                        SECURE_CONNECT // <span id="network-status">ONLINE</span>
                    </span>
                </div>

                <script>
                    document.addEventListener('DOMContentLoaded', () => {
                        const statusText = document.getElementById('network-status');
                        const statusIcon = document.getElementById('status-icon');

                        function updateNetworkStatus() {
                            if (navigator.onLine) {
                                // Statut En Ligne
                                statusText.textContent = 'ONLINE';

                                // Retour au style visuel par défaut (actif)
                                statusIcon.classList.add('text-brand-main', 'animate-pulse');
                                statusIcon.classList.remove('text-red-500');
                            } else {
                                // Statut Hors Ligne
                                statusText.textContent = 'OFFLINE';

                                // Indication visuelle d'erreur (rouge et arrêt de l'animation)
                                statusIcon.classList.remove('text-brand-main', 'animate-pulse');
                                statusIcon.classList.add('text-red-500');
                            }
                        }

                        // Écouteurs d'événements pour les changements de connexion
                        window.addEventListener('online', updateNetworkStatus);
                        window.addEventListener('offline', updateNetworkStatus);

                        // Vérification initiale au chargement de la page
                        updateNetworkStatus();
                    });
                </script>
                <button onclick="closeWalletModal()"
                    class="text-white hover:text-red-500 font-bold px-2 text-xl transition-colors"
                    aria-label="Fermer">×</button>
            </div>

            <div class="p-8 bg-white text-black">
                <h3 class="text-3xl font-black uppercase mb-2 text-black tracking-tighter">CHOISIS TON ARME</h3>

                <p class="font-mono text-xs text-black font-bold mb-6 border-l-4 border-black pl-3 py-1 bg-gray-100">
                    Connecte ton portefeuille pour accéder au Black Market et sauvegarder ta progression.
                </p>

                <div class="grid grid-cols-1 gap-4">

                    <button onclick="selectWalletProvider('metamask')"
                        class="group flex items-center justify-between bg-white border-4 border-black p-4 hover:bg-[#F6851B] hover:text-white transition-all shadow-hard-sm hover:translate-x-1 hover:-translate-y-1 w-full text-black">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 flex items-center justify-center shrink-0">
                                <img src="https://raw.githubusercontent.com/0xa3k5/web3icons/refs/heads/main/raw-svgs/wallets/branded/metamask.svg"
                                    class="w-full h-full object-contain drop-shadow-md group-hover:drop-shadow-[0_2px_4px_rgba(255,255,255,0.9)] transition-all"
                                    alt="MetaMask">
                            </div>
                            <div class="text-left">
                                <span
                                    class="block font-black text-lg leading-none group-hover:text-white text-black">METAMASK</span>
                                <span
                                    class="font-mono text-[10px] font-bold opacity-60 group-hover:text-white/80 text-black">Ethereum
                                    / Polygon</span>
                            </div>
                        </div>
                        <i
                            class="ri-arrow-right-line opacity-0 group-hover:opacity-100 transition-opacity text-2xl"></i>
                    </button>

                    <button onclick="selectWalletProvider('phantom')"
                        class="group flex items-center justify-between bg-white border-4 border-black p-4 hover:bg-[#AB9FF2] hover:text-white transition-all shadow-hard-sm hover:translate-x-1 hover:-translate-y-1 w-full text-black">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 flex items-center justify-center shrink-0">
                                <img src="https://raw.githubusercontent.com/0xa3k5/web3icons/refs/heads/main/raw-svgs/wallets/branded/phantom.svg"
                                    class="w-full h-full object-contain drop-shadow-md group-hover:drop-shadow-[0_2px_4px_rgba(255,255,255,0.9)] transition-all"
                                    alt="Phantom">
                            </div>
                            <div class="text-left">
                                <span
                                    class="block font-black text-lg leading-none group-hover:text-white text-black">PHANTOM</span>
                                <span
                                    class="font-mono text-[10px] font-bold opacity-60 group-hover:text-white/80 text-black">Solana
                                    Network</span>
                            </div>
                        </div>
                        <i
                            class="ri-arrow-right-line opacity-0 group-hover:opacity-100 transition-opacity text-2xl"></i>
                    </button>

                    <button onclick="selectWalletProvider('coinbase')"
                        class="group flex items-center justify-between bg-white border-4 border-black p-4 hover:bg-[#0052FF] hover:text-white transition-all shadow-hard-sm hover:translate-x-1 hover:-translate-y-1 w-full text-black">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 flex items-center justify-center shrink-0">
                                <img src="https://raw.githubusercontent.com/0xa3k5/web3icons/refs/heads/main/raw-svgs/wallets/branded/coinbase.svg"
                                    class="w-full h-full object-contain drop-shadow-md group-hover:drop-shadow-[0_2px_4px_rgba(255,255,255,0.9)] transition-all"
                                    alt="Coinbase Wallet">
                            </div>
                            <div class="text-left">
                                <span
                                    class="block font-black text-lg leading-none group-hover:text-white text-black">COINBASE</span>
                                <span
                                    class="font-mono text-[10px] font-bold opacity-60 group-hover:text-white/80 text-black">Wallet
                                    & Mobile</span>
                            </div>
                        </div>
                        <i
                            class="ri-arrow-right-line opacity-0 group-hover:opacity-100 transition-opacity text-2xl"></i>
                    </button>

                    <button onclick="selectWalletProvider('trust')"
                        class="group flex items-center justify-between bg-white border-4 border-black p-4 hover:bg-[#3375BB] hover:text-white transition-all shadow-hard-sm hover:translate-x-1 hover:-translate-y-1 w-full text-black">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 flex items-center justify-center shrink-0">
                                <img src="https://raw.githubusercontent.com/0xa3k5/web3icons/refs/heads/main/raw-svgs/wallets/branded/trust.svg"
                                    class="w-full h-full object-contain drop-shadow-md group-hover:drop-shadow-[0_2px_4px_rgba(255,255,255,0.9)] transition-all"
                                    alt="Trust Wallet">
                            </div>
                            <div class="text-left">
                                <span
                                    class="block font-black text-lg leading-none group-hover:text-white text-black">TRUST
                                    WALLET</span>
                                <span
                                    class="font-mono text-[10px] font-bold opacity-60 group-hover:text-white/80 text-black">Multi-Chain</span>
                            </div>
                        </div>
                        <i
                            class="ri-arrow-right-line opacity-0 group-hover:opacity-100 transition-opacity text-2xl"></i>
                    </button>

                </div>

                <div id="wallet-error-msg"
                    class="mt-4 text-center font-mono text-[10px] text-white bg-red-600 font-bold p-2 border-2 border-black hidden animate-pulse shadow-hard-sm">
                    ERREUR: PORTEFEUILLE NON DÉTECTÉ OU ACCÈS REFUSÉ
                </div>
            </div>
        </div>
    </div>

    <!-- Preloader -->
    <script>
        // --- ISOLATED PRELOADER ---
        (function () {
            const preloader = document.getElementById('preloader');
            const loaderBar = document.getElementById('loader-bar');
            const loaderText = document.getElementById('loader-text');

            if (!preloader) return;

            // Configuration
            const minTime = 1500; // Temps mini pour l'animation
            const maxTime = 8000; // Temps maxi (Sécurité)
            const start = Date.now();
            let dismissed = false;

            // Animation visuelle fake
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 10;
                if (progress > 95) progress = 95; // On attend la fin réelle pour le 100%

                if (loaderBar) loaderBar.style.width = `${progress}%`;
            }, 100);

            // Fonction de fermeture
            function dismiss() {
                if (dismissed) return;
                dismissed = true;
                clearInterval(interval);

                const elapsed = Date.now() - start;
                const remaining = Math.max(0, minTime - elapsed);

                setTimeout(() => {
                    // 100% Visuel
                    if (loaderBar) loaderBar.style.width = '100%';
                    if (loaderText) loaderText.innerText = "SYSTEM READY.";

                    // Disparition
                    preloader.style.transition = "opacity 0.6s ease, transform 0.6s ease";
                    preloader.style.opacity = "0";
                    preloader.style.pointerEvents = "none";

                    // Suppression du DOM
                    setTimeout(() => preloader.style.display = "none", 600);
                }, remaining);
            }

            // Déclencheurs
            window.addEventListener('load', dismiss);       // Normal
            setTimeout(dismiss, maxTime);                   // Secours
        })();
    </script>
    <script>
        // --- CONFIGURATION DE VOS LIENS (REMPLISSEZ ICI) ---
        const ALBI_LINKS = {
            // Le lien principal de votre jeu Roblox
            roblox_game: "https://www.roblox.com/games/123456789/ALBI-RP-FRANCE-WHITELIST",

            // Vos réseaux
            discord: "https://discord.gg/eVn8pKYwQy",
            twitter: "https://twitter.com/AlbiRP_Officiel",
            instagram: "https://instagram.com/albirp_roblox",
            tiktok: "https://tiktok.com/@albirp_fr",

            // Sites de vote
            vote_top_serveurs: "https://top-serveurs.net/roblox/vote/albi-rp",
            vote_tracky: "https://trackyserver.com/server/albi-rp",

            // Contact
            email: "contact@albirp.com"
        };

        document.addEventListener('DOMContentLoaded', () => {
            console.log("🔗 LINK MANAGER: Hydratation des liens en cours...");

            // 1. BOUTONS "JOUER" (Navbar & Hero)
            // On cible tous les boutons qui contiennent le texte "JOUER" ou l'icône manette
            const playButtons = document.querySelectorAll('button[data-tooltip*="Jouer"], button[onclick*="roblox"]');
            playButtons.forEach(btn => {
                // On remplace le comportement par défaut
                btn.onclick = function (e) {
                    e.preventDefault();
                    window.open(ALBI_LINKS.roblox_game, '_blank');
                };
                // Met à jour le tooltip
                btn.setAttribute('data-tooltip', 'Ouvrir Roblox (PC/Mobile)');
            });

            // 2. PAGE SOCIALS (Mise à jour intelligente par détection d'icône)
            const socialSection = document.getElementById('view-socials');
            if (socialSection) {
                // Twitter
                const twBtn = socialSection.querySelector('.ri-twitter-x-fill')?.closest('a');
                if (twBtn) twBtn.href = ALBI_LINKS.twitter;

                // Instagram
                const instaBtn = socialSection.querySelector('.ri-instagram-fill')?.closest('a');
                if (instaBtn) instaBtn.href = ALBI_LINKS.instagram;

                // TikTok
                const tiktokBtn = socialSection.querySelector('.ri-tiktok-fill')?.closest('a');
                if (tiktokBtn) tiktokBtn.href = ALBI_LINKS.tiktok;

                // Discord (Gros bloc)
                const discordBtn = socialSection.querySelector('.ri-discord-fill')?.closest('a');
                if (discordBtn) discordBtn.href = ALBI_LINKS.discord;

                // Roblox (Gros bloc)
                // On cherche le lien qui contient le SVG Roblox ou le texte "SERVEUR ROBLOX"
                const rblxLinks = socialSection.querySelectorAll('a');
                rblxLinks.forEach(link => {
                    if (link.innerHTML.includes('SERVEUR ROBLOX') || link.innerHTML.includes('CONNECT')) {
                        link.href = ALBI_LINKS.roblox_game;
                    }
                });

                // Mail
                const mailBtn = socialSection.querySelector('.ri-mail-send-fill')?.closest('a');
                if (mailBtn) mailBtn.href = `mailto:${ALBI_LINKS.email}`;
            }

            // 3. PAGE VOTE (Redirection dynamique)
            // On écrase la fonction handleVote pour utiliser nos liens de config
            window.handleVote = function (target) {
                let finalUrl = target; // Par défaut

                // Si l'argument est un mot-clé, on utilise la config
                if (target.includes('top-serveurs')) finalUrl = ALBI_LINKS.vote_top_serveurs;
                if (target.includes('tracky')) finalUrl = ALBI_LINKS.vote_tracky;
                if (target.includes('discord')) finalUrl = ALBI_LINKS.discord;

                toastManager.show("REDIRECTION...", "Ouverture de la page de vote.");
                setTimeout(() => {
                    window.open(finalUrl, '_blank');
                }, 800);
            };

            console.log("✅ LINK MANAGER: Liens mis à jour avec succès.");
        });
    </script>
</body>

</html>